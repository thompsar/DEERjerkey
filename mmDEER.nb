(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 9.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       157,          7]
NotebookDataLength[    372898,       8552]
NotebookOptionsPosition[    370298,       8492]
NotebookOutlinePosition[    370731,       8510]
CellTagsIndexPosition[    370688,       8507]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"Put", " ", "this", " ", "file"}], ",", " ", 
    RowBox[{"mmDEERdefs", " ", "and", " ", 
     RowBox[{"RLinkX", ".", "m"}], " ", "in", " ", "the", " ", "same", " ", 
     "directory"}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"Initilaizations", " ", "are", " ", "hidden", " ", "here"}], ",", 
    " ", 
    RowBox[{"THIS", " ", "CELL", " ", "EVALUATES", " ", "AUTOMATICALLY"}], 
    ",", " ", 
    RowBox[{
     RowBox[{
     "RUN", " ", "FIRST", " ", "CELL", " ", "BELOW", " ", "by", " ", 
      "pushing", " ", "Shift"}], "-", "Enter"}], ",", " ", 
    RowBox[{"proceed", " ", "cell", " ", "by", " ", "cell"}]}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
   "PUSH", " ", "YES", " ", "when", " ", "a", " ", "window", " ", "pops", " ",
     "up", " ", "on", " ", "first", " ", "run"}], "*)"}]}]], "Input",
 Editable->False,
 CellGroupingRules->{"GroupTogetherGrouping", 10000.},
 CellChangeTimes->{{3.697815671165989*^9, 3.69781571116588*^9}, {
  3.697816968742434*^9, 3.697816999728215*^9}, {3.7264990858490963`*^9, 
  3.7264990873582077`*^9}, {3.7372044852337523`*^9, 3.7372045303173323`*^9}, {
  3.7372047082663593`*^9, 3.737204710582748*^9}, {3.737204741929481*^9, 
  3.737204742147303*^9}, {3.73720477470149*^9, 
  3.737204792188746*^9}},ExpressionUUID->"c0aaf8f3-b9da-49c9-9ffd-\
715f2066d025"],

Cell[BoxData[{
 RowBox[{"FrontEndExecute", "@", 
  RowBox[{
  "FrontEndToken", "@", 
   "\"\<DeleteGeneratedCells\>\""}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"mypath", "=", 
   RowBox[{"NotebookDirectory", "[", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"AppendTo", "[", 
   RowBox[{"$Path", ",", "mypath"}], "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Get", "[", "\"\<DEERdefs.m\>\"", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Needs", "[", "\"\<RLinkX`\>\"", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"InstallRX", "[", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{"$OperatingSystem", "\[NotEqual]", "\"\<Windows\>\""}], ",", 
    RowBox[{
     RowBox[{
     "REvaluate", "[", 
      "\"\<install.packages('nnls', repos='http://cran.wustl.edu/')\>\"", 
      "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
  RowBox[{"REvaluate", "[", "\"\<library(nnls)\>\"", "]"}], ";"}]}], "Input",
 Editable->False,
 CellGroupingRules->{"GroupTogetherGrouping", 10000.},
 InitializationCell->True,
 CellChangeTimes->{{3.685712829814394*^9, 3.685712863904315*^9}, 
   3.685712965768214*^9, 3.685713270602428*^9, {3.685713438957621*^9, 
   3.685713448048094*^9}, {3.687534498541231*^9, 3.6875344987437563`*^9}, {
   3.6902205863907347`*^9, 3.690220607150242*^9}, {3.69307006138947*^9, 
   3.6930700802266483`*^9}, {3.693072210424589*^9, 3.693072237711006*^9}, {
   3.693072486634894*^9, 3.693072493655158*^9}, 3.6930729607089357`*^9, {
   3.693158560696233*^9, 3.6931585638593693`*^9}, {3.693246235851071*^9, 
   3.693246236322179*^9}, {3.6932479451785917`*^9, 3.693247947227625*^9}, {
   3.693679662918419*^9, 3.693679703800729*^9}, {3.6936798388864393`*^9, 
   3.693679849595109*^9}, {3.693679891053357*^9, 3.693679894777896*^9}, {
   3.693679998386889*^9, 3.693680079733098*^9}, {3.69375820826795*^9, 
   3.693758227319002*^9}, {3.6972085849303837`*^9, 3.6972085906510277`*^9}, {
   3.6972089689595137`*^9, 3.697208992636352*^9}, {3.6972104674324093`*^9, 
   3.69721049328649*^9}, {3.697210783558774*^9, 3.697210790233101*^9}, {
   3.697214050023546*^9, 3.697214051504757*^9}, {3.6972145475698442`*^9, 
   3.697214548895707*^9}, {3.6972858230617857`*^9, 3.697285836927422*^9}, {
   3.697285950941065*^9, 3.6972859886333647`*^9}, 3.6972860697661963`*^9, {
   3.697286159266715*^9, 3.697286176391375*^9}, {3.697286208237568*^9, 
   3.697286348795824*^9}, {3.6972864680889874`*^9, 3.697286469971644*^9}, {
   3.697286633333444*^9, 3.69728664277316*^9}, {3.697286674708515*^9, 
   3.6972866827063723`*^9}, 3.697286754352797*^9, {3.697286833189722*^9, 
   3.6972868463487797`*^9}, {3.6972868969704933`*^9, 3.69728689853336*^9}, {
   3.6972869655564747`*^9, 3.6972869660247183`*^9}, 3.697287757876802*^9, {
   3.6973826751834173`*^9, 3.697382676515306*^9}, {3.697390409407323*^9, 
   3.69739043578743*^9}, {3.697396150979348*^9, 3.697396248684031*^9}, {
   3.697397453655072*^9, 3.6973974548588448`*^9}, 3.697465887154521*^9, {
   3.697465936134878*^9, 3.697465947169688*^9}, {3.6978131968750753`*^9, 
   3.697813210866246*^9}, {3.6978134267915382`*^9, 3.697813439180593*^9}, {
   3.697814877706914*^9, 3.697814878088146*^9}, {3.6978156340815897`*^9, 
   3.697815662128677*^9}, {3.697815706223925*^9, 3.6978157111660023`*^9}, {
   3.6978158024608583`*^9, 3.697815804362955*^9}, {3.6978158956919622`*^9, 
   3.6978159044359818`*^9}, {3.70446248861959*^9, 3.70446248916236*^9}, 
   3.704558304566155*^9, {3.726415782412339*^9, 3.7264158665464373`*^9}, {
   3.72641594485865*^9, 3.726415974261469*^9}, {3.726416047289454*^9, 
   3.72641608417819*^9}, {3.726422349750391*^9, 3.726422353660376*^9}, {
   3.730032552354741*^9, 3.730032553638109*^9}, {3.73003348385065*^9, 
   3.7300334993537693`*^9}, {3.730649461364875*^9, 
   3.7306494636459312`*^9}},ExpressionUUID->"20ce8dda-917c-453f-8fc9-\
d3b75378b069"]
}, Closed]],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"Load", " ", "Bruker", " ", "DTA", " ", "file", " ", 
    RowBox[{"(", 
     RowBox[{"1", "D", " ", "or", " ", "2", "D"}], ")"}]}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"$KernelCount", "\[LessEqual]", "1"}], ",", 
      RowBox[{
       RowBox[{
        RowBox[{"LaunchKernels", "[", "]"}], "//", "Quiet"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"ParallelEvaluate", "[", 
        RowBox[{"AppendTo", "[", 
         RowBox[{"$Path", ",", "mypath"}], "]"}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"ParallelEvaluate", "[", 
        RowBox[{
         RowBox[{"Needs", "[", "\"\<RLinkX`\>\"", "]"}], ";", 
         RowBox[{
          RowBox[{"InstallRX", "[", "]"}], "//", "Quiet"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"$OperatingSystem", "\[NotEqual]", "\"\<Windows\>\""}], ",", 
         
         RowBox[{
          RowBox[{"ParallelEvaluate", "[", 
           RowBox[{
            RowBox[{
            "REvaluate", "[", 
             "\"\<install.packages('nnls', \
repos='http://cran.wustl.edu/')\>\"", "]"}], ",", "1"}], "]"}], ";"}]}], 
        "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"ParallelEvaluate", "[", 
        RowBox[{
         RowBox[{"REvaluate", "[", "\"\<library(nnls)\>\"", "]"}], "//", 
         "Quiet"}], "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"filenames", "=", 
     RowBox[{"SystemDialogInput", "[", 
      RowBox[{"\"\<FileOpen\>\"", ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"Directory", "[", "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"\"\<Bruker .DTA\>\"", "\[Rule]", 
           RowBox[{"{", 
            RowBox[{"\"\<*.DTA\>\"", ",", "\"\<*.dta\>\""}], "}"}]}], 
          RowBox[{"(*", 
           RowBox[{",", 
            RowBox[{"\"\<DEER Analysis Files\>\"", "\[Rule]", 
             RowBox[{"{", "\"\<*.dat\>\"", "}"}]}]}], "*)"}], "}"}]}], 
        "}"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"UnsameQ", "[", 
       RowBox[{"filenames", ",", "$Canceled"}], "]"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "filenames", "]"}], ">", "0"}], ",", 
          RowBox[{"filename", "=", 
           RowBox[{"filenames", "[", 
            RowBox[{"[", "1", "]"}], "]"}]}], ",", 
          RowBox[{"filename", "=", "filenames"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"SetDirectory", "[", 
         RowBox[{"DirectoryName", "[", "filename", "]"}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"dir", "=", 
         RowBox[{"DirectoryName", "[", "filename", "]"}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"Switch", "[", 
         RowBox[{
          RowBox[{"ToUpperCase", "[", 
           RowBox[{"FileExtension", "[", "filename", "]"}], "]"}], ",", 
          "\[IndentingNewLine]", "\"\<DTA\>\"", ",", "\[IndentingNewLine]", 
          RowBox[{"{", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"yptss", "=", "0"}], ";", "\[IndentingNewLine]", 
            RowBox[{"xptss", "=", "0"}], ";", "\[IndentingNewLine]", 
            RowBox[{"reals", "=", 
             RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"imaginarys", "=", 
             RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"timeaxes", "=", 
             RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
            "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Length", "[", "filenames", "]"}], ">", "0"}], ",", 
              RowBox[{"filename", "=", "filenames"}], ",", 
              RowBox[{"filename", "=", 
               RowBox[{"{", "filenames", "}"}]}]}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"For", "[", 
             RowBox[{
              RowBox[{"j", "=", "1"}], ",", 
              RowBox[{"j", "\[LessEqual]", 
               RowBox[{"Length", "[", "filename", "]"}]}], ",", 
              RowBox[{"j", "++"}], ",", "\[IndentingNewLine]", 
              RowBox[{"{", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"SetDirectory", "[", 
                 RowBox[{"DirectoryName", "[", 
                  RowBox[{"filename", "[", 
                   RowBox[{"[", "j", "]"}], "]"}], "]"}], "]"}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"dir", "=", 
                 RowBox[{"DirectoryName", "[", 
                  RowBox[{"filename", "[", 
                   RowBox[{"[", "j", "]"}], "]"}], "]"}]}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"sample", "=", 
                 RowBox[{"FileBaseName", "[", 
                  RowBox[{"filename", "[", 
                   RowBox[{"[", "j", "]"}], "]"}], "]"}]}], ";", 
                "\[IndentingNewLine]", "\[IndentingNewLine]", 
                RowBox[{"data", "=", 
                 RowBox[{"BinaryReadList", "[", 
                  RowBox[{
                   RowBox[{"dir", "<>", "sample", "<>", "\"\<.DTA\>\""}], 
                   ",", "\"\<Real64\>\"", ",", 
                   RowBox[{"ByteOrdering", "\[RuleDelayed]", 
                    RowBox[{"+", "1"}]}]}], "]"}]}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"parameters", "=", 
                 RowBox[{
                  RowBox[{"Import", "[", 
                   RowBox[{"dir", "<>", "sample", "<>", "\"\<.DSC\>\""}], 
                   "]"}], "//", "ToString"}]}], ";", "\[IndentingNewLine]", 
                "\[IndentingNewLine]", 
                RowBox[{"xmin", "=", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"StringCases", "[", 
                    RowBox[{"parameters", ",", 
                    RowBox[{
                    RowBox[{"\"\<XMIN\t\>\"", "~~", 
                    RowBox[{"(", 
                    RowBox[{"x", ":", 
                    RowBox[{"NumberString", ".."}]}], ")"}]}], "->", "x"}]}], 
                    "]"}], "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "//", "ToExpression"}]}], 
                ";", "\[IndentingNewLine]", 
                RowBox[{"xwid", "=", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"StringCases", "[", 
                    RowBox[{"parameters", ",", 
                    RowBox[{
                    RowBox[{"\"\<XWID\t\>\"", "~~", 
                    RowBox[{"(", 
                    RowBox[{"x", ":", 
                    RowBox[{"NumberString", ".."}]}], ")"}]}], "->", "x"}]}], 
                    "]"}], "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "//", "ToExpression"}]}], 
                ";", "\[IndentingNewLine]", 
                RowBox[{"xpts", "=", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"StringCases", "[", 
                    RowBox[{"parameters", ",", 
                    RowBox[{
                    RowBox[{"\"\<XPTS\t\>\"", "~~", 
                    RowBox[{"(", 
                    RowBox[{"x", ":", 
                    RowBox[{"NumberString", ".."}]}], ")"}]}], "->", "x"}]}], 
                    "]"}], "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "//", "ToExpression"}]}], 
                ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
                RowBox[{"ypts", "=", 
                 RowBox[{
                  RowBox[{"StringCases", "[", 
                   RowBox[{"parameters", ",", 
                    RowBox[{
                    RowBox[{"\"\<YPTS\t\>\"", "~~", 
                    RowBox[{"(", 
                    RowBox[{"x", ":", 
                    RowBox[{"NumberString", ".."}]}], ")"}]}], "->", "x"}]}], 
                   "]"}], "//", "ToExpression"}]}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Length", "[", "ypts", "]"}], "\[Equal]", "0"}], 
                  ",", 
                  RowBox[{"ypts", "=", "1"}], ",", 
                  RowBox[{"ypts", "=", 
                   RowBox[{"ypts", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}]}], "]"}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"xptss", "+=", "xpts"}], ";", "\[IndentingNewLine]", 
                RowBox[{"yptss", "+=", "ypts"}], ";", "\[IndentingNewLine]", 
                "\[IndentingNewLine]", 
                RowBox[{"real", "=", 
                 RowBox[{"Table", "[", 
                  RowBox[{
                   RowBox[{"data", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], ",", 
                   RowBox[{"{", 
                    RowBox[{"i", ",", "1", ",", 
                    RowBox[{"Length", "[", "data", "]"}], ",", "2"}], "}"}]}],
                   "]"}]}], ";", "\[IndentingNewLine]", 
                RowBox[{"AppendTo", "[", 
                 RowBox[{"reals", ",", "real"}], "]"}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"imaginary", "=", 
                 RowBox[{"Table", "[", 
                  RowBox[{
                   RowBox[{"data", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], ",", 
                   RowBox[{"{", 
                    RowBox[{"i", ",", "2", ",", 
                    RowBox[{"Length", "[", "data", "]"}], ",", "2"}], "}"}]}],
                   "]"}]}], ";", "\[IndentingNewLine]", 
                RowBox[{"AppendTo", "[", 
                 RowBox[{"imaginarys", ",", "imaginary"}], "]"}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"timeaxis", "=", 
                 RowBox[{
                  RowBox[{"Table", "[", 
                   RowBox[{
                    RowBox[{"xmin", "+", 
                    RowBox[{"xwid", "*", 
                    RowBox[{"i", "/", 
                    RowBox[{"(", 
                    RowBox[{"xpts", "-", "1"}], ")"}]}]}]}], ",", 
                    RowBox[{"{", 
                    RowBox[{"i", ",", "0", ",", 
                    RowBox[{"(", 
                    RowBox[{"xpts", "-", "1"}], ")"}]}], "}"}]}], "]"}], "/", 
                  "1000"}]}], ";", "\[IndentingNewLine]", 
                RowBox[{"AppendTo", "[", 
                 RowBox[{"timeaxes", ",", "timeaxis"}], "]"}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"cutoff", "=", 
                 RowBox[{"Last", "[", "timeaxis", "]"}]}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"background", "=", 
                 RowBox[{"timeaxis", "[", 
                  RowBox[{"[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", "timeaxis", "]"}], "/", "2"}], "//",
                     "Round"}], "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
               "}"}]}], "]"}], ";", "\[IndentingNewLine]", 
            "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"timeaxis", "=", 
             RowBox[{"timeaxes", "[", 
              RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"ypts", "=", "yptss"}], ";", "\[IndentingNewLine]", 
            RowBox[{"real", "=", 
             RowBox[{"Flatten", "[", "reals", "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"imaginary", "=", 
             RowBox[{"Flatten", "[", "imaginarys", "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"real", "=", 
             RowBox[{"ArrayReshape", "[", 
              RowBox[{"real", ",", 
               RowBox[{"{", 
                RowBox[{"ypts", ",", "xpts"}], "}"}]}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"imaginary", "=", 
             RowBox[{"ArrayReshape", "[", 
              RowBox[{"imaginary", ",", 
               RowBox[{"{", 
                RowBox[{"ypts", ",", "xpts"}], "}"}]}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"nonzeros", "=", 
             RowBox[{"Flatten", "@", 
              RowBox[{"Position", "[", 
               RowBox[{
                RowBox[{"Unitize", "[", 
                 RowBox[{"real", "[", 
                  RowBox[{"[", 
                   RowBox[{"All", ",", 
                    RowBox[{"-", "1"}]}], "]"}], "]"}], "]"}], ",", "1"}], 
               "]"}]}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"real", "=", 
             RowBox[{"real", "[", 
              RowBox[{"[", 
               RowBox[{"nonzeros", ",", "All"}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"imaginary", "=", 
             RowBox[{"imaginary", "[", 
              RowBox[{"[", 
               RowBox[{"nonzeros", ",", "All"}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"keepers", "=", 
             RowBox[{"{", 
              RowBox[{"Table", "[", 
               RowBox[{"i", ",", 
                RowBox[{"{", 
                 RowBox[{"i", ",", 
                  RowBox[{"Length", "[", "nonzeros", "]"}]}], "}"}]}], "]"}], 
              "}"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
            "\[IndentingNewLine]", 
            RowBox[{"deleteTable", "=", 
             RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"phaseplot", "=", 
             RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
            "\[IndentingNewLine]", 
            RowBox[{"CreateDialog", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"Slider", "[", 
                    RowBox[{
                    RowBox[{"Dynamic", "[", "k", "]"}], ",", 
                    RowBox[{"Dynamic", "[", "keepers", "]"}]}], "]"}], ",", 
                   RowBox[{"Button", "[", 
                    RowBox[{
                    RowBox[{"\"\<Delete \>\"", 
                    RowBox[{"Dynamic", "[", 
                    RowBox[{"Round", "[", "k", "]"}], "]"}]}], ",", 
                    RowBox[{"keepers", "=", 
                    RowBox[{"DeleteCases", "[", 
                    RowBox[{"keepers", ",", 
                    RowBox[{"Round", "[", "k", "]"}], ",", "2"}], "]"}]}], 
                    ",", 
                    RowBox[{"Enabled", "\[Rule]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", "nonzeros", "]"}], "\[Equal]", 
                    "1"}], ",", "False", ",", "True"}], "]"}]}]}], "]"}], ",", 
                   RowBox[{"Button", "[", 
                    RowBox[{
                    "\"\<Average & Save\>\"", ",", "\[IndentingNewLine]", 
                    "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"keepers", "=", 
                    RowBox[{"Flatten", "[", "keepers", "]"}]}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"sumreal", "=", 
                    RowBox[{"Mean", "[", 
                    RowBox[{"real", "[", 
                    RowBox[{"[", 
                    RowBox[{"keepers", ",", "All"}], "]"}], "]"}], "]"}]}], 
                    ";", "\[IndentingNewLine]", 
                    RowBox[{"sumimaginary", "=", 
                    RowBox[{"Mean", "[", 
                    RowBox[{"imaginary", "[", 
                    RowBox[{"[", 
                    RowBox[{"keepers", ",", "All"}], "]"}], "]"}], "]"}]}], 
                    ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
                    RowBox[{"Export", "[", 
                    RowBox[{
                    RowBox[{"dir", "<>", "sample", "<>", "\"\<avg.txt\>\""}], 
                    ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Table", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"timeaxis", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "*", "1000"}], ",", 
                    RowBox[{"AccountingForm", "[", 
                    RowBox[{
                    RowBox[{"sumreal", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], ",", 
                    RowBox[{"NumberSigns", "\[Rule]", 
                    RowBox[{"{", 
                    RowBox[{"\"\<-\>\"", ",", "\"\<\>\""}], "}"}]}]}], "]"}], 
                    ",", 
                    RowBox[{"AccountingForm", "[", 
                    RowBox[{
                    RowBox[{"sumimaginary", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], ",", 
                    RowBox[{"NumberSigns", "\[Rule]", 
                    RowBox[{"{", 
                    RowBox[{"\"\<-\>\"", ",", "\"\<\>\""}], "}"}]}]}], 
                    "]"}]}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"i", ",", "1", ",", 
                    RowBox[{"Length", "[", "timeaxis", "]"}]}], "}"}]}], 
                    "]"}], "//", "TableForm"}], "//", "ToString"}]}], "]"}], 
                    ";", "\[IndentingNewLine]", 
                    RowBox[{"DialogReturn", "[", "]"}], ";"}]}], 
                    "\[IndentingNewLine]", "]"}]}], "}"}], ",", 
                 "\[IndentingNewLine]", 
                 RowBox[{"{", 
                  RowBox[{"Dynamic", "[", 
                   RowBox[{"Show", "[", 
                    RowBox[{
                    RowBox[{"ListPlot", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"timeaxis", ",", 
                    RowBox[{"real", "[", 
                    RowBox[{"[", 
                    RowBox[{"k", ",", "All"}], "]"}], "]"}]}], "}"}], 
                    "\[Transpose]"}], ",", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"timeaxis", ",", 
                    RowBox[{"imaginary", "[", 
                    RowBox[{"[", 
                    RowBox[{"k", ",", "All"}], "]"}], "]"}]}], "}"}], 
                    "\[Transpose]"}]}], "}"}], ",", 
                    RowBox[{"Joined", "\[Rule]", "True"}], ",", 
                    RowBox[{"PlotRange", "\[Rule]", 
                    RowBox[{"{", 
                    RowBox[{"All", ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Min", "[", "imaginary", "]"}], ",", 
                    RowBox[{"Max", "[", "real", "]"}]}], "}"}]}], "}"}]}]}], 
                    "]"}], ",", 
                    RowBox[{"ImageSize", "\[Rule]", "500"}]}], "]"}], "]"}], 
                  "}"}]}], "}"}], "//", "TableForm"}], ",", 
              RowBox[{"Modal", "\[Rule]", "True"}]}], "]"}], ";"}], 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
          "\"\<DAT\>\"", ",", "\[IndentingNewLine]", 
          RowBox[{"{", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"phaseplot", "=", 
             RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"(*", 
             RowBox[{
              RowBox[{"spc", "=", 
               RowBox[{"Import", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"DirectoryName", "[", "filename", "]"}], "<>", 
                  RowBox[{
                   RowBox[{"StringSplit", "[", 
                    RowBox[{
                    RowBox[{"FileBaseName", "[", "filename", "]"}], ",", 
                    RowBox[{"\"\<_\>\"", "<>", 
                    RowBox[{"Last", "[", 
                    RowBox[{"StringSplit", "[", 
                    RowBox[{
                    RowBox[{"FileBaseName", "[", "filename", "]"}], ",", 
                    "\"\<_\>\""}], "]"}], "]"}]}]}], "]"}], "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "<>", "\"\<_spc.dat\>\""}],
                  ",", "\"\<Data\>\""}], "]"}]}], ";"}], "*)"}], 
            "\[IndentingNewLine]", 
            RowBox[{"bckg", "=", 
             RowBox[{"Import", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"DirectoryName", "[", "filename", "]"}], "<>", 
                RowBox[{
                 RowBox[{"StringSplit", "[", 
                  RowBox[{
                   RowBox[{"FileBaseName", "[", "filename", "]"}], ",", 
                   RowBox[{"\"\<_\>\"", "<>", 
                    RowBox[{"Last", "[", 
                    RowBox[{"StringSplit", "[", 
                    RowBox[{
                    RowBox[{"FileBaseName", "[", "filename", "]"}], ",", 
                    "\"\<_\>\""}], "]"}], "]"}]}]}], "]"}], "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "<>", "\"\<_bckg.dat\>\""}], 
               ",", "\"\<Data\>\""}], "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"timeaxis", "=", 
             RowBox[{"bckg", "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"sumreal", "=", 
             RowBox[{"bckg", "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", "2"}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"sumimaginary", "=", 
             RowBox[{"bckg", "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", "4"}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"specfit", "=", 
             RowBox[{"Import", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"DirectoryName", "[", "filename", "]"}], "<>", 
                RowBox[{
                 RowBox[{"StringSplit", "[", 
                  RowBox[{
                   RowBox[{"FileBaseName", "[", "filename", "]"}], ",", 
                   RowBox[{"\"\<_\>\"", "<>", 
                    RowBox[{"Last", "[", 
                    RowBox[{"StringSplit", "[", 
                    RowBox[{
                    RowBox[{"FileBaseName", "[", "filename", "]"}], ",", 
                    "\"\<_\>\""}], "]"}], "]"}]}]}], "]"}], "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "<>", "\"\<_fit.dat\>\""}], 
               ",", "\"\<Data\>\""}], "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"distr", "=", 
             RowBox[{"Import", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"DirectoryName", "[", "filename", "]"}], "<>", 
                RowBox[{
                 RowBox[{"StringSplit", "[", 
                  RowBox[{
                   RowBox[{"FileBaseName", "[", "filename", "]"}], ",", 
                   RowBox[{"\"\<_\>\"", "<>", 
                    RowBox[{"Last", "[", 
                    RowBox[{"StringSplit", "[", 
                    RowBox[{
                    RowBox[{"FileBaseName", "[", "filename", "]"}], ",", 
                    "\"\<_\>\""}], "]"}], "]"}]}]}], "]"}], "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "<>", "\"\<_distr.dat\>\""}],
                ",", "\"\<Data\>\""}], "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"results", "=", 
             RowBox[{"Import", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"DirectoryName", "[", "filename", "]"}], "<>", 
                RowBox[{
                 RowBox[{"StringSplit", "[", 
                  RowBox[{
                   RowBox[{"FileBaseName", "[", "filename", "]"}], ",", 
                   RowBox[{"\"\<_\>\"", "<>", 
                    RowBox[{"Last", "[", 
                    RowBox[{"StringSplit", "[", 
                    RowBox[{
                    RowBox[{"FileBaseName", "[", "filename", "]"}], ",", 
                    "\"\<_\>\""}], "]"}], "]"}]}]}], "]"}], "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "<>", "\"\<_res.txt\>\""}], 
               ",", "\"\<Plaintext\>\""}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"zerooffset", "=", 
             RowBox[{
              RowBox[{
               RowBox[{"StringCases", "[", 
                RowBox[{"results", ",", 
                 RowBox[{
                  RowBox[{"\"\<Time shift: \>\"", "~~", 
                   RowBox[{"(", 
                    RowBox[{"x", ":", 
                    RowBox[{"NumberString", ".."}]}], ")"}]}], "->", "x"}], 
                 ",", "1"}], "]"}], "[", 
               RowBox[{"[", "1", "]"}], "]"}], "//", "ToExpression"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"zeropoint", "=", 
             RowBox[{
              RowBox[{"bckg", "[", 
               RowBox[{"[", 
                RowBox[{"1", ",", "1"}], "]"}], "]"}], "+", 
              RowBox[{"zerooffset", "/", "1000."}]}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"cutoff", "=", 
             RowBox[{
              RowBox[{
               RowBox[{"StringCases", "[", 
                RowBox[{"results", ",", 
                 RowBox[{
                  RowBox[{"\"\<Cutoff at : \>\"", "~~", 
                   RowBox[{"(", 
                    RowBox[{"x", ":", 
                    RowBox[{"NumberString", ".."}]}], ")"}]}], "->", "x"}], 
                 ",", "1"}], "]"}], "[", 
               RowBox[{"[", "1", "]"}], "]"}], "//", "ToExpression"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"cutoff", "=", 
             RowBox[{"cutoff", "/", "1000."}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"tempbg", "=", 
             RowBox[{
              RowBox[{"StringCases", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"StringCases", "[", 
                  RowBox[{"results", ",", 
                   RowBox[{
                   "\"\<Starting at : \>\"", "~~", "__", "~~", 
                    "\"\< ns\>\""}]}], "]"}], "[", 
                 RowBox[{"[", "1", "]"}], "]"}], ",", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"x", ":", 
                   RowBox[{"NumberString", ".."}]}], ")"}], "->", "x"}]}], 
               "]"}], "//", "ToExpression"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"background", "=", 
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"Length", "[", "tempbg", "]"}], "\[Equal]", "1"}], 
                ",", 
                RowBox[{"tempbg", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], ",", 
                RowBox[{
                 RowBox[{"tempbg", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "*", 
                 RowBox[{"10", "^", 
                  RowBox[{"tempbg", "[", 
                   RowBox[{"[", "2", "]"}], "]"}]}]}]}], "]"}], "//", 
              "Ceiling"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"background", "=", 
             RowBox[{"background", "/", "1000."}]}], ";"}], 
           "\[IndentingNewLine]", "\[IndentingNewLine]", "}"}]}], "]"}]}], 
       "\[IndentingNewLine]", "\[IndentingNewLine]", "}"}]}], "]"}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "filename", 
   "\[IndentingNewLine]", "\[IndentingNewLine]"}]}]], "Input",
 Editable->False,
 CellChangeTimes->{{3.683383597864489*^9, 3.683383815053611*^9}, 
   3.6833845392401447`*^9, {3.683384577861965*^9, 3.6833845956479816`*^9}, 
   3.683384628806945*^9, {3.683384879418499*^9, 3.68338487995296*^9}, {
   3.68338502291465*^9, 3.683385025153185*^9}, {3.683386038618548*^9, 
   3.6833860587259912`*^9}, {3.683387655079916*^9, 3.683387678532683*^9}, 
   3.683388630920466*^9, 3.68338877980499*^9, {3.683465591930499*^9, 
   3.683465595956872*^9}, {3.683466955209643*^9, 3.68346696001991*^9}, {
   3.683468386933749*^9, 3.683468392226512*^9}, {3.6846030164604053`*^9, 
   3.6846030215237293`*^9}, {3.684764225665112*^9, 3.684764230020007*^9}, {
   3.684771045086752*^9, 3.6847710487961807`*^9}, {3.684846221427847*^9, 
   3.684846226718133*^9}, {3.685450827593499*^9, 3.685450832148027*^9}, {
   3.68571372593286*^9, 3.685713731233832*^9}, {3.685714107792148*^9, 
   3.685714111914357*^9}, {3.6857233066617203`*^9, 3.6857233092205753`*^9}, {
   3.685723343864764*^9, 3.685723378053056*^9}, {3.6858026594342537`*^9, 
   3.685802672954506*^9}, {3.686315823327546*^9, 3.686315827442066*^9}, {
   3.6876196319468117`*^9, 3.687619652030287*^9}, {3.687711060155286*^9, 
   3.687711077163385*^9}, {3.689510310651847*^9, 3.689510317109808*^9}, {
   3.690122751310095*^9, 3.690122805625646*^9}, {3.690220679837681*^9, 
   3.690220698636282*^9}, {3.6902207685372334`*^9, 3.690220770321164*^9}, {
   3.690221301898567*^9, 3.690221325850656*^9}, {3.6902214334616013`*^9, 
   3.690221433625081*^9}, {3.690722973168584*^9, 3.6907229794497147`*^9}, {
   3.693842885330385*^9, 3.6938429029217243`*^9}, {3.695571848516593*^9, 
   3.695571849042305*^9}, {3.695571910710793*^9, 3.695571917399137*^9}, {
   3.6955719499277163`*^9, 3.695572040482073*^9}, {3.6973827667568197`*^9, 
   3.697382789173061*^9}, {3.697392500255384*^9, 3.697392500734383*^9}, {
   3.697392938634804*^9, 3.697392938905031*^9}, {3.697396274501915*^9, 
   3.697396278657549*^9}, {3.697814784723568*^9, 3.697814798219825*^9}, {
   3.697815913839323*^9, 3.6978159155730143`*^9}, {3.7010094186264973`*^9, 
   3.701009419196514*^9}, {3.7010803984289827`*^9, 3.701080421991549*^9}, {
   3.701096327450725*^9, 3.7010963276337633`*^9}, {3.7010964114311037`*^9, 
   3.7010964120696793`*^9}, {3.701104716783642*^9, 3.701104717027173*^9}, {
   3.7011047890538282`*^9, 3.70110478940449*^9}, {3.70162279277122*^9, 
   3.70162279414708*^9}, {3.701692132100109*^9, 3.701692224619534*^9}, {
   3.701692257527467*^9, 3.701692258857189*^9}, {3.702218073654994*^9, 
   3.7022181227936497`*^9}, 3.702218174526141*^9, 3.702221744348406*^9, {
   3.702305833612362*^9, 3.702305837460084*^9}, {3.703353347593355*^9, 
   3.703353348061067*^9}, {3.703422211313446*^9, 3.703422213244747*^9}, {
   3.7034254633836*^9, 3.703425463737115*^9}, {3.703425652858749*^9, 
   3.7034256533301153`*^9}, 3.703431252473151*^9, {3.704111171047226*^9, 
   3.704111194445167*^9}, 3.7041112378851013`*^9, {3.7041173123493834`*^9, 
   3.7041173262031116`*^9}, {3.704117653161001*^9, 3.704117685593018*^9}, {
   3.704117731132276*^9, 3.704117737727182*^9}, {3.7041177727489643`*^9, 
   3.704117789262786*^9}, {3.704117920570277*^9, 3.70411793575043*^9}, {
   3.704117991752524*^9, 3.704118037269142*^9}, 3.704462889948905*^9, 
   3.7046469102987003`*^9, {3.704646945536386*^9, 3.7046469550850067`*^9}, {
   3.704647066877028*^9, 3.704647265240258*^9}, {3.7046473081396093`*^9, 
   3.704647313150566*^9}, {3.704647347784828*^9, 3.7046473506378593`*^9}, 
   3.704647389724394*^9, {3.704647465907824*^9, 3.704647469452248*^9}, 
   3.7046475222569304`*^9, {3.704647752168502*^9, 3.704647827960772*^9}, {
   3.704647868059326*^9, 3.7046478983568563`*^9}, {3.7046479538908854`*^9, 
   3.704647959722481*^9}, 3.704648064840012*^9, {3.7046485505056877`*^9, 
   3.704648560237762*^9}, {3.704649218953898*^9, 3.7046493274045467`*^9}, {
   3.704732906757598*^9, 3.7047329155827503`*^9}, {3.7056786984075527`*^9, 
   3.705678701639741*^9}, {3.705678932764544*^9, 3.70567893783092*^9}, {
   3.705761202963007*^9, 3.705761261719981*^9}, {3.7057613361111927`*^9, 
   3.705761340081389*^9}, {3.705761467813786*^9, 3.7057614785188503`*^9}, {
   3.705761510894369*^9, 3.705761516247744*^9}, 3.705761621244769*^9, {
   3.705761675951453*^9, 3.7057617429380817`*^9}, {3.705761800121423*^9, 
   3.705761830901469*^9}, 3.705764568937523*^9, {3.7057657240482388`*^9, 
   3.70576578853765*^9}, 3.705768283342256*^9, 3.70576848050642*^9, {
   3.707668234795381*^9, 3.707668247158929*^9}, 3.707668308362528*^9, {
   3.7083589071738243`*^9, 3.7083589396974*^9}, {3.7101776603883963`*^9, 
   3.7101778691457787`*^9}, {3.710178415562505*^9, 3.710178447993338*^9}, {
   3.710178619013958*^9, 3.7101786322270317`*^9}, {3.710689877410039*^9, 
   3.7106898845013866`*^9}, {3.710692965083097*^9, 3.710692975635351*^9}, {
   3.710777800922592*^9, 3.710777807252507*^9}, {3.711813850246279*^9, 
   3.7118138557260523`*^9}, 3.726327020994959*^9, {3.7263283550414057`*^9, 
   3.7263283563768263`*^9}, {3.726332417950757*^9, 3.726332492171727*^9}, {
   3.7263325251447887`*^9, 3.7263325729363737`*^9}, {3.726332693529175*^9, 
   3.726332738616345*^9}, {3.7263328789709272`*^9, 3.726332923282217*^9}, {
   3.726333035533766*^9, 3.726333049746966*^9}, {3.72633311219853*^9, 
   3.72633311465042*^9}, 3.7263335622487173`*^9, {3.726333928379712*^9, 
   3.726333933778945*^9}, {3.726333977993568*^9, 3.726334017596283*^9}, {
   3.726334142823696*^9, 3.726334171030662*^9}, 3.726334263861754*^9, {
   3.726334577706594*^9, 3.7263345809560337`*^9}, {3.726334646839542*^9, 
   3.72633465125774*^9}, {3.726334688263659*^9, 3.7263347035647984`*^9}, {
   3.726334918446047*^9, 3.7263349266258383`*^9}, {3.7263353973118258`*^9, 
   3.7263354339550056`*^9}, {3.726336051144755*^9, 3.7263360845699778`*^9}, 
   3.7263361329226837`*^9, {3.7263368163909807`*^9, 3.726336831180099*^9}, 
   3.7264157770314617`*^9, {3.726416090339319*^9, 3.726416093784912*^9}, {
   3.726416190213902*^9, 3.726416193016234*^9}, {3.726422217958493*^9, 
   3.7264222596620483`*^9}, {3.726422305565041*^9, 3.7264223115465384`*^9}, {
   3.726422370994005*^9, 3.726422412961351*^9}, {3.7264226754076157`*^9, 
   3.726422682442721*^9}, 3.726497961645361*^9, {3.726498049288156*^9, 
   3.726498058591702*^9}, {3.72986268009814*^9, 3.7298626814741573`*^9}, {
   3.7310822027768717`*^9, 3.731082203242456*^9}, {3.737204541603265*^9, 
   3.737204569150277*^9}, 
   3.737204614661487*^9},ExpressionUUID->"fbc8310c-f693-408f-9990-\
5bb2907de379"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"signal", "=", 
   RowBox[{"sumreal", "+", 
    RowBox[{"\[ImaginaryI]", "*", "sumimaginary"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"forphasing", "=", 
   RowBox[{"signal", "[", 
    RowBox[{"[", 
     RowBox[{
      RowBox[{"Round", "[", 
       RowBox[{
        RowBox[{"Length", "[", "signal", "]"}], "/", "8"}], "]"}], ";;", 
      RowBox[{"First", "@", 
       RowBox[{"Nearest", "[", 
        RowBox[{
         RowBox[{"timeaxis", "\[Rule]", "Automatic"}], ",", "cutoff"}], 
        "]"}]}]}], "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"phase", "=", 
    RowBox[{"x", "/.", 
     RowBox[{
      RowBox[{"NMinimize", "[", 
       RowBox[{
        RowBox[{"Abs", "[", 
         RowBox[{"Mean", "[", 
          RowBox[{"Im", "[", 
           RowBox[{"forphasing", "*", 
            RowBox[{"Exp", "[", 
             RowBox[{"\[ImaginaryI]", "*", "x"}], "]"}]}], "]"}], "]"}], 
         "]"}], ",", "x"}], "]"}], "[", 
      RowBox[{"[", "2", "]"}], "]"}]}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"{", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"Slider", "[", 
       RowBox[{
        RowBox[{"Dynamic", "[", "phase", "]"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"-", "\[Pi]"}], ",", "\[Pi]", ",", "0.001"}], "}"}]}], 
       "]"}], ",", 
      RowBox[{"Dynamic", "[", 
       RowBox[{
        RowBox[{"ToString", "[", 
         RowBox[{"NumberForm", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"phase", "/", "\[Pi]"}], "*", "180"}], ",", 
           RowBox[{"{", 
            RowBox[{"2", ",", "2"}], "}"}]}], "]"}], "]"}], "<>", 
        "\"\<\.ba\>\""}], "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"Slider", "[", 
       RowBox[{
        RowBox[{"Dynamic", "[", "cutoff", "]"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"First", "[", "timeaxis", "]"}], ",", 
          RowBox[{"Last", "[", "timeaxis", "]"}], ",", 
          RowBox[{
           RowBox[{"timeaxis", "[", 
            RowBox[{"[", "2", "]"}], "]"}], "-", 
           RowBox[{"timeaxis", "[", 
            RowBox[{"[", "1", "]"}], "]"}]}]}], "}"}]}], "]"}], ",", 
      RowBox[{"InputField", "[", 
       RowBox[{
        RowBox[{"Dynamic", "[", "cutoff", "]"}], ",", 
        RowBox[{"FieldSize", "\[Rule]", "4"}]}], "]"}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"Button", "[", 
       RowBox[{"\"\<Rephase\>\"", ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"cutoff", "=", 
          RowBox[{"First", "@", 
           RowBox[{"Nearest", "[", 
            RowBox[{"timeaxis", ",", "cutoff"}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"background", "=", 
          RowBox[{"First", "@", 
           RowBox[{"Nearest", "[", 
            RowBox[{"timeaxis", ",", 
             RowBox[{"cutoff", "/", "2"}]}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"forphasing", "=", 
          RowBox[{"signal", "[", 
           RowBox[{"[", 
            RowBox[{
             RowBox[{"Round", "[", 
              RowBox[{
               RowBox[{"Length", "[", "signal", "]"}], "/", "8"}], "]"}], ";;", 
             RowBox[{
              RowBox[{"FirstPosition", "[", 
               RowBox[{"timeaxis", ",", "cutoff"}], "]"}], "[", 
              RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"phase", "=", 
          RowBox[{"x", "/.", 
           RowBox[{
            RowBox[{"NMinimize", "[", 
             RowBox[{
              RowBox[{"Abs", "[", 
               RowBox[{"Mean", "[", 
                RowBox[{"Im", "[", 
                 RowBox[{"forphasing", "*", 
                  RowBox[{"Exp", "[", 
                   RowBox[{"\[ImaginaryI]", "*", "x"}], "]"}]}], "]"}], "]"}],
                "]"}], ",", "x"}], "]"}], "[", 
            RowBox[{"[", "2", "]"}], "]"}]}]}], ";"}]}], "]"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"Button", "[", 
       RowBox[{"\"\<Build Kernel\>\"", ",", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{"Initialize", " ", "kernel", " ", "et", " ", "al"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Clear", "[", "bckg", "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"bckg", "=", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"timeaxis", ",", 
             RowBox[{
              RowBox[{"Re", "[", 
               RowBox[{"signal", "*", 
                RowBox[{"Exp", "[", 
                 RowBox[{"\[ImaginaryI]", "*", "phase"}], "]"}]}], "]"}], "/", 
              RowBox[{"Max", "[", 
               RowBox[{"Re", "[", 
                RowBox[{"signal", "*", 
                 RowBox[{"Exp", "[", 
                  RowBox[{"\[ImaginaryI]", "*", "phase"}], "]"}]}], "]"}], 
               "]"}]}]}], "}"}], "\[Transpose]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"kernelstart", "=", "1.5"}], ";", "\[IndentingNewLine]", 
         RowBox[{"kernelend", "=", "10."}], ";", "\[IndentingNewLine]", 
         RowBox[{"dt", "=", 
          RowBox[{
           RowBox[{"bckg", "[", 
            RowBox[{"[", 
             RowBox[{"2", ",", "1"}], "]"}], "]"}], "-", 
           RowBox[{"bckg", "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "1"}], "]"}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"r", ",", "t", ",", "kernel", ",", "Lmatrix"}], "}"}], "=", 
          RowBox[{"buildkernels", "[", 
           RowBox[{"512", ",", "kernelstart", ",", "kernelend", ",", 
            RowBox[{"Max", "[", 
             RowBox[{"bckg", "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", "1"}], "]"}], "]"}], "]"}], ",", "dt"}], 
           "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"tbackup", "=", "t"}], ";", "\[IndentingNewLine]", 
         RowBox[{"kernelbackup", "=", "kernel"}], ";", "\[IndentingNewLine]", 
         
         RowBox[{"alphas", "=", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"10", "^", 
             RowBox[{"-", "i"}]}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", "4", ",", 
              RowBox[{"-", "6"}], ",", 
              RowBox[{"-", ".2"}]}], "}"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"hMats", "=", 
          RowBox[{"ParallelTable", "[", 
           RowBox[{
            RowBox[{"Diagonal", "[", 
             RowBox[{"hMat", "[", 
              RowBox[{"i", ",", "kernel", ",", "Lmatrix"}], "]"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", "alphas"}], "}"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"hMatsbackup", "=", "hMats"}], ";", "\[IndentingNewLine]", 
         "\[IndentingNewLine]", 
         RowBox[{"normMethod", "=", "\"\<Gaussian Fit\>\""}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"bgmodel", "=", "\"\<3D\>\""}], ";", "\[IndentingNewLine]", 
         RowBox[{"fitwindowEnd", "=", 
          RowBox[{"First", "@", 
           RowBox[{"Nearest", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"bckg", "[", 
               RowBox[{"[", 
                RowBox[{"All", ",", "1"}], "]"}], "]"}], "\[Rule]", 
              "Automatic"}], ",", 
             RowBox[{"-", 
              RowBox[{"bckg", "[", 
               RowBox[{"[", 
                RowBox[{"1", ",", "1"}], "]"}], "]"}]}]}], "]"}]}]}], ";"}]}],
        "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"fitwindowEnd", "=", "40"}], ";"}], "*)"}], 
       "\[IndentingNewLine]", "]"}]}], "}"}]}], "}"}], "//", 
  "TableForm"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"{", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"Dynamic", "[", 
      RowBox[{"Show", "[", 
       RowBox[{
        RowBox[{"ListPlot", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"{", 
              RowBox[{"timeaxis", ",", 
               RowBox[{"sumreal", "/", 
                RowBox[{"Max", "[", "sumreal", "]"}]}]}], "}"}], 
             "\[Transpose]"}], ",", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"timeaxis", ",", 
               RowBox[{
                RowBox[{"Re", "[", 
                 RowBox[{"signal", "*", 
                  RowBox[{"Exp", "[", 
                   RowBox[{"\[ImaginaryI]", "*", "phase"}], "]"}]}], "]"}], 
                "/", 
                RowBox[{"Max", "[", 
                 RowBox[{"Re", "[", 
                  RowBox[{"signal", "*", 
                   RowBox[{"Exp", "[", 
                    RowBox[{"\[ImaginaryI]", "*", "phase"}], "]"}]}], "]"}], 
                 "]"}]}]}], "}"}], "\[Transpose]"}]}], "}"}], ",", 
          RowBox[{"ImageSize", "\[Rule]", "500"}], ",", 
          RowBox[{"Joined", "\[Rule]", "True"}], ",", 
          RowBox[{"PlotRange", "\[Rule]", 
           RowBox[{"{", 
            RowBox[{"All", ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"Min", "[", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"sumreal", "/", 
                   RowBox[{"Max", "[", "sumreal", "]"}]}], ",", 
                  RowBox[{
                   RowBox[{"Re", "[", 
                    RowBox[{"signal", "*", 
                    RowBox[{"Exp", "[", 
                    RowBox[{"\[ImaginaryI]", "*", "phase"}], "]"}]}], "]"}], 
                   "/", 
                   RowBox[{"Max", "[", 
                    RowBox[{"Re", "[", 
                    RowBox[{"signal", "*", 
                    RowBox[{"Exp", "[", 
                    RowBox[{"\[ImaginaryI]", "*", "phase"}], "]"}]}], "]"}], 
                    "]"}]}]}], "}"}], "]"}], ",", "1"}], "}"}]}], "}"}]}]}], 
         "]"}], ",", 
        RowBox[{"Graphics", "[", 
         RowBox[{"{", 
          RowBox[{"Red", ",", 
           RowBox[{"Line", "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"cutoff", ",", "0"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"cutoff", ",", "1"}], "}"}]}], "}"}], "]"}]}], "}"}], 
         "]"}], ",", 
        RowBox[{"PlotRange", "\[Rule]", 
         RowBox[{"{", 
          RowBox[{"All", ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Min", "[", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"sumreal", "/", 
                 RowBox[{"Max", "[", "sumreal", "]"}]}], ",", 
                RowBox[{
                 RowBox[{"Re", "[", 
                  RowBox[{"signal", "*", 
                   RowBox[{"Exp", "[", 
                    RowBox[{"\[ImaginaryI]", "*", "phase"}], "]"}]}], "]"}], 
                 "/", 
                 RowBox[{"Max", "[", 
                  RowBox[{"Re", "[", 
                   RowBox[{"signal", "*", 
                    RowBox[{"Exp", "[", 
                    RowBox[{"\[ImaginaryI]", "*", "phase"}], "]"}]}], "]"}], 
                  "]"}]}]}], "}"}], "]"}], ",", "1"}], "}"}]}], "}"}]}]}], 
       "]"}], "]"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Dynamic", "[", 
      RowBox[{"Show", "[", 
       RowBox[{
        RowBox[{"ListPlot", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"{", 
              RowBox[{"timeaxis", ",", 
               RowBox[{"sumimaginary", "/", 
                RowBox[{"Max", "[", "sumreal", "]"}]}]}], "}"}], 
             "\[Transpose]"}], ",", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"timeaxis", ",", 
               RowBox[{
                RowBox[{"Im", "[", 
                 RowBox[{"signal", "*", 
                  RowBox[{"Exp", "[", 
                   RowBox[{"\[ImaginaryI]", "*", "phase"}], "]"}]}], "]"}], 
                "/", 
                RowBox[{"Max", "[", "sumreal", "]"}]}]}], "}"}], 
             "\[Transpose]"}]}], "}"}], ",", 
          RowBox[{"ImageSize", "\[Rule]", "500"}], ",", 
          RowBox[{"Joined", "\[Rule]", "True"}], ",", 
          RowBox[{"PlotRange", "\[Rule]", 
           RowBox[{"{", 
            RowBox[{"All", ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"Min", "[", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"sumimaginary", "/", 
                   RowBox[{"Max", "[", "sumreal", "]"}]}], ",", 
                  RowBox[{
                   RowBox[{"Im", "[", 
                    RowBox[{"signal", "*", 
                    RowBox[{"Exp", "[", 
                    RowBox[{"\[ImaginaryI]", "*", "phase"}], "]"}]}], "]"}], 
                   "/", 
                   RowBox[{"Max", "[", "sumreal", "]"}]}]}], "}"}], "]"}], 
               ",", 
               RowBox[{"Max", "[", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"sumimaginary", "/", 
                   RowBox[{"Max", "[", "sumreal", "]"}]}], ",", 
                  RowBox[{
                   RowBox[{"Im", "[", 
                    RowBox[{"signal", "*", 
                    RowBox[{"Exp", "[", 
                    RowBox[{"\[ImaginaryI]", "*", "phase"}], "]"}]}], "]"}], 
                   "/", 
                   RowBox[{"Max", "[", "sumreal", "]"}]}]}], "}"}], "]"}]}], 
              "}"}]}], "}"}]}]}], "]"}], ",", 
        RowBox[{"Graphics", "[", 
         RowBox[{"{", 
          RowBox[{"Red", ",", 
           RowBox[{"Line", "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"cutoff", ",", 
                RowBox[{"Min", "[", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"sumimaginary", "/", 
                    RowBox[{"Max", "[", "sumreal", "]"}]}], ",", 
                   RowBox[{
                    RowBox[{"Im", "[", 
                    RowBox[{"signal", "*", 
                    RowBox[{"Exp", "[", 
                    RowBox[{"\[ImaginaryI]", "*", "phase"}], "]"}]}], "]"}], 
                    "/", 
                    RowBox[{"Max", "[", "sumreal", "]"}]}]}], "}"}], "]"}]}], 
               "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"cutoff", ",", 
                RowBox[{"Max", "[", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"sumimaginary", "/", 
                    RowBox[{"Max", "[", "sumreal", "]"}]}], ",", 
                   RowBox[{
                    RowBox[{"Im", "[", 
                    RowBox[{"signal", "*", 
                    RowBox[{"Exp", "[", 
                    RowBox[{"\[ImaginaryI]", "*", "phase"}], "]"}]}], "]"}], 
                    "/", 
                    RowBox[{"Max", "[", "sumreal", "]"}]}]}], "}"}], "]"}]}], 
               "}"}]}], "}"}], "]"}]}], "}"}], "]"}]}], "]"}], "]"}]}], "}"}],
    "}"}], "//", "TableForm"}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.703951676276207*^9, 3.703951936447393*^9}, 
   3.703952014883828*^9, {3.7039520467718277`*^9, 3.703952264859277*^9}, {
   3.70395231367332*^9, 3.703952315641844*^9}, {3.704025106885116*^9, 
   3.704025107262526*^9}, {3.704025727625677*^9, 3.704025750753788*^9}, {
   3.704031453860615*^9, 3.704031538177329*^9}, {3.704031875617116*^9, 
   3.7040319629196997`*^9}, {3.704032003125945*^9, 3.704032115317154*^9}, {
   3.704032158998612*^9, 3.70403215971229*^9}, 3.7040323426217957`*^9, {
   3.704032468055706*^9, 3.704032502700585*^9}, {3.704032562583961*^9, 
   3.7040325652346687`*^9}, {3.704036277218425*^9, 3.7040362846473627`*^9}, {
   3.704036323022978*^9, 3.704036338312142*^9}, {3.704036622723011*^9, 
   3.704036626370624*^9}, {3.7040367360163603`*^9, 3.7040367363028812`*^9}, {
   3.704036774131225*^9, 3.704036774612776*^9}, {3.704036934882298*^9, 
   3.704036965649467*^9}, {3.704036996101655*^9, 3.7040369993415127`*^9}, {
   3.704037139361845*^9, 3.704037172142953*^9}, 3.7040372210244083`*^9, {
   3.704037373037895*^9, 3.70403738123216*^9}, {3.704039343272292*^9, 
   3.7040393520818233`*^9}, {3.7040409010000467`*^9, 3.704040944500559*^9}, {
   3.704040976448084*^9, 3.704040976635549*^9}, {3.705764666563012*^9, 
   3.705764683663761*^9}, {3.705764721720652*^9, 3.70576472594676*^9}, {
   3.705764760124398*^9, 3.705764810629027*^9}, {3.70576484892377*^9, 
   3.705764903772023*^9}, {3.705765021326915*^9, 3.705765027457604*^9}, 
   3.705765063382627*^9, {3.7057658727906837`*^9, 3.70576587347254*^9}, 
   3.705766208684095*^9, {3.705766276652424*^9, 3.70576628383248*^9}, {
   3.705766367172783*^9, 3.705766426213572*^9}, {3.705766507946435*^9, 
   3.7057666314461184`*^9}, {3.705767365810707*^9, 3.705767366246985*^9}, {
   3.705767424516863*^9, 3.705767430488751*^9}, {3.705767485436429*^9, 
   3.705767501804524*^9}, {3.7057675688754473`*^9, 3.705767570493985*^9}, {
   3.7057676821925*^9, 3.705767682562056*^9}, 3.7057677422422667`*^9, {
   3.705770199728578*^9, 3.705770230496366*^9}, {3.713015294196291*^9, 
   3.713015302019981*^9}, {3.729862792328405*^9, 3.7298627926895313`*^9}, {
   3.731773064101584*^9, 3.731773107535523*^9}, {3.73177333747683*^9, 
   3.731773343039016*^9}, {3.7317736257683496`*^9, 3.7317736266884212`*^9}, {
   3.731867598386838*^9, 3.731867616178473*^9}, 3.732536339452145*^9, {
   3.7325367713914967`*^9, 3.732536780942292*^9}, {3.737380325673362*^9, 
   3.737380354289424*^9}},ExpressionUUID->"ec16acea-8cea-45ed-bd32-\
5dd90a7d3dad"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"initial", " ", "fit"}], ",", " ", 
    RowBox[{"finding", " ", "spectrum", " ", "start"}]}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"zerorange", "=", 
     RowBox[{"2", ";;", "fitwindowEnd"}]}], ";"}], " ", 
   RowBox[{"(*", 
    RowBox[{
    "window", " ", "for", " ", "finding", " ", "the", " ", "zero", " ", 
     "point"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"noisestd", "=", 
      RowBox[{"StandardDeviation", "[", 
       RowBox[{
        RowBox[{"bckg", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", "2"}], "]"}], "]"}], "-", 
        RowBox[{"GaussianFilter", "[", 
         RowBox[{
          RowBox[{"bckg", "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", "2"}], "]"}], "]"}], ",", "10"}], "]"}]}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"bckg", "=", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"bckg", "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", 
         RowBox[{
          RowBox[{"bckg", "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", "2"}], "]"}], "]"}], "+", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"RandomReal", "[", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{"-", "1.5"}], "noisestd"}], ",", 
               RowBox[{"1.5", "noisestd"}]}], "}"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"Length", "[", "bckg", "]"}], "}"}]}], "]"}]}]}], "}"}], 
       "\[Transpose]"}]}], ";"}], "*)"}], 
   RowBox[{"(*", 
    RowBox[{"Add", " ", "Noise"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"zeropeak", "=", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"bckg", "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", 
         RowBox[{"bckg", "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "2"}], "]"}], "]"}]}], "}"}], "\[Transpose]"}],
       "[", 
      RowBox[{"[", "zerorange", "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   
   RowBox[{
    RowBox[{"fitresult", "=", 
     RowBox[{"gaussianmodelzero", "[", 
      RowBox[{"zeropeak", ",", 
       RowBox[{"{", 
        RowBox[{"{", 
         RowBox[{"1", ",", "0"}], "}"}], "}"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"dataconfig", "=", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"\[Mu]", "[", "#", "]"}], ",", 
         RowBox[{"A", "[", "#", "]"}], ",", 
         RowBox[{"\[Sigma]", "[", "#", "]"}]}], "}"}], "&"}], "/@", 
      RowBox[{"Range", "[", 
       RowBox[{"Length", "[", 
        RowBox[{"{", 
         RowBox[{"{", 
          RowBox[{"1", ",", "0"}], "}"}], "}"}], "]"}], "]"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"zerogaussian", "=", 
     RowBox[{"Total", "@", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"peakfunc", "[", 
           RowBox[{"##", ",", "x"}], "]"}], "&"}], "@@@", "dataconfig"}], "/.",
         "fitresult"}], ")"}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"filteredpeak", "=", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"bckg", "[", 
         RowBox[{"[", 
          RowBox[{"zerorange", ",", "1"}], "]"}], "]"}], ",", 
        RowBox[{"zerogaussian", "/.", 
         RowBox[{"x", "->", 
          RowBox[{"bckg", "[", 
           RowBox[{"[", 
            RowBox[{"zerorange", ",", "1"}], "]"}], "]"}]}]}]}], "}"}], 
      "\[Transpose]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Switch", "[", 
     RowBox[{
     "normMethod", ",", "\[IndentingNewLine]", "\"\<Gaussian Fit\>\"", ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"zeropoint", "=", 
        RowBox[{
         RowBox[{"\[Mu]", "[", "1", "]"}], "/.", "fitresult"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"zeroamp", "=", 
        RowBox[{
         RowBox[{"A", "[", "1", "]"}], "/.", "fitresult"}]}], ";"}], 
      "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
      "\"\<Gaussian Center, Data Maximum Amp\>\"", ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"zeropoint", "=", 
        RowBox[{
         RowBox[{"\[Mu]", "[", "1", "]"}], "/.", "fitresult"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"zeroamp", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"bckg", "[", 
           RowBox[{"[", 
            RowBox[{"#", ",", "2"}], "]"}], "]"}], "&"}], "@", 
         RowBox[{"First", "@", 
          RowBox[{"Nearest", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"bckg", "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", "1"}], "]"}], "]"}], "\[Rule]", 
             "Automatic"}], ",", "zeropoint"}], "]"}]}]}]}], ";"}], 
      "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
      "\"\<Data Max Center, Data Maximum Amp\>\"", ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"zeropoint", "=", 
        RowBox[{
         RowBox[{"MaximalBy", "[", 
          RowBox[{"bckg", ",", "Last"}], "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"1", ",", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"zeroamp", "=", 
        RowBox[{
         RowBox[{"MaximalBy", "[", 
          RowBox[{"bckg", ",", "Last"}], "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"1", ",", "2"}], "]"}], "]"}]}], ";"}]}], 
     "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"waveformrange", "=", 
     RowBox[{"getrange", "[", 
      RowBox[{
       RowBox[{"bckg", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", "zeropoint", ",", 
       "cutoff"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"bckgrange", "=", 
     RowBox[{"getrange", "[", 
      RowBox[{
       RowBox[{"bckg", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", "background", ",", 
       "cutoff"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Switch", "[", 
     RowBox[{
     "bgmodel", ",", "\[IndentingNewLine]", "\"\<3D\>\"", ",", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"3", "d", " ", "dimensionality"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"bckgmodel", "=", 
        RowBox[{"b", "*", 
         RowBox[{"Exp", "[", 
          RowBox[{
           RowBox[{"-", "x"}], "/", "c"}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"constraints", "=", 
        RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"modelparams", "=", 
        RowBox[{"{", 
         RowBox[{"b", ",", "c"}], "}"}]}], ";"}], "\[IndentingNewLine]", ",", 
      "\[IndentingNewLine]", "\"\<Fractal\>\"", ",", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"fit", " ", "dimensionality"}], "*)"}], "\[IndentingNewLine]", 
      
      RowBox[{
       RowBox[{"bckgmodel", "=", 
        RowBox[{"b", "*", 
         RowBox[{"Exp", "[", 
          RowBox[{
           RowBox[{"-", 
            RowBox[{"x", "^", 
             RowBox[{"(", 
              RowBox[{"d", "/", "3"}], ")"}]}]}], "/", "c"}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"constraints", "=", 
        RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"modelparams", "=", 
        RowBox[{"{", 
         RowBox[{"b", ",", "c", ",", "d"}], "}"}]}], ";"}], 
      "\[IndentingNewLine]", ",", "\[IndentingNewLine]", "\"\<Offset\>\"", 
      ",", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"3", "D", " ", "with", " ", "offset"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"bckgmodel", "=", 
        RowBox[{"a", "+", 
         RowBox[{"b", "*", 
          RowBox[{"Exp", "[", 
           RowBox[{
            RowBox[{"-", "x"}], "/", "c"}], "]"}]}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"constraints", "=", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"b", ">", "0"}], ",", 
          RowBox[{"c", ">", "0"}]}], "}"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"modelparams", "=", 
        RowBox[{"{", 
         RowBox[{"a", ",", "b", ",", "c"}], "}"}]}], ";"}]}], 
     "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"bckgfit", "=", 
     RowBox[{
      RowBox[{"FindFit", "[", 
       RowBox[{
        RowBox[{"bckg", "[", 
         RowBox[{"[", "bckgrange", "]"}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"bckgmodel", ",", "constraints"}], "}"}], ",", "modelparams",
         ",", "x"}], "]"}], "//", "Quiet"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"bckgtable", "=", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{"#", ",", 
          RowBox[{
           RowBox[{"bckgmodel", "/.", "bckgfit"}], "/.", 
           RowBox[{"x", "\[Rule]", "#"}]}]}], "}"}], "\[Transpose]"}], "&"}], 
      "@", 
      RowBox[{"bckg", "[", 
       RowBox[{"[", 
        RowBox[{"All", ",", "1"}], "]"}], "]"}]}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"RESHAPE", " ", "KERNEL"}], ",", " ", "T"}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"Dimensions", "[", "kernel", "]"}], "[", 
        RowBox[{"[", "1", "]"}], "]"}], "!=", 
       RowBox[{"Length", "[", 
        RowBox[{"bckg", "[", 
         RowBox[{"[", "waveformrange", "]"}], "]"}], "]"}]}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"kernel", "=", "kernelbackup"}], ";", "\[IndentingNewLine]", 
        RowBox[{"t", "=", "tbackup"}], ";", "\[IndentingNewLine]", 
        RowBox[{"kernel", "=", 
         RowBox[{"kernel", "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{"1", ";;", 
             RowBox[{"Length", "[", 
              RowBox[{"bckg", "[", 
               RowBox[{"[", "waveformrange", "]"}], "]"}], "]"}]}], ",", 
            "All"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", " ", 
        RowBox[{"t", "=", 
         RowBox[{"t", "[", 
          RowBox[{"[", 
           RowBox[{"1", ";;", 
            RowBox[{"Length", "[", 
             RowBox[{"bckg", "[", 
              RowBox[{"[", "waveformrange", "]"}], "]"}], "]"}]}], "]"}], 
          "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"hMats", "=", "hMatsbackup"}], ";", "\[IndentingNewLine]", 
        RowBox[{"hMats", "=", 
         RowBox[{"hMats", "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", 
            RowBox[{"1", ";;", 
             RowBox[{"Length", "[", 
              RowBox[{"bckg", "[", 
               RowBox[{"[", "waveformrange", "]"}], "]"}], "]"}]}]}], "]"}], 
          "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
       ")"}]}], "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"zeroamp", "=", "0.99923"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"waveform", "=", 
     RowBox[{"backgroundCorrect", "[", 
      RowBox[{
       RowBox[{"bckg", "[", 
        RowBox[{"[", 
         RowBox[{"waveformrange", ",", "2"}], "]"}], "]"}], ",", 
       RowBox[{"bckgtable", "[", 
        RowBox[{"[", 
         RowBox[{"waveformrange", ",", "2"}], "]"}], "]"}], ",", "zeroamp"}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"myepilog", "=", 
     RowBox[{"{", 
      RowBox[{"Green", ",", 
       RowBox[{"Line", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"zeropoint", ",", 
            RowBox[{"Min", "[", 
             RowBox[{"zeropeak", "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", "2"}], "]"}], "]"}], "]"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"zeropoint", ",", 
            RowBox[{"Max", "[", 
             RowBox[{"bckg", "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", "2"}], "]"}], "]"}], "]"}]}], "}"}]}], 
         "}"}], "]"}], ",", 
       RowBox[{"PointSize", "[", "Large", "]"}], ",", "Red", ",", 
       RowBox[{"Point", "[", 
        RowBox[{"{", 
         RowBox[{"zeropoint", ",", "zeroamp"}], "}"}], "]"}]}], "}"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"zeropeakplot", "=", 
     RowBox[{"labelT", "@", 
      RowBox[{"specPlot", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"zeropeak", ",", "filteredpeak"}], "}"}], ",", 
        RowBox[{"AxesOrigin", "\[Rule]", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"zeropeak", "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "1"}], "]"}], "]"}], ",", 
           RowBox[{"Min", "[", 
            RowBox[{"zeropeak", "[", 
             RowBox[{"[", 
              RowBox[{"All", ",", "2"}], "]"}], "]"}], "]"}]}], "}"}]}], ",", 
        
        RowBox[{"Epilog", "\[Rule]", "myepilog"}]}], "]"}]}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"myepilog", "=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"Green", ",", 
         RowBox[{"Line", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"zeropoint", ",", 
              RowBox[{"Min", "[", 
               RowBox[{"bckg", "[", 
                RowBox[{"[", 
                 RowBox[{"All", ",", "2"}], "]"}], "]"}], "]"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"zeropoint", ",", 
              RowBox[{"Max", "[", 
               RowBox[{"bckg", "[", 
                RowBox[{"[", 
                 RowBox[{"All", ",", "2"}], "]"}], "]"}], "]"}]}], "}"}]}], 
           "}"}], "]"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"Red", ",", 
         RowBox[{"Line", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"cutoff", ",", 
              RowBox[{"Min", "[", 
               RowBox[{"bckg", "[", 
                RowBox[{"[", 
                 RowBox[{"All", ",", "2"}], "]"}], "]"}], "]"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"cutoff", ",", 
              RowBox[{"Max", "[", 
               RowBox[{"bckg", "[", 
                RowBox[{"[", 
                 RowBox[{"All", ",", "2"}], "]"}], "]"}], "]"}]}], "}"}]}], 
           "}"}], "]"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"Blue", ",", 
         RowBox[{"Line", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"background", ",", 
              RowBox[{"Min", "[", 
               RowBox[{"bckg", "[", 
                RowBox[{"[", 
                 RowBox[{"All", ",", "2"}], "]"}], "]"}], "]"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"background", ",", 
              RowBox[{"Max", "[", 
               RowBox[{"bckg", "[", 
                RowBox[{"[", 
                 RowBox[{"All", ",", "2"}], "]"}], "]"}], "]"}]}], "}"}]}], 
           "}"}], "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"bgmodel", "\[Equal]", "\"\<Fractal\>\""}], ",", 
          RowBox[{"Text", "[", 
           RowBox[{
            RowBox[{"Style", "[", 
             RowBox[{
              RowBox[{"\"\<Dim = \>\"", "<>", 
               RowBox[{"ToString", "[", 
                RowBox[{"d", "/.", "bckgfit"}], "]"}]}], ",", 
              RowBox[{"helv", "[", "16", "]"}]}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"cutoff", "-", "background"}], ")"}], "/", "2"}], 
               "+", "background"}], ",", "1."}], "}"}]}], "]"}]}], "]"}], 
        "}"}]}], "}"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"bgsubtractplot", "=", 
     RowBox[{"labelT", "@", 
      RowBox[{"specPlot", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"bckg", ",", "bckgtable"}], "}"}], ",", 
        RowBox[{"AxesOrigin", "\[Rule]", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"bckg", "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "1"}], "]"}], "]"}], ",", 
           RowBox[{"Min", "[", 
            RowBox[{"bckg", "[", 
             RowBox[{"[", 
              RowBox[{"All", ",", "2"}], "]"}], "]"}], "]"}]}], "}"}]}], ",", 
        
        RowBox[{"Epilog", "\[Rule]", "myepilog"}]}], "]"}]}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"intialwaveformplot", "=", 
     RowBox[{"labelT", "@", 
      RowBox[{"specPlot", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"t", ",", "waveform"}], "}"}], "\[Transpose]"}], ",", 
        RowBox[{"Epilog", "->", 
         RowBox[{"{", 
          RowBox[{"Black", ",", "Dashed", ",", 
           RowBox[{"Line", "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "0"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"Last", "[", "t", "]"}], ",", "0"}], "}"}]}], "}"}], 
            "]"}]}], "}"}]}]}], "]"}]}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"\"\<Choose Zero Point Window Width:\>\"", ",", 
        RowBox[{"Slider", "[", 
         RowBox[{
          RowBox[{"Dynamic", "[", "fitwindowEnd", "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"5", ",", "100", ",", "1"}], "}"}]}], "]"}], ",", 
        RowBox[{"Dynamic", "[", "fitwindowEnd", "]"}], ",", "\"\<    \>\"", 
        ",", "\"\<Choose Zero Point Fit Method:\>\"", ",", 
        RowBox[{"PopupMenu", "[", 
         RowBox[{
          RowBox[{"Dynamic", "[", "normMethod", "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"{", 
           RowBox[{
           "\"\<Gaussian Fit\>\"", ",", 
            "\"\<Gaussian Center, Data Maximum Amp\>\"", ",", 
            "\"\<Data Max Center, Data Maximum Amp\>\""}], "}"}]}], "]"}]}], 
       "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{"\"\<Choose Background Fit Window:\>\"", ",", 
        RowBox[{"Slider", "[", 
         RowBox[{
          RowBox[{"Dynamic", "[", "background", "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"bckg", "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "1"}], "]"}], "]"}], "}"}]}], "]"}], ",", 
        RowBox[{"Dynamic", "[", "background", "]"}], ",", "\"\< \>\"", ",", 
        RowBox[{"\"\<3D Background: \>\"", 
         RowBox[{"RadioButton", "[", 
          RowBox[{
           RowBox[{"Dynamic", "[", "bgmodel", "]"}], ",", "\"\<3D\>\""}], 
          "]"}]}], ",", 
        RowBox[{"\"\<Fractal Background: \>\"", 
         RowBox[{"RadioButton", "[", 
          RowBox[{
           RowBox[{"Dynamic", "[", "bgmodel", "]"}], ",", "\"\<Fractal\>\""}],
           "]"}]}], ",", 
        RowBox[{"\"\<**Experimental** Offset: \>\"", 
         RowBox[{"RadioButton", "[", 
          RowBox[{
           RowBox[{"Dynamic", "[", "bgmodel", "]"}], ",", "\"\<Offset\>\""}], 
          "]"}]}]}], "}"}]}], "}"}], "//", "TableForm"}], 
   "\[IndentingNewLine]", 
   RowBox[{"initialsetup", "=", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{
       "zeropeakplot", ",", "bgsubtractplot", ",", "intialwaveformplot"}], 
       "}"}], "}"}], "//", "TableForm"}]}], 
   "\[IndentingNewLine]"}]}]], "Input",
 Editable->False,
 CellChangeTimes->{{3.683385091302271*^9, 3.683385168526026*^9}, {
   3.683386939100486*^9, 3.683387140427472*^9}, {3.683387503964789*^9, 
   3.68338756463478*^9}, {3.6833876992529383`*^9, 3.683387741629075*^9}, {
   3.68338778791578*^9, 3.68338793074747*^9}, {3.683388406393911*^9, 
   3.683388522952016*^9}, {3.683388802802683*^9, 3.683388926677206*^9}, 
   3.683388977056653*^9, {3.683389011459476*^9, 3.68338903322337*^9}, {
   3.6833901828574963`*^9, 3.6833902482005463`*^9}, {3.683390300747559*^9, 
   3.6833903093837433`*^9}, {3.683390346066161*^9, 3.6833904094967937`*^9}, {
   3.6833906944348917`*^9, 3.683390697082301*^9}, {3.683390967035565*^9, 
   3.68339099868781*^9}, {3.683392137070616*^9, 3.683392162557371*^9}, {
   3.683392321386455*^9, 3.683392330076633*^9}, {3.683466047339542*^9, 
   3.6834660777767487`*^9}, {3.683466113393386*^9, 3.6834661619730463`*^9}, {
   3.683467021526822*^9, 3.6834670645212383`*^9}, {3.6834682322542458`*^9, 
   3.6834682347889977`*^9}, {3.683468897467535*^9, 3.6834689003916597`*^9}, {
   3.6854513954914637`*^9, 3.685451429628099*^9}, {3.68545150838383*^9, 
   3.685451512648481*^9}, {3.685452237290224*^9, 3.685452254547661*^9}, {
   3.6857138096778316`*^9, 3.6857138131186666`*^9}, {3.685714156538189*^9, 
   3.6857141576300993`*^9}, {3.685714211501224*^9, 3.6857142248692713`*^9}, {
   3.685723386686035*^9, 3.6857234165040627`*^9}, {3.685723451325623*^9, 
   3.685723469586307*^9}, {3.685723527533091*^9, 3.6857235706366997`*^9}, {
   3.6858025207624207`*^9, 3.685802521384089*^9}, {3.6858026320265923`*^9, 
   3.685802638427308*^9}, {3.685891317586893*^9, 3.6858914804599667`*^9}, {
   3.685891516330868*^9, 3.685891792988113*^9}, {3.686413939056391*^9, 
   3.686413970415389*^9}, {3.6869342579685926`*^9, 3.6869342598531313`*^9}, {
   3.6871838528662443`*^9, 3.6871838703200827`*^9}, {3.6871839306837797`*^9, 
   3.687183934793005*^9}, {3.687184517559462*^9, 3.68718453843323*^9}, {
   3.68718478140382*^9, 3.687184784848942*^9}, {3.687190439249399*^9, 
   3.6871904415719957`*^9}, {3.687191624496152*^9, 3.68719162654235*^9}, 
   3.6872714201890993`*^9, {3.687276812784082*^9, 3.687276819726391*^9}, {
   3.687535096544738*^9, 3.68753511210567*^9}, {3.687535288000572*^9, 
   3.687535288235437*^9}, {3.687544433274638*^9, 3.687544433617131*^9}, {
   3.687544608062557*^9, 3.6875446579542017`*^9}, {3.6876162723283663`*^9, 
   3.687616272581503*^9}, {3.687616373183387*^9, 3.687616402910852*^9}, {
   3.687616443014883*^9, 3.6876164746555*^9}, {3.687616550568062*^9, 
   3.687616560938895*^9}, {3.6876166692193403`*^9, 3.687616747260584*^9}, {
   3.68761678571525*^9, 3.687616794248111*^9}, {3.687616828825651*^9, 
   3.687616893057846*^9}, {3.687619657606058*^9, 3.687619658382338*^9}, {
   3.68771155005335*^9, 3.6877115629473543`*^9}, {3.689510493610074*^9, 
   3.689510500652968*^9}, {3.689526682064044*^9, 3.6895266822571783`*^9}, 
   3.689691283726995*^9, {3.689701813737596*^9, 3.6897019611997547`*^9}, {
   3.689702000649045*^9, 3.689702006048347*^9}, 3.689702138626276*^9, {
   3.6897024506546907`*^9, 3.6897024609890423`*^9}, {3.689702908232922*^9, 
   3.689702937576336*^9}, {3.689703056116376*^9, 3.6897030803307457`*^9}, {
   3.689785644298133*^9, 3.68978572435573*^9}, 3.6898624861334763`*^9, 
   3.689862533237097*^9, {3.6898629796735363`*^9, 3.6898629881225233`*^9}, {
   3.689863022907099*^9, 3.689863025097925*^9}, {3.690122826025537*^9, 
   3.69012282624481*^9}, {3.690219358494361*^9, 3.6902194086874104`*^9}, {
   3.690219696015069*^9, 3.690219721231456*^9}, {3.690220713040324*^9, 
   3.690220825051882*^9}, {3.690221328299556*^9, 3.6902213430684137`*^9}, 
   3.69022139892553*^9, {3.690221460202675*^9, 3.690221476069952*^9}, {
   3.6903073323396397`*^9, 3.690307340074237*^9}, {3.690632110330509*^9, 
   3.69063211459433*^9}, {3.690633320128265*^9, 3.690633330617779*^9}, {
   3.6906344842578*^9, 3.690634617829528*^9}, {3.690636197517865*^9, 
   3.690636202037788*^9}, {3.690722488747449*^9, 3.690722497249604*^9}, {
   3.690722903109805*^9, 3.6907229381938953`*^9}, {3.690723146075973*^9, 
   3.690723153952793*^9}, 3.690723224955286*^9, {3.690723313419155*^9, 
   3.690723335796754*^9}, 3.6907347630414877`*^9, {3.690735728321599*^9, 
   3.690735733973221*^9}, {3.690739150306573*^9, 3.690739156307797*^9}, {
   3.690914280904271*^9, 3.690914281100202*^9}, {3.6912534232269573`*^9, 
   3.691253425338007*^9}, 3.691334863909889*^9, {3.691338747173295*^9, 
   3.691338749341083*^9}, {3.692546451575594*^9, 3.6925464549415293`*^9}, {
   3.692546511805726*^9, 3.692546547997629*^9}, {3.692546591416709*^9, 
   3.692546591602661*^9}, {3.69255053419972*^9, 3.692550553126893*^9}, {
   3.69255060871916*^9, 3.692550680117579*^9}, {3.692554408974307*^9, 
   3.6925544296062717`*^9}, 3.692721200869598*^9, {3.692721303557683*^9, 
   3.692721303769655*^9}, {3.693065648404419*^9, 3.693065648609089*^9}, {
   3.693246051653941*^9, 3.693246051695324*^9}, {3.6932461032101603`*^9, 
   3.693246103249298*^9}, {3.693248255666091*^9, 3.693248255870693*^9}, {
   3.69333512015978*^9, 3.693335150086265*^9}, 3.693840590686647*^9, {
   3.693841498813217*^9, 3.693841539895129*^9}, {3.6938466008638973`*^9, 
   3.6938466028720427`*^9}, {3.693851060010387*^9, 3.693851064778386*^9}, {
   3.693851183738641*^9, 3.6938511996673927`*^9}, {3.693851289338953*^9, 
   3.693851289567*^9}, {3.6939297742059813`*^9, 3.693929777070537*^9}, {
   3.694276435898761*^9, 3.6942764361010027`*^9}, {3.69445606101798*^9, 
   3.694456071870164*^9}, {3.694456106372836*^9, 3.6944561073580093`*^9}, {
   3.6944564550786753`*^9, 3.6944564835594254`*^9}, {3.694967112680503*^9, 
   3.694967156950746*^9}, {3.6954923994822083`*^9, 3.695492401644327*^9}, {
   3.6954926056608467`*^9, 3.6954926678727007`*^9}, 3.695493008192202*^9, {
   3.6955718120715427`*^9, 3.6955718357077837`*^9}, 3.695571907189336*^9, {
   3.6955763605196037`*^9, 3.695576362939787*^9}, 3.6955773663237267`*^9, {
   3.695579346916788*^9, 3.695579349374899*^9}, {3.696178378637999*^9, 
   3.696178388912971*^9}, 3.696184056580112*^9, {3.696185149310404*^9, 
   3.6961851521711617`*^9}, 3.696609862483919*^9, {3.696609951123713*^9, 
   3.696609953068058*^9}, 3.696611534584621*^9, {3.697283929004952*^9, 
   3.6972839513590918`*^9}, 3.697390818172268*^9, {3.697391074642172*^9, 
   3.697391102422735*^9}, {3.697391142010522*^9, 3.697391177474659*^9}, {
   3.697391222448063*^9, 3.6973912620050573`*^9}, 3.697391369778339*^9, {
   3.697392518554058*^9, 3.69739257511869*^9}, {3.697392703836013*^9, 
   3.6973927372665*^9}, {3.697392784366857*^9, 3.6973927870527163`*^9}, 
   3.697392824278635*^9, {3.697392909396781*^9, 3.6973929363053007`*^9}, {
   3.697393073937817*^9, 3.697393132367277*^9}, {3.6973931968095827`*^9, 
   3.6973931974858913`*^9}, {3.6973932967183247`*^9, 3.697393375417156*^9}, {
   3.698456744407219*^9, 3.698456746608795*^9}, {3.699105799876416*^9, 
   3.699105847440186*^9}, 3.6991059994520473`*^9, {3.699893707216714*^9, 
   3.6998937320044394`*^9}, 3.699894018484633*^9, {3.700743309689007*^9, 
   3.70074331388864*^9}, {3.7007437819174*^9, 3.700743783941124*^9}, {
   3.700745748387109*^9, 3.7007458020551977`*^9}, {3.700750564601115*^9, 
   3.700750589952853*^9}, {3.700750642531416*^9, 3.7007506430264587`*^9}, {
   3.7007541560112133`*^9, 3.700754159559134*^9}, {3.700755603250124*^9, 
   3.7007556293943377`*^9}, 3.7007573525503883`*^9, {3.7007577029512577`*^9, 
   3.700757705431983*^9}, 3.7007623861342*^9, 3.700777340075653*^9, {
   3.700777758768715*^9, 3.7007777632620697`*^9}, {3.700829546280974*^9, 
   3.700829556909692*^9}, {3.701091316138496*^9, 3.701091316513338*^9}, {
   3.7017905305197277`*^9, 3.70179053212815*^9}, {3.70221140562576*^9, 
   3.702211413010428*^9}, 3.702218263491791*^9, {3.702219488418024*^9, 
   3.7022194914603*^9}, {3.702219529293885*^9, 3.7022195324964113`*^9}, 
   3.702221758086465*^9, {3.702305864434184*^9, 3.702305873109191*^9}, 
   3.7033477857841682`*^9, {3.703354570080935*^9, 3.7033545754177017`*^9}, {
   3.7034255853959217`*^9, 3.7034255921623*^9}, 3.703431257362996*^9, {
   3.703433197124743*^9, 3.703433207982088*^9}, {3.7035116280046587`*^9, 
   3.7035116556310387`*^9}, {3.7035119776555347`*^9, 
   3.7035119894893723`*^9}, {3.703517587799808*^9, 3.7035176000996733`*^9}, {
   3.703517636584014*^9, 3.703517640577833*^9}, {3.70351781872972*^9, 
   3.70351784539614*^9}, {3.703517875437505*^9, 3.703517880121153*^9}, 
   3.703613317424077*^9, {3.704647529808875*^9, 3.704647537067751*^9}, {
   3.7057683451793423`*^9, 3.705768397165434*^9}, 3.70576858915419*^9, {
   3.7057690941248827`*^9, 3.705769098268066*^9}, {3.70576919813764*^9, 
   3.70576920937956*^9}, {3.705769849493085*^9, 3.7057698502258453`*^9}, 
   3.705770226453927*^9, {3.705773007417721*^9, 3.7057730233625107`*^9}, {
   3.705773061308326*^9, 3.7057731132093554`*^9}, {3.705773147510578*^9, 
   3.705773194759761*^9}, {3.709999192404072*^9, 3.709999192570744*^9}, {
   3.711814070005918*^9, 3.711814075868075*^9}, {3.711815282789901*^9, 
   3.711815316270021*^9}, {3.711816159322522*^9, 3.7118161655111322`*^9}, {
   3.712498436193474*^9, 3.712498519683138*^9}, {3.712498583387176*^9, 
   3.712498680052787*^9}, {3.71267642290207*^9, 3.712676535347369*^9}, {
   3.712676571311721*^9, 3.712676603787818*^9}, {3.713015239375119*^9, 
   3.7130152442856007`*^9}, {3.713015306131154*^9, 3.713015327284004*^9}, {
   3.721911276235371*^9, 3.721911278947585*^9}, {3.728932222755588*^9, 
   3.7289322390541077`*^9}, {3.7293553066164207`*^9, 3.729355386179961*^9}, {
   3.7294294319910994`*^9, 3.729429452967689*^9}, {3.729429483102347*^9, 
   3.729429487419756*^9}, {3.73168019043434*^9, 3.731680223698359*^9}, {
   3.731773818658813*^9, 3.7317738340714903`*^9}, {3.7317740728956957`*^9, 
   3.731774084256933*^9}, {3.731774133155435*^9, 3.7317741340054092`*^9}, {
   3.731774187135544*^9, 3.73177420036243*^9}, 3.731774247341835*^9, {
   3.7318462391901083`*^9, 3.731846282938586*^9}, {3.731847420566717*^9, 
   3.7318474272064743`*^9}, {3.731859804591008*^9, 3.7318598271913958`*^9}, {
   3.73185988220688*^9, 3.731859892043792*^9}, {3.73185993357806*^9, 
   3.731859937216053*^9}, {3.731860143190487*^9, 3.731860171753099*^9}, {
   3.731860294524518*^9, 3.731860300939706*^9}, {3.731860382128097*^9, 
   3.731860422258712*^9}, {3.731860482738144*^9, 3.7318605062321568`*^9}, {
   3.7318674552587357`*^9, 3.7318674591552563`*^9}, {3.731867504655488*^9, 
   3.731867514073093*^9}},ExpressionUUID->"7f1409ba-bf14-4d03-a41f-\
0ccecee7eb8c"],

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"UNCONSTRAINED", " ", "TIKHONOV", " ", "FITTING"}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
   "AbsoluteTiming", "[", "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
     "Solve", " ", "tikhonov", " ", "for", " ", "all", " ", "alphas", " ", 
      "and", " ", "generate", " ", "L", " ", "Curve"}], "*)"}], 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"bvectorzeros", "=", 
      RowBox[{"ConstantArray", "[", 
       RowBox[{"0.", ",", 
        RowBox[{
         RowBox[{
          RowBox[{"Dimensions", "[", 
           RowBox[{"Join", "[", 
            RowBox[{"kernel", ",", 
             RowBox[{"0.", "*", "Lmatrix"}]}], "]"}], "]"}], "[", 
          RowBox[{"[", "1", "]"}], "]"}], "-", 
         RowBox[{"Length", "[", "waveform", "]"}]}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"bvectortik", "=", 
      RowBox[{"Join", "[", 
       RowBox[{"waveform", ",", "bvectorzeros"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"ParallelEvaluate", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"RSet", "[", 
         RowBox[{"\"\<kernel\>\"", ",", 
          RowBox[{"ToRForm", "@", "kernel"}]}], "]"}], "//", "Quiet"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"RSet", "[", 
         RowBox[{"\"\<Lmatrix\>\"", ",", 
          RowBox[{"ToRForm", "@", 
           RowBox[{"Normal", "[", "Lmatrix", "]"}]}]}], "]"}], "//", 
        "Quiet"}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"RSet", "[", 
         RowBox[{"\"\<bvector\>\"", ",", 
          RowBox[{"ToRForm", "@", "bvectortik"}]}], "]"}], "//", "Quiet"}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"RSet", "[", 
         RowBox[{"\"\<alphas\>\"", ",", 
          RowBox[{"ToRForm", "@", "alphas"}]}], "]"}], "//", "Quiet"}], ";"}],
       "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"solutions", "=", 
      RowBox[{
      "ParallelTable", "[", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"REvaluate", "[", 
           RowBox[{"\"\<nnls(rbind(kernel,alphas[\>\"", "<>", 
            RowBox[{"ToString", "[", "i", "]"}], "<>", 
            "\"\<]*Lmatrix),bvector)\>\""}], "]"}], "[", 
          RowBox[{"[", 
           RowBox[{"1", ",", "1"}], "]"}], "]"}], "//", "Quiet"}], 
        "\[IndentingNewLine]", "\[IndentingNewLine]", ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "[", "alphas", "]"}]}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"solutions", "=", "solutions"}], ";", "\[IndentingNewLine]", 
     RowBox[{"hMats", "=", "hMats"}], ";", "\[IndentingNewLine]", 
     RowBox[{"tikhonovfits", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"kernel", ".", 
         RowBox[{"solutions", "[", 
          RowBox[{"[", "i", "]"}], "]"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "[", "solutions", "]"}]}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"templist", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"tikhonovfits", "[", 
          RowBox[{"[", "i", "]"}], "]"}], "/", 
         RowBox[{"Max", "[", 
          RowBox[{"tikhonovfits", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "]"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "[", "solutions", "]"}]}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"tikhonovfits", "=", "templist"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"optimal", " ", "alpha", " ", "via", " ", "LOOCV"}], ","}], 
      "*)"}], "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"alphavalue", "=", 
        RowBox[{"First", "@", 
         RowBox[{"Nearest", "[", 
          RowBox[{
           RowBox[{"alphas", "\[Rule]", "Automatic"}], ",", 
           RowBox[{
            RowBox[{"MinimalBy", "[", 
             RowBox[{
              RowBox[{"Table", "[", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"alphas", "[", 
                   RowBox[{"[", "j", "]"}], "]"}], ",", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"Norm", "[", 
                    RowBox[{
                    RowBox[{"kernel", ".", 
                    RowBox[{"(", 
                    RowBox[{"solutions", "[", 
                    RowBox[{"[", "j", "]"}], "]"}], ")"}]}], "-", 
                    "waveform"}], "]"}], "^", "2"}], "/", 
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{"1", "-", 
                    RowBox[{"hMats", "[", 
                    RowBox[{"[", 
                    RowBox[{"j", ",", "All"}], "]"}], "]"}]}], ")"}], "^", 
                    "2"}]}]}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"j", ",", 
                  RowBox[{"Length", "[", "alphas", "]"}]}], "}"}]}], "]"}], 
              ",", "Last"}], "]"}], "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "1"}], "]"}], "]"}]}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"optimalalpha", "=", "alphavalue"}], ";"}], "*)"}], 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"alphavalue", "=", 
      RowBox[{"First", "@", 
       RowBox[{"Ordering", "[", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"Norm", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"kernel", ".", 
                RowBox[{"solutions", "[", 
                 RowBox[{"[", "j", "]"}], "]"}]}], "/", 
               RowBox[{"Max", "[", 
                RowBox[{"kernel", ".", 
                 RowBox[{"solutions", "[", 
                  RowBox[{"[", "j", "]"}], "]"}]}], "]"}]}], "-", 
              "waveform"}], "]"}], "^", "2"}], "/", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"Tr", "[", 
              RowBox[{"1", "-", 
               RowBox[{"hMats", "[", 
                RowBox[{"[", "j", "]"}], "]"}]}], "]"}], ")"}], "^", "2"}]}], 
          ",", 
          RowBox[{"{", 
           RowBox[{"j", ",", 
            RowBox[{"Length", "@", "alphas"}]}], "}"}]}], "]"}], "]"}]}]}], 
     ";", " ", 
     RowBox[{"(*", 
      RowBox[{"from", " ", "wikipedia"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"optimalalpha", "=", "alphavalue"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"L", "-", 
       RowBox[{"Curve", " ", "components"}]}], "*)"}], "\[IndentingNewLine]", 
     
     RowBox[{"residualnorm", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Norm", "[", 
          RowBox[{
           RowBox[{"tikhonovfits", "[", 
            RowBox[{"[", "i", "]"}], "]"}], "-", "waveform"}], "]"}], "^", 
         "2"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "[", "solutions", "]"}]}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"solutionnorm", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Norm", "[", 
          RowBox[{"Lmatrix", ".", 
           RowBox[{"solutions", "[", 
            RowBox[{"[", "i", "]"}], "]"}]}], "]"}], "^", "2"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "[", "solutions", "]"}]}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"lcurve", "=", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"residualnorm", ",", "solutionnorm"}], "}"}], 
       "\[Transpose]"}]}], ";"}], "]"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"Generate", " ", "dynamic", " ", "plots"}], ",", " ", 
     RowBox[{"CHOOSE", " ", "ALPHA"}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"spectrumplot", "=", 
     RowBox[{"Dynamic", "[", 
      RowBox[{
       RowBox[{"labelT", "@", 
        RowBox[{"specPlot", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"{", 
             RowBox[{"t", ",", "waveform"}], "}"}], "\[Transpose]"}], ",", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"t", ",", 
              RowBox[{"tikhonovfits", "[", 
               RowBox[{"[", "alphavalue", "]"}], "]"}]}], "}"}], 
            "\[Transpose]"}]}], "}"}], "]"}]}], ",", 
       RowBox[{"Initialization", "\[RuleDelayed]", "\"\<hi\>\""}]}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"spectrumresidual", "=", 
     RowBox[{"Dynamic", "[", 
      RowBox[{
       RowBox[{"labelT", "@", 
        RowBox[{"specPlot", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"t", ",", 
              RowBox[{"waveform", "-", 
               RowBox[{"tikhonovfits", "[", 
                RowBox[{"[", "alphavalue", "]"}], "]"}]}]}], "}"}], 
            "\[Transpose]"}], "}"}], ",", 
          RowBox[{"PlotRange", "\[Rule]", 
           RowBox[{"{", 
            RowBox[{"All", ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"Min", "[", 
                RowBox[{"waveform", "-", 
                 RowBox[{"tikhonovfits", "[", 
                  RowBox[{"[", "optimalalpha", "]"}], "]"}]}], "]"}], ",", 
               RowBox[{"Max", "[", 
                RowBox[{"waveform", "-", 
                 RowBox[{"tikhonovfits", "[", 
                  RowBox[{"[", "optimalalpha", "]"}], "]"}]}], "]"}]}], 
              "}"}]}], "}"}]}], ",", 
          RowBox[{"AxesOrigin", "\[Rule]", 
           RowBox[{"{", 
            RowBox[{"0", ",", "0"}], "}"}]}]}], "]"}]}], ",", 
       RowBox[{"Initialization", "\[RuleDelayed]", "\"\<hi\>\""}]}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"lcurveplot", "=", 
     RowBox[{"Dynamic", "[", 
      RowBox[{
       RowBox[{"Labeled", "[", 
        RowBox[{
         RowBox[{"ListLogLogPlot", "[", 
          RowBox[{"lcurve", ",", 
           RowBox[{"Epilog", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"PointSize", "[", "Large", "]"}], ",", "Red", ",", 
              RowBox[{"Point", "[", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"Log", "[", 
                  RowBox[{"residualnorm", "[", 
                   RowBox[{"[", "optimalalpha", "]"}], "]"}], "]"}], ",", 
                 RowBox[{"Log", "[", 
                  RowBox[{"solutionnorm", "[", 
                   RowBox[{"[", "optimalalpha", "]"}], "]"}], "]"}]}], "}"}], 
               "]"}], ",", "Black", ",", 
              RowBox[{"Point", "[", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"Log", "[", 
                  RowBox[{"residualnorm", "[", 
                   RowBox[{"[", "alphavalue", "]"}], "]"}], "]"}], ",", 
                 RowBox[{"Log", "[", 
                  RowBox[{"solutionnorm", "[", 
                   RowBox[{"[", "alphavalue", "]"}], "]"}], "]"}]}], "}"}], 
               "]"}]}], "}"}]}], ",", 
           RowBox[{"PlotRange", "\[Rule]", "All"}], ",", 
           RowBox[{"PlotStyle", "\[Rule]", "Thick"}], ",", 
           RowBox[{"Joined", "\[Rule]", "False"}], ",", 
           RowBox[{"ImageSize", "\[Rule]", "500"}], ",", 
           RowBox[{"LabelStyle", "\[Rule]", 
            RowBox[{"helv", "[", "24", "]"}]}]}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"\"\<Solution Norm\>\"", ",", "\"\<Residual Norm\>\""}], 
          "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"Left", ",", "Bottom"}], "}"}], ",", 
         RowBox[{"RotateLabel", "\[Rule]", "True"}], ",", 
         RowBox[{"LabelStyle", "\[Rule]", 
          RowBox[{"helv", "[", "24", "]"}]}], ",", 
         RowBox[{"ImageSize", "\[Rule]", "500"}], ",", 
         RowBox[{"Spacings", "\[Rule]", "0"}]}], "]"}], ",", 
       RowBox[{"Initialization", "\[RuleDelayed]", "\"\<hi\>\""}]}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Slider", "[", 
         RowBox[{
          RowBox[{"Dynamic", "[", "alphavalue", "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", 
            RowBox[{"Length", "[", "alphas", "]"}], ",", "1"}], "}"}]}], 
         "]"}], ",", 
        RowBox[{"Dynamic", "[", 
         RowBox[{"alphas", "[", 
          RowBox[{"[", "alphavalue", "]"}], "]"}], "]"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"lcurveplot", ",", "spectrumplot", ",", "spectrumresidual"}], 
       "}"}]}], "}"}], "//", "TableForm"}]}]}]], "Input",
 Editable->False,
 CellChangeTimes->{{3.682342385399026*^9, 3.682342399972786*^9}, {
   3.682342478532153*^9, 3.682342549661923*^9}, {3.682346328267254*^9, 
   3.682346330266383*^9}, {3.682696687352501*^9, 3.682696805839285*^9}, {
   3.682697549293173*^9, 3.6826975745073853`*^9}, 3.682862222544133*^9, {
   3.682866798459054*^9, 3.682866828622373*^9}, {3.68286783762573*^9, 
   3.682867837883635*^9}, {3.682868308268898*^9, 3.682868309459209*^9}, {
   3.6828683898695383`*^9, 3.682868391136855*^9}, {3.682868578526816*^9, 
   3.682868587272187*^9}, {3.682868841724696*^9, 3.68286884295721*^9}, {
   3.6828694263542337`*^9, 3.68286943631141*^9}, {3.682869927111134*^9, 
   3.682869935192092*^9}, {3.68287036972359*^9, 3.6828703752403927`*^9}, {
   3.6854561640171223`*^9, 3.6854562106521873`*^9}, 3.685724142575241*^9, {
   3.685724196047909*^9, 3.6857242022923107`*^9}, {3.6857243068850822`*^9, 
   3.685724307959652*^9}, {3.687711333934184*^9, 3.6877113464527483`*^9}, {
   3.687711614636767*^9, 3.687711618632225*^9}, {3.689526798232872*^9, 
   3.689526825281398*^9}, {3.689528458233409*^9, 3.689528500317357*^9}, {
   3.6895285717608643`*^9, 3.6895285722603693`*^9}, {3.689703308159981*^9, 
   3.689703311801605*^9}, {3.6897738553786592`*^9, 3.6897738592064867`*^9}, {
   3.69022085887094*^9, 3.690220875502665*^9}, {3.6906439365873003`*^9, 
   3.6906439415609713`*^9}, {3.690646660005206*^9, 3.6906466602468567`*^9}, {
   3.6906481126158047`*^9, 3.690648112888006*^9}, {3.690815225976297*^9, 
   3.6908152315431433`*^9}, 3.690815292157186*^9, {3.690902035601666*^9, 
   3.690902036993019*^9}, {3.692542759480591*^9, 3.692542773537631*^9}, {
   3.693246051724325*^9, 3.693246051777938*^9}, {3.6932461032610064`*^9, 
   3.693246103313486*^9}, {3.6938401367253323`*^9, 3.6938401437771397`*^9}, {
   3.693846801322576*^9, 3.6938468033997517`*^9}, {3.695490558494916*^9, 
   3.695490596637446*^9}, {3.695491196149489*^9, 3.695491251943755*^9}, {
   3.695491289629446*^9, 3.695491312086688*^9}, {3.695491346996623*^9, 
   3.695491466209847*^9}, {3.695491522613633*^9, 3.695491553555172*^9}, {
   3.695491602834339*^9, 3.695491641887115*^9}, {3.69549178135378*^9, 
   3.695491880707614*^9}, {3.695492794588581*^9, 3.695492795682107*^9}, {
   3.6954928919966707`*^9, 3.695492892558792*^9}, 3.6955719434119463`*^9, 
   3.6955770829661417`*^9, {3.695577114047641*^9, 3.6955771773696404`*^9}, {
   3.695577218447692*^9, 3.695577220390646*^9}, 3.6955772583184023`*^9, {
   3.696611330925552*^9, 3.6966113395936613`*^9}, 3.696611385039192*^9, {
   3.696612104289137*^9, 3.69661210505086*^9}, {3.696612155459277*^9, 
   3.696612156649228*^9}, {3.696613700165557*^9, 3.696613700612756*^9}, {
   3.696613734977639*^9, 3.696613735212641*^9}, 3.696613817282176*^9, {
   3.696613866233885*^9, 3.696613871830327*^9}, {3.696792486486642*^9, 
   3.6967925331427794`*^9}, {3.697210675073134*^9, 3.6972106768660593`*^9}, {
   3.6972110804400463`*^9, 3.6972110818972387`*^9}, {3.697284000048852*^9, 
   3.697284062250616*^9}, {3.697382547976666*^9, 3.6973826586834784`*^9}, {
   3.6973827170404863`*^9, 3.697382734016198*^9}, {3.697396901037088*^9, 
   3.697396908534481*^9}, {3.69746614491984*^9, 3.6974661469931927`*^9}, {
   3.697558501786409*^9, 3.697558548111044*^9}, {3.7033522717501993`*^9, 
   3.703352305484652*^9}, {3.7220925393847923`*^9, 3.7220925516405497`*^9}, {
   3.7220927183168488`*^9, 3.722092720832184*^9}, {3.722093465295878*^9, 
   3.7220934756704693`*^9}, {3.722096658766179*^9, 3.7220967205940733`*^9}, 
   3.726411781684659*^9, {3.726415742981337*^9, 3.726415751255089*^9}, {
   3.7264227020714607`*^9, 3.726422735116171*^9}, {3.726498147051786*^9, 
   3.726498154323558*^9}, {3.728932301905595*^9, 3.728932388301244*^9}, 
   3.729355540214018*^9, {3.729355685472426*^9, 3.729355719455295*^9}, {
   3.7293557508841867`*^9, 3.7293559044090014`*^9}, 3.7293612307200747`*^9, {
   3.7294295123150787`*^9, 3.7294295235835943`*^9}, {3.729429557859487*^9, 
   3.729429572795253*^9}, {3.729862852043833*^9, 3.7298628524460583`*^9}, {
   3.7299474077213383`*^9, 3.729947426764427*^9}, {3.7301389215885153`*^9, 
   3.730138971769553*^9}, {3.7317744034906607`*^9, 3.731774419264854*^9}, {
   3.731776566555694*^9, 
   3.7317766029466553`*^9}},ExpressionUUID->"8bdb45f1-78df-4ac8-9031-\
4ca9a86d214c"],

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
   "NNLS", " ", "TIKHONOV", " ", "SOLUTION", " ", "USING", " ", "ALPHA", " ", 
    "SELECTED", " ", "ABOVE"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"RSet", "[", 
     RowBox[{"\"\<kernel\>\"", ",", 
      RowBox[{"ToRForm", "@", "kernel"}]}], "]"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"RSet", "[", 
     RowBox[{"\"\<Lmatrix\>\"", ",", 
      RowBox[{"ToRForm", "@", 
       RowBox[{"Normal", "[", "Lmatrix", "]"}]}]}], "]"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"RSet", "[", 
     RowBox[{"\"\<bvector\>\"", ",", 
      RowBox[{"ToRForm", "@", "bvectortik"}]}], "]"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"RSet", "[", 
     RowBox[{"\"\<alphas\>\"", ",", 
      RowBox[{"ToRForm", "@", "alphas"}]}], "]"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"nnlsdistrib", "=", 
     RowBox[{
      RowBox[{"REvaluate", "[", 
       RowBox[{"\"\<nnls(rbind(kernel,alphas[\>\"", "<>", 
        RowBox[{"ToString", "[", "alphavalue", "]"}], "<>", 
        "\"\<]*Lmatrix),bvector)\>\""}], "]"}], "[", 
      RowBox[{"[", 
       RowBox[{"1", ",", "1"}], "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   
   RowBox[{
    RowBox[{"nnlsspecplot", "=", 
     RowBox[{"labelT", "@", 
      RowBox[{"specPlot", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{"t", ",", "waveform"}], "}"}], "\[Transpose]"}], ",", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"t", ",", 
            RowBox[{
             RowBox[{"kernel", ".", "nnlsdistrib"}], "/", 
             RowBox[{"Max", "[", 
              RowBox[{"kernel", ".", "nnlsdistrib"}], "]"}]}]}], "}"}], 
          "\[Transpose]"}]}], "}"}], "]"}]}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"nnlsdistribplot", "=", 
     RowBox[{"labelR", "@", 
      RowBox[{"distrPlot", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"r", ",", "nnlsdistrib"}], "}"}], "\[Transpose]"}], 
       "]"}]}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"nnlsresults", "=", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{"nnlsspecplot", ",", "nnlsdistribplot"}], "}"}], "}"}], "//", 
     "TableForm"}]}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]"}]}]], "Input",
 Editable->False,
 CellChangeTimes->{{3.6826987622032967`*^9, 3.682698839206382*^9}, {
   3.682698878153552*^9, 3.6826989541905203`*^9}, {3.6826999445151653`*^9, 
   3.682699950626327*^9}, {3.6828617373227587`*^9, 3.682861823547738*^9}, {
   3.6828620641836777`*^9, 3.682862066055241*^9}, {3.682862140569565*^9, 
   3.682862144784029*^9}, {3.682868912854295*^9, 3.6828689312813387`*^9}, {
   3.682868966224895*^9, 3.682868966475444*^9}, {3.682869218968617*^9, 
   3.682869219363652*^9}, {3.682869278902626*^9, 3.682869304225402*^9}, {
   3.682961238825448*^9, 3.6829612907001133`*^9}, 3.682961361125366*^9, {
   3.682961526869008*^9, 3.682961531723386*^9}, {3.682961963040724*^9, 
   3.682961992004744*^9}, {3.6829620465486603`*^9, 3.6829620812800694`*^9}, {
   3.68339474709894*^9, 3.683394775450197*^9}, {3.683395023491963*^9, 
   3.683395071599697*^9}, {3.684767278177986*^9, 3.684767320367504*^9}, {
   3.6847673779844017`*^9, 3.6847674048189783`*^9}, {3.684847480935596*^9, 
   3.684847498786207*^9}, 3.684847731089068*^9, {3.6854519808848047`*^9, 
   3.685451983264637*^9}, {3.685724336873537*^9, 3.685724337900667*^9}, {
   3.6863100198357363`*^9, 3.6863101376369343`*^9}, {3.686310188244451*^9, 
   3.686310191315688*^9}, {3.687625026592164*^9, 3.6876250287760773`*^9}, {
   3.6883237812126913`*^9, 3.688323785313586*^9}, {3.6895286864054117`*^9, 
   3.689528689521974*^9}, {3.689528737394782*^9, 3.689528759848102*^9}, {
   3.68952880256284*^9, 3.689528807495017*^9}, 3.689528847054825*^9, {
   3.689703524361876*^9, 3.689703536989324*^9}, {3.689775108018117*^9, 
   3.6897751145110598`*^9}, {3.689775400189398*^9, 3.6897754032409267`*^9}, {
   3.6902208842871313`*^9, 3.690220913954625*^9}, 3.690221377921495*^9, {
   3.6906375767629967`*^9, 3.6906375872633543`*^9}, {3.6906376290228043`*^9, 
   3.690637660121401*^9}, 3.69072343534306*^9, {3.6920282885729933`*^9, 
   3.692028307524201*^9}, {3.692028371122417*^9, 3.6920283896563597`*^9}, {
   3.692123606172461*^9, 3.69212363075243*^9}, {3.692550904036056*^9, 
   3.6925509549325457`*^9}, {3.692551078629675*^9, 3.6925511215884953`*^9}, {
   3.69306909425916*^9, 3.693069155100813*^9}, {3.693069206325573*^9, 
   3.693069207709135*^9}, {3.6930701047339773`*^9, 3.693070138344715*^9}, {
   3.693246051801005*^9, 3.693246051820464*^9}, {3.693246103326827*^9, 
   3.693246103351815*^9}, {3.695575235133319*^9, 3.69557526911699*^9}, {
   3.6955756211358967`*^9, 3.6955756332561493`*^9}, {3.6955756734880447`*^9, 
   3.6955756984219093`*^9}, 3.6955758618014307`*^9, {3.696792633276894*^9, 
   3.696792636951603*^9}, {3.69728407463102*^9, 3.6972841012504177`*^9}, {
   3.697382864916807*^9, 3.6973828678313923`*^9}, {3.697382954583249*^9, 
   3.697383009511606*^9}, 3.703354176676669*^9, {3.705941799033434*^9, 
   3.705941799607942*^9}, {3.7059422722624826`*^9, 3.705942272728849*^9}, {
   3.724427060100732*^9, 3.724427060284046*^9}, {3.726416369325182*^9, 
   3.726416376109275*^9}, {3.7289324210218973`*^9, 3.7289324258540487`*^9}, 
   3.72893247246364*^9, {3.729340001744289*^9, 3.729340018528647*^9}, {
   3.729355962495961*^9, 3.729355991044793*^9}, {3.729356098989245*^9, 
   3.7293561280393353`*^9}, {3.729356327038476*^9, 3.729356327248911*^9}, 
   3.729356420695528*^9, 3.7293565642234697`*^9, {3.729361270158476*^9, 
   3.72936127165454*^9}, {3.7294295962445097`*^9, 
   3.72942961285882*^9}},ExpressionUUID->"172c9616-18dc-48ce-b733-\
dc9403428525"],

Cell[BoxData[""], "Input",
 Editable->False,
 CellChangeTimes->{{3.68631013966715*^9, 3.686310180598023*^9}, {
   3.686934114593996*^9, 3.686934115129715*^9}, {3.6895108041409807`*^9, 
   3.68951080608214*^9}, {3.689703820469509*^9, 3.6897038221073427`*^9}, 
   3.689707591851046*^9, 3.693840691878483*^9, 
   3.697383049166048*^9},ExpressionUUID->"d9935af7-b2d4-4b6e-aace-\
fe3da63cebeb"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"BG", " ", "VALIDATION"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"backgroundstart", "=", ".2"}], ";"}], " ", 
   RowBox[{"(*", 
    RowBox[{
    "starting", " ", "position", " ", "for", " ", "bg", " ", "validation"}], 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"numberofbackgrounds", "=", "100"}], ";"}], " ", 
   RowBox[{"(*", 
    RowBox[{
    "modify", " ", "to", " ", "change", " ", "number", " ", "of", " ", "bg", 
     " ", "validation"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"cutoffoffset", "=", "30"}], ";"}], 
   RowBox[{"(*", 
    RowBox[{
    "Number", " ", "of", " ", "points", " ", "behind", " ", "cutoff", " ", 
     "to", " ", "end", " ", "fititng"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"noisetries", "=", "1"}], ";"}], " ", 
   RowBox[{"(*", 
    RowBox[{"noise", " ", "validation", " ", 
     RowBox[{"iterations", ".", " ", "1"}], " ", "is", " ", "using", " ", 
     "only", " ", "raw", " ", "data", " ", "with", " ", "no", " ", "noise", 
     " ", "added"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"cutindex", "=", 
     RowBox[{"First", "@", 
      RowBox[{"Nearest", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"bckg", "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "1"}], "]"}], "]"}], "\[Rule]", "Automatic"}], 
        ",", "cutoff"}], "]"}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"bgstartindex", "=", 
     RowBox[{"First", "@", 
      RowBox[{"Nearest", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"bckg", "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "1"}], "]"}], "]"}], "\[Rule]", "Automatic"}], 
        ",", "backgroundstart"}], "]"}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"bgstepsize", "=", 
     RowBox[{
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"#", "\[Equal]", "0"}], ",", "1", ",", "#"}], "]"}], "&"}], 
      "@", 
      RowBox[{"Floor", "[", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"cutindex", "-", "cutoffoffset", "-", "bgstartindex"}], 
         ")"}], "/", 
        RowBox[{"(", 
         RowBox[{"numberofbackgrounds", "-", "1"}], ")"}]}], "]"}]}]}], ";"}],
    "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"noisestd", "=", 
     RowBox[{"StandardDeviation", "[", 
      RowBox[{
       RowBox[{"bckg", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", "2"}], "]"}], "]"}], "-", 
       RowBox[{"GaussianFilter", "[", 
        RowBox[{
         RowBox[{"bckg", "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "2"}], "]"}], "]"}], ",", "10"}], "]"}]}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"bgpositions", "=", 
     RowBox[{"Range", "[", 
      RowBox[{"bgstartindex", ",", 
       RowBox[{"cutindex", "-", "cutoffoffset"}], ",", "bgstepsize"}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"bckgnoiselist", "=", 
      RowBox[{"{", "}"}]}], ";"}], "*)"}], " ", 
   RowBox[{"(*", 
    RowBox[{"Legacy", " ", "from", " ", "noise", " ", "addition"}], "*)"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"noisywaveforms", "=", 
     RowBox[{"Table", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"bckgnoise", "=", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"j", "\[Equal]", "1"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"bckg", "[", 
               RowBox[{"[", 
                RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", 
              RowBox[{"bckg", "[", 
               RowBox[{"[", 
                RowBox[{"All", ",", "2"}], "]"}], "]"}]}], "}"}], 
            "\[Transpose]"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"bckg", "[", 
               RowBox[{"[", 
                RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", 
              RowBox[{
               RowBox[{"bckg", "[", 
                RowBox[{"[", 
                 RowBox[{"All", ",", "2"}], "]"}], "]"}], "+", 
               RowBox[{"Table", "[", 
                RowBox[{
                 RowBox[{"RandomReal", "[", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"-", "1.5"}], "noisestd"}], ",", 
                    RowBox[{"1.5", "noisestd"}]}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"Length", "[", "bckg", "]"}], "}"}]}], "]"}]}]}], 
             "}"}], "\[Transpose]"}]}], "\[IndentingNewLine]", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"AppendTo", "[", 
           RowBox[{"bckgnoiselist", ",", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"t", ",", 
               RowBox[{"bckgnoise", "[", 
                RowBox[{"[", 
                 RowBox[{"waveformrange", ",", "2"}], "]"}], "]"}]}], "}"}], 
             "\[Transpose]"}]}], "]"}], ";"}], "*)"}], " ", 
        RowBox[{"(*", 
         RowBox[{"Legacy", " ", "from", " ", "noise", " ", "addition"}], 
         "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"bgvalidation", "=", 
         RowBox[{"Table", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"bckgrange", "=", 
             RowBox[{"i", ";;", "cutindex"}]}], ";", "\[IndentingNewLine]", 
            "\[IndentingNewLine]", 
            RowBox[{"Switch", "[", 
             RowBox[{
             "bgmodel", ",", "\[IndentingNewLine]", "\"\<3D\>\"", ",", 
              "\[IndentingNewLine]", 
              RowBox[{"(*", 
               RowBox[{"3", "d", " ", "dimensionality"}], "*)"}], 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"bckgmodel", "=", 
                RowBox[{"b", "*", 
                 RowBox[{"Exp", "[", 
                  RowBox[{
                   RowBox[{"-", "x"}], "/", "c"}], "]"}]}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"constraints", "=", 
                RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"modelparams", "=", 
                RowBox[{"{", 
                 RowBox[{"b", ",", "c"}], "}"}]}], ";"}], 
              "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
              "\"\<Fractal\>\"", ",", "\[IndentingNewLine]", 
              RowBox[{"(*", 
               RowBox[{"fit", " ", "dimensionality"}], "*)"}], 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"bckgmodel", "=", 
                RowBox[{"b", "*", 
                 RowBox[{"Exp", "[", 
                  RowBox[{
                   RowBox[{"-", 
                    RowBox[{"x", "^", 
                    RowBox[{"(", 
                    RowBox[{"d", "/", "3"}], ")"}]}]}], "/", "c"}], "]"}]}]}],
                ";", "\[IndentingNewLine]", 
               RowBox[{"constraints", "=", 
                RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"modelparams", "=", 
                RowBox[{"{", 
                 RowBox[{"b", ",", "c", ",", "d"}], "}"}]}], ";"}], 
              "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
              "\"\<Offset\>\"", ",", "\[IndentingNewLine]", 
              RowBox[{"(*", 
               RowBox[{"3", "D", " ", "with", " ", "offset"}], "*)"}], 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"bckgmodel", "=", 
                RowBox[{"a", "+", 
                 RowBox[{"b", "*", 
                  RowBox[{"Exp", "[", 
                   RowBox[{
                    RowBox[{"-", "x"}], "/", "c"}], "]"}]}]}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"constraints", "=", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"b", ">", "0"}], ",", 
                  RowBox[{"c", ">", "0"}]}], "}"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"modelparams", "=", 
                RowBox[{"{", 
                 RowBox[{"a", ",", "b", ",", "c"}], "}"}]}], ";"}]}], 
             "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
            "\[IndentingNewLine]", 
            RowBox[{"bckgfit", "=", 
             RowBox[{
              RowBox[{"FindFit", "[", 
               RowBox[{
                RowBox[{"bckgnoise", "[", 
                 RowBox[{"[", "bckgrange", "]"}], "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{"bckgmodel", ",", "constraints"}], "}"}], ",", 
                "modelparams", ",", "x"}], "]"}], "//", "Quiet"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{"#", ",", 
                 RowBox[{
                  RowBox[{"bckgmodel", "/.", "bckgfit"}], "/.", 
                  RowBox[{"x", "\[Rule]", "#"}]}]}], "}"}], "\[Transpose]"}], 
              "&"}], "@", 
             RowBox[{"bckg", "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", "1"}], "]"}], "]"}]}]}], 
           "\[IndentingNewLine]", ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "bgpositions"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"backgroundCorrect", "[", 
           RowBox[{
            RowBox[{"bckg", "[", 
             RowBox[{"[", 
              RowBox[{"waveformrange", ",", "2"}], "]"}], "]"}], ",", 
            RowBox[{"bgvalidation", "[", 
             RowBox[{"[", 
              RowBox[{"i", ",", "waveformrange", ",", "2"}], "]"}], "]"}], 
            ",", "zeroamp"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", 
            RowBox[{"Length", "[", "bgvalidation", "]"}]}], "}"}]}], "]"}]}], 
       "\[IndentingNewLine]", ",", 
       RowBox[{"{", 
        RowBox[{"j", ",", "1", ",", "noisetries"}], "}"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"noisywaveforms", "=", 
     RowBox[{"Flatten", "[", 
      RowBox[{"noisywaveforms", ",", "1"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"bgforplots", "=", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"bgvalidation", "[", 
        RowBox[{"[", 
         RowBox[{"i", ",", "waveformrange"}], "]"}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", 
         RowBox[{"Length", "[", "bgvalidation", "]"}]}], "}"}]}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"bgvalidationplot", "=", 
     RowBox[{"labelT", "@", 
      RowBox[{"Show", "[", 
       RowBox[{
        RowBox[{"specPlot", "[", "bgforplots", "]"}], ",", 
        RowBox[{"specPlot", "[", 
         RowBox[{"bckgnoise", "[", 
          RowBox[{"[", "waveformrange", "]"}], "]"}], "]"}], ",", 
        RowBox[{"specPlot", "[", 
         RowBox[{
          RowBox[{"Table", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"bckg", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", "1"}], "]"}], "]"}], ",", 
              RowBox[{
               RowBox[{"GaussianFilter", "[", 
                RowBox[{
                 RowBox[{"bckg", "[", 
                  RowBox[{"[", 
                   RowBox[{"All", ",", "2"}], "]"}], "]"}], ",", "10"}], 
                "]"}], "[", 
               RowBox[{"[", "i", "]"}], "]"}]}], "}"}], "\[IndentingNewLine]",
             ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", "bgpositions"}], "}"}]}], "]"}], ",", 
          RowBox[{"PlotMarkers", "\[Rule]", 
           RowBox[{"{", 
            RowBox[{"Graphics", "[", 
             RowBox[{"{", 
              RowBox[{"Black", ",", "Dashed", ",", 
               RowBox[{"Line", "[", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"0", ",", ".5"}], "}"}]}], "}"}], "]"}]}], "}"}], 
             "]"}], "}"}]}], ",", 
          RowBox[{"Joined", "\[Rule]", "False"}]}], "]"}], ",", 
        RowBox[{"PlotRange", "\[Rule]", "All"}], ",", 
        RowBox[{"AxesOrigin", "\[Rule]", 
         RowBox[{"{", 
          RowBox[{"0", ",", 
           RowBox[{
            RowBox[{"Min", "[", 
             RowBox[{"bgforplots", "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", "All", ",", "2"}], "]"}], "]"}], "]"}], 
            "-", ".025"}]}], "}"}]}]}], "]"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"bgvalidationspecplot", "=", 
     RowBox[{"labelT", "@", 
      RowBox[{"specPlot", "[", 
       RowBox[{
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{"t", ",", 
             RowBox[{"noisywaveforms", "[", 
              RowBox[{"[", "i", "]"}], "]"}]}], "}"}], "\[Transpose]"}], ",", 
          
          RowBox[{"{", 
           RowBox[{"i", ",", 
            RowBox[{"Length", "[", "noisywaveforms", "]"}]}], "}"}]}], "]"}], 
        ",", 
        RowBox[{"Epilog", "->", 
         RowBox[{"{", 
          RowBox[{"Black", ",", "Dashed", ",", 
           RowBox[{"Line", "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "0"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"Last", "[", "t", "]"}], ",", "0"}], "}"}]}], "}"}], 
            "]"}]}], "}"}]}]}], "]"}]}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"bgnoisevalidation", "=", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{"bgvalidationplot", ",", "bgvalidationspecplot"}], "}"}], 
      "}"}], "//", "TableForm"}]}]}]}]], "Input",
 Editable->False,
 CellChangeTimes->{{3.683464286809619*^9, 3.683464301738859*^9}, 
   3.683467170949657*^9, {3.6852905014804487`*^9, 3.685290532272018*^9}, 
   3.685290680601828*^9, {3.685375853177918*^9, 3.685375861903414*^9}, {
   3.685452589585938*^9, 3.6854525978926687`*^9}, {3.6854635297044067`*^9, 
   3.685463531825739*^9}, {3.6857171176420317`*^9, 3.685717126847283*^9}, {
   3.685717623859891*^9, 3.685717637052779*^9}, 3.685717765679204*^9, {
   3.6857178517261667`*^9, 3.6857178730936403`*^9}, {3.685723804900229*^9, 
   3.685723811385515*^9}, {3.68572398880264*^9, 3.685723988968347*^9}, {
   3.6857240377335997`*^9, 3.685724049191293*^9}, {3.686308694613861*^9, 
   3.686308709488896*^9}, {3.6863087710562572`*^9, 3.686308785597122*^9}, {
   3.68630884161724*^9, 3.686308922122231*^9}, {3.686316291214644*^9, 
   3.686316320279714*^9}, {3.686325070007454*^9, 3.686325078463241*^9}, {
   3.686326467558818*^9, 3.686326603425846*^9}, {3.686326706337051*^9, 
   3.6863267267075787`*^9}, {3.686499384388389*^9, 3.686499403586239*^9}, {
   3.686499643476098*^9, 3.686499650614771*^9}, {3.6864996903715963`*^9, 
   3.686499776220949*^9}, {3.6864999001103773`*^9, 3.6864999002832317`*^9}, {
   3.6864999415173388`*^9, 3.686499954954081*^9}, {3.6865000186417522`*^9, 
   3.686500024664369*^9}, {3.6865000719811277`*^9, 3.686500099791539*^9}, {
   3.686936553726564*^9, 3.6869365563060637`*^9}, {3.687009832242159*^9, 
   3.687009848156661*^9}, {3.687020257425461*^9, 3.687020261287418*^9}, {
   3.687021684515211*^9, 3.6870216964265213`*^9}, 3.687096285969714*^9, {
   3.687100265038137*^9, 3.687100265280901*^9}, {3.687100310169938*^9, 
   3.687100391364422*^9}, 3.68710061487059*^9, 3.6871842642510033`*^9, {
   3.687185485288899*^9, 3.687185490038329*^9}, {3.687187254379867*^9, 
   3.6871872621350183`*^9}, {3.6871907793454447`*^9, 
   3.6871907827286158`*^9}, {3.687192249175432*^9, 3.687192254581019*^9}, {
   3.687192465298337*^9, 3.687192467390669*^9}, {3.687536284578136*^9, 
   3.687536288869418*^9}, {3.687618809873639*^9, 3.687618847685582*^9}, {
   3.6876189302695436`*^9, 3.687619025625053*^9}, 3.6876190645285807`*^9, {
   3.687619119678194*^9, 3.687619171961279*^9}, 3.687619238969429*^9, {
   3.687619426277775*^9, 3.687619431444524*^9}, {3.687619485934189*^9, 
   3.6876194891820183`*^9}, {3.6876256611514883`*^9, 3.68762572467831*^9}, {
   3.689703897968647*^9, 3.689703928156157*^9}, 3.689703999094532*^9, {
   3.689704054532037*^9, 3.689704061316659*^9}, {3.68970475503087*^9, 
   3.689704766764333*^9}, {3.6897736554735203`*^9, 3.689773657009362*^9}, {
   3.689776265949428*^9, 3.689776266482276*^9}, {3.6897824049499826`*^9, 
   3.689782409321329*^9}, {3.6897827588620367`*^9, 3.689782761419847*^9}, 
   3.6897830054095697`*^9, {3.689784093211205*^9, 3.6897840937728167`*^9}, {
   3.689784899809669*^9, 3.689784923550544*^9}, {3.689784970935463*^9, 
   3.689785052244295*^9}, {3.689785110024212*^9, 3.689785158505892*^9}, {
   3.689785425636742*^9, 3.689785563520482*^9}, {3.6897858980349913`*^9, 
   3.6897858988483343`*^9}, {3.689865127287951*^9, 3.689865158287292*^9}, {
   3.689866010819347*^9, 3.6898660121150417`*^9}, {3.689866663441983*^9, 
   3.689866664308517*^9}, {3.689866974378262*^9, 3.6898669850331097`*^9}, {
   3.690123182098015*^9, 3.6901231823873367`*^9}, {3.690124054741138*^9, 
   3.69012405490308*^9}, {3.6901251332696753`*^9, 3.690125133994596*^9}, {
   3.69012523273915*^9, 3.690125237487486*^9}, {3.6901262197630053`*^9, 
   3.690126227146996*^9}, {3.690126382964836*^9, 3.690126387929243*^9}, {
   3.6901266834484043`*^9, 3.690126704385347*^9}, {3.690126845033777*^9, 
   3.690126879217305*^9}, {3.690127390572502*^9, 3.690127457442381*^9}, {
   3.69012751758351*^9, 3.690127558187522*^9}, {3.6901277415668983`*^9, 
   3.6901277422139606`*^9}, {3.6901277778912992`*^9, 3.690127882778336*^9}, {
   3.690127952027507*^9, 3.6901279521699266`*^9}, {3.690128019950788*^9, 
   3.6901280394743853`*^9}, {3.6901280891246567`*^9, 
   3.6901281560806503`*^9}, {3.690128187435417*^9, 3.6901283566173697`*^9}, {
   3.690129497276916*^9, 3.6901295580188828`*^9}, {3.6901295893819447`*^9, 
   3.690129590899395*^9}, {3.6901296592796583`*^9, 3.690129691512135*^9}, 
   3.6901297881409483`*^9, 3.690200142612011*^9, 3.690219897354452*^9, {
   3.6902204886478653`*^9, 3.690220570051456*^9}, 3.690220936160213*^9, {
   3.690221550101413*^9, 3.690221577236691*^9}, {3.6903075044895973`*^9, 
   3.690307508045067*^9}, {3.6906349957909822`*^9, 3.6906350019172173`*^9}, {
   3.690635045027625*^9, 3.6906350943392677`*^9}, 3.690635152179748*^9, {
   3.690635196466055*^9, 3.6906351986146917`*^9}, {3.690635237558414*^9, 
   3.690635271629936*^9}, {3.6907237349534473`*^9, 3.6907237565582657`*^9}, {
   3.690727698012603*^9, 3.69072771007452*^9}, {3.690727743028822*^9, 
   3.6907278787754602`*^9}, {3.692551202782837*^9, 3.692551327790436*^9}, {
   3.693246051855463*^9, 3.693246051889578*^9}, {3.693246103372752*^9, 
   3.693246103403874*^9}, {3.6932476799020567`*^9, 3.693247682458922*^9}, {
   3.693841694443544*^9, 3.6938417008396606`*^9}, 3.693843084917259*^9, {
   3.693843601699379*^9, 3.6938436039769773`*^9}, 3.6938513300279512`*^9, {
   3.694456582977716*^9, 3.694456585973297*^9}, {3.7007768974112997`*^9, 
   3.700776916825614*^9}, {3.7007771304628363`*^9, 3.700777142642295*^9}, {
   3.700777202822761*^9, 3.700777243056343*^9}, 3.700829655461953*^9, {
   3.710692175200328*^9, 3.7106921982577753`*^9}, {3.7118142368526297`*^9, 
   3.711814242832024*^9}, {3.711816353305887*^9, 3.7118163573563643`*^9}, {
   3.712676659867981*^9, 3.7126766655128*^9}, {3.728843043006753*^9, 
   3.728843043453844*^9}, {3.7293612917875967`*^9, 3.729361293317683*^9}, {
   3.729361613498177*^9, 3.729361614002863*^9}, {3.7293616967576723`*^9, 
   3.729361703185657*^9}, {3.7293618148635674`*^9, 3.729361857982814*^9}, {
   3.729361985357561*^9, 3.72936198784577*^9}, {3.7294297553487463`*^9, 
   3.729429759193701*^9}, {3.729433852241612*^9, 3.729433853866255*^9}, {
   3.729434697206876*^9, 3.729434697590605*^9}, {3.729446884156568*^9, 
   3.729446884556477*^9}, 3.731417083141549*^9, {3.73167171549432*^9, 
   3.731671740849411*^9}, {3.7317693763725452`*^9, 3.731769400665078*^9}, {
   3.7317722621902122`*^9, 3.731772271768383*^9}, {3.731843177055777*^9, 
   3.7318431783201237`*^9}, {3.731853441145919*^9, 3.73185345793926*^9}, {
   3.731853534409132*^9, 3.731853534671432*^9}, {3.731860031573372*^9, 
   3.7318600322027063`*^9}, {3.731860575411048*^9, 
   3.731860615644977*^9}},ExpressionUUID->"8f300e3e-04e5-4904-91ef-\
42e75d46c5bd"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"NNLS", " ", "solutions"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"AbsoluteTiming", "[", 
    RowBox[{
     RowBox[{"nnlsdistribs", "=", 
      RowBox[{"ParallelTable", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"bvectortiks", "=", 
          RowBox[{"Join", "[", 
           RowBox[{
            RowBox[{"noisywaveforms", "[", 
             RowBox[{"[", "i", "]"}], "]"}], ",", "bvectorzeros"}], "]"}]}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"RSet", "[", 
          RowBox[{"\"\<bvector2\>\"", ",", 
           RowBox[{"ToRForm", "@", "bvectortiks"}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"REvaluate", "[", 
            RowBox[{"\"\<nnls(rbind(kernel,alphas[\>\"", "<>", 
             RowBox[{"ToString", "[", "alphavalue", "]"}], "<>", 
             "\"\<]*Lmatrix),bvector2)\>\""}], "]"}], "[", 
           RowBox[{"[", 
            RowBox[{"1", ",", "1"}], "]"}], "]"}], "//", "Quiet"}]}], 
        "\[IndentingNewLine]", ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "[", "noisywaveforms", "]"}]}], "}"}]}], "]"}]}], 
     ";"}], "]"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "Measure", " ", "residual", " ", "of", " ", "fits", " ", "rescaled", " ", 
     "to", " ", "uncorrected", " ", "bg", " ", "spectra", " ", "to", " ", 
     "normalize", " ", 
     RowBox[{"noise", "."}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"amplitudes", "=", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"1.0", "-", 
          RowBox[{
           RowBox[{"bgvalidation", "[", 
            RowBox[{"[", 
             RowBox[{"i", ",", "waveformrange", ",", "2"}], "]"}], "]"}], "[", 
           RowBox[{"[", "1", "]"}], "]"}]}], ")"}], "/", 
        RowBox[{
         RowBox[{"bgvalidation", "[", 
          RowBox[{"[", 
           RowBox[{"i", ",", "waveformrange", ",", "2"}], "]"}], "]"}], "[", 
         RowBox[{"[", "1", "]"}], "]"}]}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", 
         RowBox[{"Length", "[", "nnlsdistribs", "]"}]}], "}"}]}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"reconstructed", "=", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"kernel", ".", 
            RowBox[{"nnlsdistribs", "[", 
             RowBox[{"[", "i", "]"}], "]"}]}], "/", 
           RowBox[{"Max", "[", 
            RowBox[{"kernel", ".", 
             RowBox[{"nnlsdistribs", "[", 
              RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}], ")"}], "*", 
         RowBox[{"amplitudes", "[", 
          RowBox[{"[", "i", "]"}], "]"}], "*", 
         RowBox[{"bgvalidation", "[", 
          RowBox[{"[", 
           RowBox[{"i", ",", "waveformrange", ",", "2"}], "]"}], "]"}]}], "+", 
        RowBox[{"bgvalidation", "[", 
         RowBox[{"[", 
          RowBox[{"i", ",", "waveformrange", ",", "2"}], "]"}], "]"}]}], ",", 
       
       RowBox[{"{", 
        RowBox[{"i", ",", 
         RowBox[{"Length", "[", "nnlsdistribs", "]"}]}], "}"}]}], "]"}]}], 
    ";"}], " ", 
   RowBox[{"(*", 
    RowBox[{
    "Measure", " ", "residual", " ", "of", " ", "fits", " ", "rescaled", " ", 
     "to", " ", "uncorrected", " ", "bg", " ", "spectra", " ", "to", " ", 
     "normalize", " ", 
     RowBox[{"noise", "."}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"residuals", "=", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"i", ",", 
         RowBox[{"RootMeanSquare", "[", 
          RowBox[{
           RowBox[{"bckg", "[", 
            RowBox[{"[", 
             RowBox[{"waveformrange", ",", "2"}], "]"}], "]"}], "-", 
           RowBox[{"reconstructed", "[", 
            RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", 
         RowBox[{"Length", "[", "noisywaveforms", "]"}]}], "}"}]}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"bgpoints", "=", 
     RowBox[{
      RowBox[{
       RowBox[{"bckg", "[", 
        RowBox[{"[", 
         RowBox[{"#", ",", "1"}], "]"}], "]"}], "&"}], "@", "bgpositions"}]}],
     ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"Legacy", " ", "Noise", " ", "stuff", " ", "do", " ", "be", " ", 
     RowBox[{"deleted", "/", 
      RowBox[{"modified", ":", " ", "redisidualchunks"}]}]}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"residualchunks", "=", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{"bgpoints", ",", 
          RowBox[{"residuals", "[", 
           RowBox[{"[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"i", "*", 
                RowBox[{
                 RowBox[{"Length", "[", "residuals", "]"}], "/", 
                 "noisetries"}]}], "-", 
               RowBox[{
                RowBox[{"Length", "[", "residuals", "]"}], "/", 
                "noisetries"}], "+", "1"}], ";;", 
              RowBox[{"i", "*", 
               RowBox[{
                RowBox[{"Length", "[", "residuals", "]"}], "/", 
                "noisetries"}]}]}], ",", "2"}], "]"}], "]"}]}], "}"}], 
        "\[Transpose]"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "1", ",", "noisetries"}], "}"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"{", 
      RowBox[{"wellL", ",", "wellR"}], "}"}], "=", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        RowBox[{"MaxDetect", "[", 
         RowBox[{"residualchunks", "[", 
          RowBox[{"[", 
           RowBox[{"1", ",", "All", ",", "2"}], "]"}], "]"}], "]"}], "//", 
        "bitsToIndices"}], ")"}], "[", 
      RowBox[{"[", 
       RowBox[{"1", ";;", "2"}], "]"}], "]"}]}], ";"}], " ", 
   RowBox[{"(*", 
    RowBox[{
    "Look", " ", "for", " ", "potential", " ", "well", " ", "to", " ", 
     "detect", " ", "first", " ", "minimum"}], "*)"}], "\[IndentingNewLine]", 
   
   RowBox[{
    RowBox[{
     RowBox[{"{", 
      RowBox[{"bgresidualminindex", ",", "bgresidualmin"}], "}"}], "=", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"First", "@", 
          RowBox[{"Nearest", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"residualchunks", "[", 
              RowBox[{"[", 
               RowBox[{"1", ",", "All", ",", "2"}], "]"}], "]"}], "\[Rule]", 
             "Automatic"}], ",", "#"}], "]"}]}], ",", "#"}], "}"}], "&"}], 
      "@", 
      RowBox[{"Min", "@", 
       RowBox[{"residualchunks", "[", 
        RowBox[{"[", 
         RowBox[{"1", ",", 
          RowBox[{"wellL", ";;", "wellR"}], ",", "2"}], "]"}], "]"}]}]}]}], 
    ";"}], 
   RowBox[{"(*", 
    RowBox[{"minindex", ",", " ", "min"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"mydf", "=", 
     RowBox[{
      RowBox[{"Length", "@", 
       RowBox[{"bckg", "[", 
        RowBox[{"[", "waveformrange", "]"}], "]"}]}], "-", 
      RowBox[{"Length", "[", "modelparams", "]"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"ftest", "=", 
     RowBox[{"Round", "[", 
      RowBox[{
       RowBox[{"CDF", "[", 
        RowBox[{
         RowBox[{"FRatioDistribution", "[", 
          RowBox[{"mydf", ",", "mydf"}], "]"}], ",", 
         RowBox[{
          RowBox[{"residualchunks", "[", 
           RowBox[{"[", 
            RowBox[{"1", ",", "All", ",", "2"}], "]"}], "]"}], "/", 
          "bgresidualmin"}]}], "]"}], ",", ".001"}], "]"}]}], ";"}], 
   RowBox[{"(*", 
    RowBox[{"f", "-", 
     RowBox[{
     "test", " ", "to", " ", "try", " ", "and", " ", "define", " ", "a", " ", 
      "good", " ", "bgrange"}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"starting", " ", "bg", " ", "range"}], ",", " ", 
     RowBox[{"via", " ", "edges", " ", "of", " ", "first", " ", "well"}]}], 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"filter", "=", 
     RowBox[{
      RowBox[{
       RowBox[{"Sort", "@", 
        RowBox[{"Nearest", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"ftest", "[", 
            RowBox[{"[", 
             RowBox[{"1", ";;", "#"}], "]"}], "]"}], "\[Rule]", "Automatic"}],
           ",", ".6", ",", "2"}], "]"}]}], "&"}], "@@", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"FirstPosition", "[", 
         RowBox[{
          RowBox[{"ftest", "[", 
           RowBox[{"[", 
            RowBox[{"bgresidualminindex", ";;", "All"}], "]"}], "]"}], ",", 
          "1."}], "]"}], "+", "bgresidualminindex", "-", "1"}], ")"}]}]}], 
    ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"resMin", "[", 
      RowBox[{"res_", ",", "filter_"}], "]"}], ":=", 
     RowBox[{
      RowBox[{"First", "@", 
       RowBox[{"Ordering", "@", 
        RowBox[{"res", "[", 
         RowBox[{"[", 
          RowBox[{"1", ",", 
           RowBox[{
            RowBox[{"filter", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ";;", 
            RowBox[{"filter", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], ",", "2"}], "]"}], "]"}]}]}], 
      "+", 
      RowBox[{"filter", "[", 
       RowBox[{"[", "1", "]"}], "]"}], "-", "1"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"bgresidualminindex", "=", 
     RowBox[{"resMin", "[", 
      RowBox[{"residualchunks", ",", "filter"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"backgroundrmsd", "=", 
     RowBox[{"Dynamic", "@", 
      RowBox[{"Labeled", "[", 
       RowBox[{
        RowBox[{"Show", "[", 
         RowBox[{
          RowBox[{"ListPlot", "[", 
           RowBox[{"residualchunks", ",", 
            RowBox[{"PlotMarkers", "\[Rule]", "Automatic"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"Opacity", "[", "0.4", "]"}], ",", "Thin"}], "}"}]}], 
            ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"PlotRange", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"All", ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{
                  RowBox[{"Min", "[", 
                   RowBox[{"residuals", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "2"}], "]"}], "]"}], "]"}], "-", 
                  RowBox[{".1", 
                   RowBox[{"Min", "[", 
                    RowBox[{"residuals", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "2"}], "]"}], "]"}], "]"}]}]}], ",", 
                 RowBox[{"1.1", "*", 
                  RowBox[{"Max", "[", 
                   RowBox[{"residualchunks", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", 
                    RowBox[{
                    RowBox[{"filter", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ";;", 
                    RowBox[{"filter", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], ",", "2"}], "]"}], 
                    "]"}], "]"}]}]}], "}"}]}], "}"}]}], ",", 
            RowBox[{"AxesOrigin", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"0", ",", 
               RowBox[{
                RowBox[{"Min", "[", 
                 RowBox[{"residuals", "[", 
                  RowBox[{"[", 
                   RowBox[{"All", ",", "2"}], "]"}], "]"}], "]"}], "-", 
                RowBox[{".1", 
                 RowBox[{"Min", "[", 
                  RowBox[{"residuals", "[", 
                   RowBox[{"[", 
                    RowBox[{"All", ",", "2"}], "]"}], "]"}], "]"}]}]}]}], 
              "}"}]}]}], "]"}], ",", 
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"residualchunks", "[", 
             RowBox[{"[", 
              RowBox[{"All", ",", 
               RowBox[{
                RowBox[{"filter", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], ";;", 
                RowBox[{"filter", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], ",", "All"}], "]"}], "]"}],
             ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"Black", ",", "Thick"}], "}"}]}], ",", 
            RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], ",", 
          RowBox[{"ImageSize", "\[Rule]", "500"}], ",", 
          RowBox[{"LabelStyle", "\[Rule]", 
           RowBox[{"helv", "[", "24", "]"}]}], ",", 
          RowBox[{"Epilog", "\[Rule]", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"PointSize", "[", "Large", "]"}], ",", 
             RowBox[{"color", "[", "4", "]"}], ",", 
             RowBox[{"Point", "[", 
              RowBox[{
               RowBox[{"residualchunks", "[", 
                RowBox[{"[", 
                 RowBox[{"All", ",", "bgresidualminindex", ",", "All"}], 
                 "]"}], "]"}], "[", 
               RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", 
             RowBox[{"color", "[", "1", "]"}], ",", 
             RowBox[{"Point", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"residualchunks", "[", 
                 RowBox[{"[", 
                  RowBox[{"1", ",", "#"}], "]"}], "]"}], "&"}], "@", 
               RowBox[{"resMin", "[", 
                RowBox[{"residualchunks", ",", "filter"}], "]"}]}], "]"}]}], 
            "}"}]}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"\"\<RMSD\>\"", ",", "\"\<Background Start (\[Mu]s)\>\""}], 
         "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"Left", ",", "Bottom"}], "}"}], ",", 
        RowBox[{"RotateLabel", "\[Rule]", "True"}], ",", 
        RowBox[{"LabelStyle", "\[Rule]", 
         RowBox[{"helv", "[", "24", "]"}]}], ",", 
        RowBox[{"ImageSize", "\[Rule]", "500"}], ",", 
        RowBox[{"Spacings", "\[Rule]", "0"}]}], "]"}]}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "compaire", " ", "all", " ", "vs", " ", "kept", " ", "distance", " ", 
     "distrubtions", " ", 
     RowBox[{"(", 
      RowBox[{"from", " ", "connected", " ", "region", " ", "above"}]}]}], 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"validationbackgrounds", "=", 
     RowBox[{"Dynamic", "@", 
      RowBox[{"labelT", "@", 
       RowBox[{"specPlot", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"bckg", "[", 
            RowBox[{"[", "waveformrange", "]"}], "]"}], ",", 
           RowBox[{
            RowBox[{"bgvalidation", "[", 
             RowBox[{"[", 
              RowBox[{"bgresidualminindex", ",", "All", ",", "All"}], "]"}], 
             "]"}], "[", 
            RowBox[{"[", "waveformrange", "]"}], "]"}], ",", 
           RowBox[{
            RowBox[{"bgvalidation", "[", 
             RowBox[{"[", 
              RowBox[{
               RowBox[{"resMin", "[", 
                RowBox[{"residualchunks", ",", "filter"}], "]"}], ",", "All", 
               ",", "All"}], "]"}], "]"}], "[", 
            RowBox[{"[", "waveformrange", "]"}], "]"}]}], "}"}], ",", 
         RowBox[{"PlotStyle", "\[Rule]", 
          RowBox[{"{", 
           RowBox[{"Gray", ",", 
            RowBox[{"color", "[", "4", "]"}], ",", 
            RowBox[{"color", "[", "1", "]"}]}], "}"}]}], ",", 
         RowBox[{"AxesOrigin", "\[Rule]", "Automatic"}]}], "]"}]}]}]}], ";"}],
    "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"validationchoppedplot", "=", 
     RowBox[{"Dynamic", "@", 
      RowBox[{"labelR", "@", 
       RowBox[{"Show", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"distrPlot", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{"{", 
               RowBox[{"r", ",", 
                RowBox[{"Quantile", "@@", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"nnlsdistribs", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"filter", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ";;", 
                    RowBox[{"filter", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}], ",", 
                   ".0"}], "}"}]}]}], "}"}], "\[Transpose]"}], ",", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"r", ",", 
                RowBox[{"Quantile", "@@", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"nnlsdistribs", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"filter", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ";;", 
                    RowBox[{"filter", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}], ",", 
                   "1."}], "}"}]}]}], "}"}], "\[Transpose]"}]}], "}"}], ",", 
           RowBox[{"PlotRange", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{"All", ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", 
                RowBox[{"Max", "[", 
                 RowBox[{"nnlsdistribs", "[", 
                  RowBox[{"[", 
                   RowBox[{
                    RowBox[{"filter", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ";;", 
                    RowBox[{"filter", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}], "]"}]}], 
               "}"}]}], "}"}]}], ",", 
           RowBox[{"Filling", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{"1", "\[Rule]", 
              RowBox[{"{", "2", "}"}]}], "}"}]}], ",", 
           RowBox[{"PlotStyle", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"Thin", ",", 
                RowBox[{"color", "[", "1", "]"}]}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"Thin", ",", 
                RowBox[{"color", "[", "1", "]"}]}], "}"}]}], "}"}]}]}], "]"}],
          ",", "\[IndentingNewLine]", 
         RowBox[{"distrPlot", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"{", 
             RowBox[{"r", ",", 
              RowBox[{"nnlsdistribs", "[", 
               RowBox[{"[", "bgresidualminindex", "]"}], "]"}]}], "}"}], 
            "\[Transpose]"}], ",", 
           RowBox[{"PlotStyle", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{"color", "[", "4", "]"}], "}"}]}]}], "]"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"distrPlot", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"{", 
             RowBox[{"r", ",", 
              RowBox[{"nnlsdistribs", "[", 
               RowBox[{"[", 
                RowBox[{"resMin", "[", 
                 RowBox[{"residualchunks", ",", "filter"}], "]"}], "]"}], 
               "]"}]}], "}"}], "\[Transpose]"}], ",", 
           RowBox[{"PlotStyle", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{"color", "[", "1", "]"}], "}"}]}]}], "]"}]}], 
        "\[IndentingNewLine]", "]"}]}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"{", 
      RowBox[{"\"\<Choose Residual Range:\>\"", ",", 
       RowBox[{"IntervalSlider", "[", 
        RowBox[{
         RowBox[{"Dynamic", "[", "filter", "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", 
           RowBox[{"Length", "[", "residuals", "]"}], ",", "1"}], "}"}], ",", 
         
         RowBox[{"Method", "\[Rule]", "\"\<Push\>\""}]}], "]"}], ",", 
       "\"\<   \>\"", ",", " ", "\"\<Choose Solution For Analysis:\>\"", ",", 
       
       RowBox[{"Slider", "[", 
        RowBox[{
         RowBox[{"Dynamic", "[", "bgresidualminindex", "]"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Dynamic", "[", 
            RowBox[{"filter", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", 
           RowBox[{"Dynamic", "[", 
            RowBox[{"filter", "[", 
             RowBox[{"[", "2", "]"}], "]"}], "]"}], ",", "1"}], "}"}]}], 
        "]"}], ",", 
       RowBox[{"Dynamic", "[", 
        RowBox[{"bgpoints", "[", 
         RowBox[{"[", "bgresidualminindex", "]"}], "]"}], "]"}]}], "}"}], 
     "}"}], "//", "TableForm"}], "\[IndentingNewLine]", 
   RowBox[{"bgvalidationSelection", "=", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{
       "backgroundrmsd", ",", "validationbackgrounds", ",", 
        "validationchoppedplot"}], "}"}], "}"}], "//", 
     "TableForm"}]}]}]}]], "Input",
 Editable->False,
 CellChangeTimes->{{3.687096884595625*^9, 3.687096892808879*^9}, {
   3.687096970794181*^9, 3.6870970007920713`*^9}, {3.687099348320058*^9, 
   3.687099361468258*^9}, {3.687099434777005*^9, 3.687099435646647*^9}, {
   3.687099570746928*^9, 3.6870995747611*^9}, {3.687102450913575*^9, 
   3.6871024677056093`*^9}, {3.687102704435845*^9, 3.6871027047730618`*^9}, {
   3.687186683544258*^9, 3.6871866843659477`*^9}, {3.687537045652529*^9, 
   3.687537073571303*^9}, {3.689776652907157*^9, 3.689776655625704*^9}, {
   3.689776761157607*^9, 3.689776779544467*^9}, 3.68978324198656*^9, {
   3.689784158590199*^9, 3.689784159819214*^9}, {3.6898670105241327`*^9, 
   3.6898670106716967`*^9}, {3.689869758719117*^9, 3.6898697765815353`*^9}, {
   3.689869807627249*^9, 3.689869811372013*^9}, {3.690129709483013*^9, 
   3.690129724576812*^9}, {3.6902002076936007`*^9, 3.690200259090045*^9}, {
   3.690200364000524*^9, 3.690200364446705*^9}, {3.690200403088768*^9, 
   3.690200403593544*^9}, {3.690200452712248*^9, 3.690200497319516*^9}, 
   3.690200606990487*^9, {3.690200643243038*^9, 3.690200679651531*^9}, {
   3.6902022306346607`*^9, 3.690202331198374*^9}, {3.690202366196416*^9, 
   3.690202404490121*^9}, {3.690209591141531*^9, 3.690209591794899*^9}, {
   3.690215560825643*^9, 3.6902155936443443`*^9}, {3.6902156501297617`*^9, 
   3.690215733718617*^9}, {3.69021699567318*^9, 3.690217015650086*^9}, {
   3.69021723433403*^9, 3.690217272944552*^9}, {3.690217389396208*^9, 
   3.690217395650812*^9}, {3.690217462293262*^9, 3.69021746698521*^9}, {
   3.6902175245883417`*^9, 3.6902175384006033`*^9}, {3.6902175741877947`*^9, 
   3.69021762839464*^9}, {3.690220964762323*^9, 3.6902209895623426`*^9}, {
   3.690728628808309*^9, 3.690728644093071*^9}, {3.690728723992239*^9, 
   3.690728732039466*^9}, {3.69072879086098*^9, 3.690728794753769*^9}, {
   3.6907338371703243`*^9, 3.690733838384713*^9}, {3.690736573760281*^9, 
   3.6907365739098473`*^9}, {3.690914968716329*^9, 3.69091496893786*^9}, {
   3.692550141571746*^9, 3.692550171089888*^9}, {3.69255021223037*^9, 
   3.69255021249275*^9}, {3.692550251116659*^9, 3.692550251307983*^9}, {
   3.692551413196946*^9, 3.6925514226200647`*^9}, {3.692551533240917*^9, 
   3.692551533922163*^9}, {3.692551580863186*^9, 3.69255165907887*^9}, {
   3.69255173528318*^9, 3.6925517397096853`*^9}, {3.693246051918014*^9, 
   3.69324605195895*^9}, {3.693246103419115*^9, 3.6932461034672813`*^9}, {
   3.693840251458346*^9, 3.693840251983037*^9}, {3.693840742190629*^9, 
   3.6938407423935204`*^9}, {3.6938417803985033`*^9, 
   3.6938417806424294`*^9}, {3.693841827846134*^9, 3.693841839068882*^9}, {
   3.693841888411413*^9, 3.6938419192984543`*^9}, {3.693850785049324*^9, 
   3.693850792532868*^9}, {3.693850881152103*^9, 3.6938508814538517`*^9}, {
   3.6938513913061028`*^9, 3.693851395797545*^9}, {3.694276558564745*^9, 
   3.69427655875273*^9}, {3.6944562073982267`*^9, 3.694456303801907*^9}, {
   3.694456622966991*^9, 3.694456627373968*^9}, {3.695051031822569*^9, 
   3.6950510324768047`*^9}, {3.6966100859175997`*^9, 3.696610086435154*^9}, {
   3.696792712329664*^9, 3.6967927126603613`*^9}, {3.697284306939081*^9, 
   3.69728431358664*^9}, {3.697383192506854*^9, 3.697383198084244*^9}, {
   3.697397192874733*^9, 3.697397193092683*^9}, {3.6974663899846897`*^9, 
   3.697466467714335*^9}, {3.697466518918804*^9, 3.697466521168481*^9}, {
   3.697555692502461*^9, 3.69755574065788*^9}, 3.6975614241331387`*^9, {
   3.69756146243779*^9, 3.697561557701057*^9}, {3.697561736746088*^9, 
   3.697561752785445*^9}, {3.697561819074337*^9, 3.6975619019690533`*^9}, 
   3.697562193968403*^9, {3.6975622435012712`*^9, 3.697562243833911*^9}, {
   3.697562338658822*^9, 3.697562366644721*^9}, {3.697562496287506*^9, 
   3.6975625176267357`*^9}, {3.697562571152451*^9, 3.697562580319772*^9}, {
   3.6975626223487587`*^9, 3.6975626569060383`*^9}, 3.697562756624323*^9, {
   3.697562863017672*^9, 3.697562901081592*^9}, {3.697562946196883*^9, 
   3.69756295345149*^9}, {3.697563143399437*^9, 3.697563148822997*^9}, 
   3.697563267187132*^9, {3.697563433015609*^9, 3.6975634349297743`*^9}, {
   3.6979029097560177`*^9, 3.697902938725355*^9}, {3.698505300249518*^9, 
   3.698505300714548*^9}, {3.7005257854454412`*^9, 3.7005257894488153`*^9}, {
   3.701015432667857*^9, 3.7010154388181*^9}, {3.701015474116728*^9, 
   3.7010154747455177`*^9}, {3.701692732353421*^9, 3.701692733276025*^9}, {
   3.701692803822734*^9, 3.7016928436133537`*^9}, {3.7016932579449787`*^9, 
   3.7016932783021183`*^9}, {3.703419452166072*^9, 3.703419457509452*^9}, {
   3.705771600925506*^9, 3.7057716111806993`*^9}, 3.714232131679172*^9, {
   3.714232224291774*^9, 3.714232225100265*^9}, 3.714232276586685*^9, {
   3.724512878164158*^9, 3.724512881266018*^9}, {3.724526045151222*^9, 
   3.724526050639727*^9}, {3.725984901204517*^9, 3.725984901484829*^9}, {
   3.726416475714007*^9, 3.726416477803966*^9}, {3.726498232002596*^9, 
   3.7264982377179193`*^9}, 3.728843381457253*^9, {3.728843599583991*^9, 
   3.728843618811891*^9}, {3.728843688889614*^9, 3.72884369204095*^9}, {
   3.7288437841537657`*^9, 3.728843784715475*^9}, {3.729362333093603*^9, 
   3.729362333444145*^9}, {3.729362481826109*^9, 3.7293625038064213`*^9}, {
   3.72936255396769*^9, 3.729362652601787*^9}, 3.729362720429315*^9, {
   3.7293630246120987`*^9, 3.729363029213498*^9}, 3.7293631593838453`*^9, {
   3.7294339591606007`*^9, 3.729433964298827*^9}, 3.729434638526856*^9, {
   3.729434744953051*^9, 3.729434759233078*^9}, 3.731082015976178*^9, 
   3.731082052057578*^9, 3.731251312272026*^9, {3.7312528564639053`*^9, 
   3.731252881934846*^9}, {3.731253318919796*^9, 3.731253337309257*^9}, {
   3.731253407713057*^9, 3.731253409115302*^9}, {3.7312538310006733`*^9, 
   3.731253832265334*^9}, {3.731255238232235*^9, 3.731255311027863*^9}, {
   3.731255384298064*^9, 3.731255389258841*^9}, 3.731256420611846*^9, {
   3.731256760131898*^9, 3.7312567617687407`*^9}, 3.731256809162361*^9, {
   3.731257577902156*^9, 3.7312575783955297`*^9}, {3.731257636019349*^9, 
   3.731257669484754*^9}, {3.731671779398381*^9, 3.731671786872061*^9}, {
   3.73167234265114*^9, 3.731672344104424*^9}, {3.7316808653625507`*^9, 
   3.731680868748991*^9}, {3.731681525337759*^9, 3.731681532037553*^9}, {
   3.7317770455505257`*^9, 3.7317770467653627`*^9}, {3.731777077699724*^9, 
   3.7317770826508417`*^9}, {3.7317775317432213`*^9, 3.731777539155854*^9}, {
   3.731843680337027*^9, 3.731843681044293*^9}, {3.7318478683144827`*^9, 
   3.731847899063274*^9}, 3.731848235275589*^9, {3.731848910650917*^9, 
   3.731848918761222*^9}, {3.731849608044463*^9, 3.731849610764*^9}, {
   3.731849671220851*^9, 3.731849697569539*^9}, {3.731851273644639*^9, 
   3.7318513423965607`*^9}, {3.7318516074072104`*^9, 3.731851658028143*^9}, {
   3.731853077188805*^9, 3.7318533104186172`*^9}, {3.7318585232046423`*^9, 
   3.731858532118362*^9}, {3.7318588632367353`*^9, 3.731858887081842*^9}, {
   3.731859176608822*^9, 3.73185919083357*^9}, {3.731859472402287*^9, 
   3.731859474056877*^9}, {3.7318616791740713`*^9, 3.731861679689735*^9}, {
   3.731863469407351*^9, 
   3.731863469919982*^9}},ExpressionUUID->"3021aece-0105-4d92-a605-\
8fc58b6009ed"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"nnlsdistribschopped", "=", 
   RowBox[{"nnlsdistribs", "[", 
    RowBox[{"[", 
     RowBox[{
      RowBox[{"filter", "[", 
       RowBox[{"[", "1", "]"}], "]"}], ";;", 
      RowBox[{"filter", "[", 
       RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"waveformbest", "=", 
   RowBox[{"noisywaveforms", "[", 
    RowBox[{"[", "bgresidualminindex", "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"tikhonovbest", "=", 
   RowBox[{"nnlsdistribs", "[", 
    RowBox[{"[", "bgresidualminindex", "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"bgbest", "=", 
    RowBox[{"bgvalidation", "[", 
     RowBox[{"[", 
      RowBox[{"bgresidualminindex", ",", "All", ",", "All"}], "]"}], "]"}]}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"optimizedbackground", "=", 
   RowBox[{"labelT", "@", 
    RowBox[{"specPlot", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"bckg", "[", 
         RowBox[{"[", "waveformrange", "]"}], "]"}], ",", 
        RowBox[{"bgbest", "[", 
         RowBox[{"[", "waveformrange", "]"}], "]"}]}], "}"}], ",", 
      RowBox[{"AxesOrigin", "\[Rule]", "Automatic"}]}], "]"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"noiserrorplotsmall", "=", 
    RowBox[{"labelR", "@", 
     RowBox[{"distrPlot", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{"r", ",", 
          RowBox[{"nnlsdistribs", "[", 
           RowBox[{"[", "bgresidualminindex", "]"}], "]"}]}], "}"}], 
        "\[Transpose]"}], ",", 
       RowBox[{"PlotStyle", "\[Rule]", 
        RowBox[{"{", "Thick", "}"}]}]}], "]"}]}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"{", 
   RowBox[{"{", 
    RowBox[{"optimizedbackground", ",", "noiserrorplotsmall"}], "}"}], "}"}], 
  "//", "TableForm"}]}], "Input",
 Editable->False,
 CellChangeTimes->{{3.687107883088278*^9, 3.6871079149983797`*^9}, {
   3.687108323708385*^9, 3.687108370610878*^9}, {3.687537419923471*^9, 
   3.6875374238218107`*^9}, 3.6875417982302837`*^9, {3.687541974408526*^9, 
   3.687541980286098*^9}, {3.6876216541316423`*^9, 3.687621664346294*^9}, {
   3.68762319624444*^9, 3.6876231968228283`*^9}, {3.6898674033874407`*^9, 
   3.6898674057586403`*^9}, {3.689867448201524*^9, 3.689867477470187*^9}, {
   3.6898675120036583`*^9, 3.6898675202659616`*^9}, {3.6898675827403584`*^9, 
   3.6898675940941*^9}, {3.689867640482003*^9, 3.689867697992885*^9}, {
   3.689867730432726*^9, 3.6898678382798357`*^9}, {3.689867891671556*^9, 
   3.689867896191988*^9}, {3.6898679430461597`*^9, 3.689867944586607*^9}, {
   3.6898680282029057`*^9, 3.689868087293631*^9}, {3.6898681358922653`*^9, 
   3.68986814196202*^9}, {3.689868218751371*^9, 3.6898682393340397`*^9}, {
   3.690218937277717*^9, 3.6902189460052834`*^9}, {3.6913399053582697`*^9, 
   3.6913399565345917`*^9}, {3.6913425284537897`*^9, 
   3.6913425424287243`*^9}, {3.691347116875725*^9, 3.691347118010212*^9}, {
   3.692551814505114*^9, 3.6925518437863617`*^9}, {3.692555423173141*^9, 
   3.6925554275686607`*^9}, {3.693151867158607*^9, 3.6931518788824463`*^9}, {
   3.693246051983924*^9, 3.693246052008885*^9}, {3.693246103488873*^9, 
   3.693246103506302*^9}, {3.693248613777184*^9, 3.6932486173736467`*^9}, {
   3.6974665859579287`*^9, 3.697466586632313*^9}, {3.697466713271935*^9, 
   3.6974667137643557`*^9}, {3.697563274548615*^9, 3.697563275769288*^9}, 
   3.7005258711218367`*^9, {3.725985125265646*^9, 3.7259851574121017`*^9}, 
   3.729341430190392*^9, {3.729363269388008*^9, 3.7293632989095097`*^9}, {
   3.729363361454026*^9, 3.729363380334669*^9}, 3.729363443909082*^9, {
   3.7293635050904922`*^9, 3.729363507653319*^9}, {3.729435164929942*^9, 
   3.7294351786038837`*^9}, {3.729435262803854*^9, 3.729435269734294*^9}, {
   3.731258312692381*^9, 3.731258346801409*^9}, {3.731671821112154*^9, 
   3.731671835774268*^9}},ExpressionUUID->"354fa1ae-7123-4baa-9ff8-\
ac36e8d96b61"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"cutoffpoint", "=", 
   RowBox[{
    RowBox[{"Nearest", "[", 
     RowBox[{"r", ",", 
      RowBox[{"5", "*", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"Last", "[", "t", "]"}], "/", "2"}], ")"}], "^", 
        RowBox[{"(", 
         RowBox[{"1", "/", "3"}], ")"}]}]}]}], "]"}], "[", 
    RowBox[{"[", "1", "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"{", 
  RowBox[{
   RowBox[{"Slider", "[", 
    RowBox[{
     RowBox[{"Dynamic", "[", "cutoffpoint", "]"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"r", "[", 
        RowBox[{"[", "1", "]"}], "]"}], ",", 
       RowBox[{"Last", "[", "r", "]"}], ",", 
       RowBox[{
        RowBox[{"r", "[", 
         RowBox[{"[", "2", "]"}], "]"}], "-", 
        RowBox[{"r", "[", 
         RowBox[{"[", "1", "]"}], "]"}]}]}], "}"}]}], "]"}], ",", 
   RowBox[{"Dynamic", "[", "cutoffpoint", "]"}]}], 
  "}"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"bgcorrectionplot", "=", 
   RowBox[{"Dynamic", "@", 
    RowBox[{"labelR", "@", 
     RowBox[{"distrPlot", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{"r", ",", "tikhonovbest"}], "}"}], "\[Transpose]"}], ",", 
       RowBox[{"PlotStyle", "\[Rule]", 
        RowBox[{"{", "Thick", "}"}]}], ",", 
       RowBox[{"PlotRange", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"All", ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", 
            RowBox[{
             RowBox[{"Max", "[", "tikhonovbest", "]"}], "+", ".002"}]}], 
           "}"}]}], "}"}]}], ",", 
       RowBox[{"Epilog", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"LightGreen", ",", 
            RowBox[{"Opacity", "[", "0.4", "]"}], ",", 
            RowBox[{"Rectangle", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "0"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"cutoffpoint", ",", 
                RowBox[{
                 RowBox[{"Max", "[", "tikhonovbest", "]"}], "+", ".002"}]}], 
               "}"}]}], "]"}], ",", "LightRed", ",", 
            RowBox[{"Opacity", "[", "0.4", "]"}], ",", 
            RowBox[{"Rectangle", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"cutoffpoint", ",", "0"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"Last", "[", "r", "]"}], ",", 
                RowBox[{
                 RowBox[{"Max", "[", "tikhonovbest", "]"}], "+", ".002"}]}], 
               "}"}]}], "]"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"Green", ",", 
            RowBox[{"Arrowheads", "[", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", ".04"}], ",", ".04"}], "}"}], "]"}], ",", 
            RowBox[{"Arrow", "[", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"First", "[", "r", "]"}], ",", 
                 RowBox[{
                  RowBox[{"Max", "[", "tikhonovbest", "]"}], "+", 
                  ".00015"}]}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"cutoffpoint", ",", 
                 RowBox[{
                  RowBox[{"Max", "[", "tikhonovbest", "]"}], "+", 
                  ".00015"}]}], "}"}]}], "}"}], "]"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"Red", ",", 
            RowBox[{"Arrowheads", "[", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", ".04"}], ",", ".04"}], "}"}], "]"}], ",", 
            RowBox[{"Arrow", "[", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"cutoffpoint", ",", 
                 RowBox[{
                  RowBox[{"Max", "[", "tikhonovbest", "]"}], "+", 
                  ".00015"}]}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"Last", "[", "r", "]"}], ",", 
                 RowBox[{
                  RowBox[{"Max", "[", "tikhonovbest", "]"}], "+", 
                  ".00015"}]}], "}"}]}], "}"}], "]"}]}], "}"}], ",", 
          RowBox[{"Text", "[", 
           RowBox[{
            RowBox[{"Style", "[", 
             RowBox[{"\"\<Stable Populations\>\"", ",", 
              RowBox[{"helv", "[", "16", "]"}], ",", "Green"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{
               RowBox[{"First", "[", "r", "]"}], "+", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"cutoffpoint", "-", 
                  RowBox[{"First", "[", "r", "]"}]}], ")"}], "/", "2"}]}], 
              ",", 
              RowBox[{
               RowBox[{"Max", "[", "tikhonovbest", "]"}], "+", ".0007"}]}], 
             "}"}]}], "]"}], ",", 
          RowBox[{"Text", "[", 
           RowBox[{
            RowBox[{"Style", "[", 
             RowBox[{"\"\<BG Correction\>\"", ",", 
              RowBox[{"helv", "[", "16", "]"}], ",", "Red"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"cutoffpoint", "+", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"Last", "[", "r", "]"}], "-", "cutoffpoint"}], 
                 ")"}], "/", "2"}]}], ",", 
              RowBox[{
               RowBox[{"Max", "[", "tikhonovbest", "]"}], "+", ".0007"}]}], 
             "}"}]}], "]"}]}], "}"}]}]}], "]"}]}]}]}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]"}], "Input",
 Editable->False,
 CellChangeTimes->{{3.698168231965521*^9, 3.6981682323261623`*^9}, {
   3.698168274803602*^9, 3.6981683508618517`*^9}, {3.6981683875793*^9, 
   3.698168458956448*^9}, {3.698168535576083*^9, 3.6981685635860243`*^9}, 
   3.69817386381802*^9, {3.698509862866356*^9, 3.698509864659958*^9}, 
   3.699892530695026*^9, {3.700523642496764*^9, 3.700523692065999*^9}, 
   3.700523768973854*^9, {3.7005238986931133`*^9, 3.700523987519183*^9}, {
   3.700524066279551*^9, 3.700524066600531*^9}, {3.7005241142915697`*^9, 
   3.700524212248502*^9}, {3.700524443563725*^9, 3.700524517791147*^9}, {
   3.7005245984154577`*^9, 3.700524672186215*^9}, {3.700524719517213*^9, 
   3.7005247529886436`*^9}, {3.700524797754116*^9, 3.700524801718898*^9}, {
   3.700524855835438*^9, 3.7005248975366983`*^9}, {3.7005249638016644`*^9, 
   3.700524970697823*^9}, {3.700525015743348*^9, 3.7005252023200493`*^9}, {
   3.7005255749222393`*^9, 3.700525591425071*^9}, {3.700525897877719*^9, 
   3.700525983676484*^9}, {3.700526078951548*^9, 3.700526104178522*^9}, {
   3.700526162233132*^9, 3.700526214097012*^9}, {3.729363541174101*^9, 
   3.729363638925398*^9}, {3.72936369896454*^9, 3.729363747606186*^9}, 
   3.729364556669388*^9, 3.72936458925029*^9, {3.72943528915901*^9, 
   3.729435304183867*^9}, 3.731258406155302*^9, 3.731340060055921*^9, {
   3.731340186198238*^9, 3.731340210026662*^9}, {3.73134024903052*^9, 
   3.7313403526315193`*^9}},ExpressionUUID->"4c4e879d-4b73-4c90-ad36-\
1dc62baee1ae"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"distancemask", "=", 
   RowBox[{"0", "*", "r"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"distancemask", "[", 
    RowBox[{"[", 
     RowBox[{"getrange", "[", 
      RowBox[{"r", ",", "cutoffpoint", ",", 
       RowBox[{"Last", "[", "r", "]"}]}], "]"}], "]"}], "]"}], "=", "1"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"extrabackground", "=", 
    RowBox[{"tikhonovbest", "*", "distancemask"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"newwaveform", "=", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{"waveformbest", "-", 
       RowBox[{"kernel", ".", "extrabackground"}]}], ")"}], "/", 
     RowBox[{"(", 
      RowBox[{"1.0", "-", 
       RowBox[{"Max", "[", 
        RowBox[{"kernel", ".", "extrabackground"}], "]"}]}], ")"}]}]}], ";"}],
   "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"RSet", "[", 
   RowBox[{"\"\<bvector2\>\"", ",", 
    RowBox[{"ToRForm", "@", 
     RowBox[{"Join", "[", 
      RowBox[{"newwaveform", ",", "bvectorzeros"}], "]"}]}]}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"newdistribution", "=", 
   RowBox[{
    RowBox[{"REvaluate", "[", 
     RowBox[{"\"\<nnls(rbind(kernel,alphas[\>\"", "<>", 
      RowBox[{"ToString", "[", "alphavalue", "]"}], "<>", 
      "\"\<]*Lmatrix),bvector2)\>\""}], "]"}], "[", 
    RowBox[{"[", 
     RowBox[{"1", ",", "1"}], "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"newdistribution", "=", 
    RowBox[{"newdistribution", "/", 
     RowBox[{"NIntegrate", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Interpolation", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"r", ",", "newdistribution"}], "}"}], "\[Transpose]"}], 
         "]"}], "[", "x", "]"}], ",", 
       RowBox[{"Prepend", "[", 
        RowBox[{
         RowBox[{"MinMax", "[", "r", "]"}], ",", "x"}], "]"}]}], "]"}]}]}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"labelT", "@", 
       RowBox[{"specPlot", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{"t", ",", "newwaveform"}], "}"}], "\[Transpose]"}], ",", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"t", ",", 
             RowBox[{
              RowBox[{"kernel", ".", "newdistribution"}], "/", 
              RowBox[{"Max", "[", 
               RowBox[{"kernel", ".", "newdistribution"}], "]"}]}]}], "}"}], 
           "\[Transpose]"}]}], "}"}], "]"}]}], ",", 
      RowBox[{"labelR", "@", 
       RowBox[{"distrPlot", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"{", 
             RowBox[{"r", ",", "newdistribution"}], "}"}], "\[Transpose]"}], 
           ",", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"r", ",", 
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"tikhonovbest", "-", "extrabackground"}], ")"}], "/", 
                RowBox[{"NIntegrate", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Interpolation", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"r", ",", 
                    RowBox[{"tikhonovbest", "-", "extrabackground"}]}], "}"}],
                     "\[Transpose]"}], "]"}], "[", "x", "]"}], ",", 
                  RowBox[{"Prepend", "[", 
                   RowBox[{
                    RowBox[{"MinMax", "[", "r", "]"}], ",", "x"}], "]"}]}], 
                 "]"}]}], "+", ".03"}]}], "}"}], "\[Transpose]"}], ",", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"r", ",", 
              RowBox[{
               RowBox[{"tikhonovbest", "/", 
                RowBox[{"NIntegrate", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Interpolation", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"r", ",", 
                    RowBox[{"tikhonovbest", "-", "extrabackground"}]}], "}"}],
                     "\[Transpose]"}], "]"}], "[", "x", "]"}], ",", 
                  RowBox[{"Prepend", "[", 
                   RowBox[{
                    RowBox[{"MinMax", "[", "r", "]"}], ",", "x"}], "]"}]}], 
                 "]"}]}], "+", ".06"}]}], "}"}], "\[Transpose]"}]}], "}"}], 
         ",", 
         RowBox[{"PlotStyle", "\[Rule]", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"Black", ",", "Thick"}], "}"}], ",", 
            RowBox[{"color", "[", "1", "]"}], ",", 
            RowBox[{"color", "[", "4", "]"}]}], "}"}]}]}], "]"}]}]}], "}"}], 
    "}"}], "//", "TableForm"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]"}], "Input",
 Editable->False,
 CellChangeTimes->{{3.701702610221889*^9, 3.701702610566577*^9}, {
   3.7017027887200203`*^9, 3.701702869274186*^9}, {3.701702906136241*^9, 
   3.7017029700274487`*^9}, {3.701703003105936*^9, 3.7017031662365723`*^9}, {
   3.701703266948628*^9, 3.701703325358876*^9}, {3.701703371930615*^9, 
   3.70170346360807*^9}, {3.701703515724028*^9, 3.701703516578224*^9}, {
   3.701706490135283*^9, 3.701706494710273*^9}, {3.7017859822239523`*^9, 
   3.701785983503066*^9}, {3.70178620519671*^9, 3.7017862071174803`*^9}, {
   3.7017864237422113`*^9, 3.701786424228696*^9}, {3.701786612348617*^9, 
   3.701786660711499*^9}, {3.70178669186789*^9, 3.701786758978983*^9}, {
   3.706291403431231*^9, 3.706291411247168*^9}, {3.729341476879511*^9, 
   3.729341529479051*^9}, {3.729341581078165*^9, 3.729341708101264*^9}, {
   3.729364641030065*^9, 3.729364642341344*^9}, {3.7293646946212683`*^9, 
   3.7293647166583242`*^9}, 3.7293647951653337`*^9, {3.729364860492935*^9, 
   3.729364862983564*^9}, {3.729435318772348*^9, 3.7294353269894257`*^9}, {
   3.7312584622587023`*^9, 
   3.731258472048304*^9}},ExpressionUUID->"696b043b-fab6-4b40-b602-\
48f9addbe05c"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"populationMatrix", "=", 
   RowBox[{"Table", "[", 
    RowBox[{"0", ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", "6"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"populationValues", "=", 
   RowBox[{"Table", "[", 
    RowBox[{"0", ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", "6"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"alreadyoptimized", "=", "0"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"pt", "=", 
   RowBox[{"{", 
    RowBox[{".5", ",", ".5"}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"npops", "=", 
   RowBox[{"{", 
    RowBox[{"1", ",", "1"}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"populations", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"1", "+", 
         RowBox[{"Range", "[", "i", "]"}]}], ",", 
        RowBox[{"0", "*", 
         RowBox[{"Range", "[", "i", "]"}]}]}], "}"}], "\[Transpose]"}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "6"}], "}"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"rmsdTik", "=", 
    RowBox[{
     RowBox[{"RootMeanSquare", "[", 
      RowBox[{"newwaveform", "-", 
       RowBox[{
        RowBox[{"kernel", ".", "newdistribution"}], "/", 
        RowBox[{"Max", "[", 
         RowBox[{"kernel", ".", "newdistribution"}], "]"}]}]}], "]"}], "*", 
     RowBox[{"10", "^", "2"}]}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"noiserrorplot", "=", 
   RowBox[{
    RowBox[{
     RowBox[{"labelR", "[", 
      RowBox[{
       RowBox[{"distrPlot", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{"r", ",", "newdistribution"}], "}"}], "\[Transpose]"}], 
         ",", 
         RowBox[{"PlotStyle", "->", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"color", "[", "1", "]"}], ",", "Dashed", ",", "Thick"}], 
           "}"}]}], ",", "##"}], "]"}], ",", "##"}], "]"}], "&"}], "@@", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"ImageSize", "\[Rule]", "750"}], ",", 
      RowBox[{"LabelStyle", "\[Rule]", 
       RowBox[{"helv", "[", "42", "]"}]}]}], "}"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"{", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"ClickPane", "[", 
      RowBox[{
       RowBox[{"Dynamic", "[", 
        RowBox[{"ArrayPlot", "[", 
         RowBox[{
          RowBox[{"{", "populationMatrix", "}"}], ",", 
          RowBox[{"ImageSize", "\[Rule]", "200"}], ",", 
          RowBox[{"Mesh", "\[Rule]", "All"}], ",", 
          RowBox[{"ColorRules", "\[Rule]", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"0", "\[Rule]", "Red"}], ",", 
             RowBox[{"1", "\[Rule]", "Green"}]}], "}"}]}], ",", 
          RowBox[{"FrameTicks", "\[Rule]", 
           RowBox[{"{", 
            RowBox[{"False", ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"1", ",", "\"\<1G\>\""}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"2", ",", "\"\<2G\>\""}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"3", ",", "\"\<3G\>\""}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"4", ",", "\"\<4G\>\""}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"5", ",", "\"\<5G\>\""}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"6", ",", "\"\<6G\>\""}], "}"}]}], "}"}]}], "}"}]}], 
          ",", 
          RowBox[{"FrameStyle", "->", 
           RowBox[{"Opacity", "[", "0", "]"}]}], ",", 
          RowBox[{"FrameTicksStyle", "\[Rule]", 
           RowBox[{"Opacity", "[", "1", "]"}]}], ",", 
          RowBox[{"Frame", "\[Rule]", "True"}], ",", 
          RowBox[{
          "PlotLabel", "\[Rule]", "\"\<Number of Fitted Gaussians\>\""}], ",", 
          RowBox[{"Epilog", "\[Rule]", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"EdgeForm", "[", "Thick", "]"}], ",", 
             RowBox[{"Opacity", "[", "0.0", "]"}], ",", 
             RowBox[{"Rectangle", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"Floor", "[", 
                  RowBox[{"pt", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", "0"}], "}"}], 
               ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"Ceiling", "[", 
                  RowBox[{"pt", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", "1"}], "}"}]}],
               "]"}]}], "}"}]}]}], "]"}], "]"}], ",", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"0", "<=", 
            RowBox[{"#", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "\[LessEqual]", "6"}], ",", 
           RowBox[{
            RowBox[{"pt", "=", "#"}], ";", 
            RowBox[{"npops", "=", 
             RowBox[{"Dynamic", "[", 
              RowBox[{
               RowBox[{"Floor", "[", 
                RowBox[{"pt", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "]"}], "+", "1"}], "]"}]}], 
            ";"}]}], "]"}], ")"}], "&"}]}], "]"}], ",", "\[IndentingNewLine]",
      "\[IndentingNewLine]", 
     RowBox[{"Button", "[", 
      RowBox[{
      "\"\<Fit Tikhonov\>\"", ",", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"alreadyoptimized", "=", "0"}], ";", "\[IndentingNewLine]", 
        RowBox[{"fitresult", "=", 
         RowBox[{"gaussianmodel", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"{", 
             RowBox[{"r", ",", "newdistribution"}], "}"}], "\[Transpose]"}], 
           ",", 
           RowBox[{"populations", "[", 
            RowBox[{"[", 
             RowBox[{"npops", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"dataconfig", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"\[Mu]", "[", "#", "]"}], ",", 
             RowBox[{"A", "[", "#", "]"}], ",", 
             RowBox[{"\[Sigma]", "[", "#", "]"}]}], "}"}], "&"}], "/@", 
          RowBox[{"Range", "[", 
           RowBox[{"Length", "[", 
            RowBox[{"populations", "[", 
             RowBox[{"[", 
              RowBox[{"npops", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "]"}], "]"}]}]}],
         ";", "\[IndentingNewLine]", 
        RowBox[{"gaussiandistrib", "=", 
         RowBox[{"Total", "@", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"peakfunc", "[", 
               RowBox[{"##", ",", "r"}], "]"}], "&"}], "@@@", "dataconfig"}], 
            "/.", "fitresult"}], ")"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"resultstable", "=", 
         RowBox[{"tabletext", "[", 
          RowBox[{"fitresult", ",", "Black"}], "]"}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"populationMatrix", "[", 
          RowBox[{"[", 
           RowBox[{"Length", "[", 
            RowBox[{"populations", "[", 
             RowBox[{"[", 
              RowBox[{"npops", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "]"}], "]"}], 
          "]"}], "=", "1"}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"populationValues", "[", 
          RowBox[{"[", 
           RowBox[{"Length", "[", 
            RowBox[{"populations", "[", 
             RowBox[{"[", 
              RowBox[{"npops", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "]"}], "]"}], 
          "]"}], "=", "fitresult"}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"populations", "[", 
          RowBox[{"[", 
           RowBox[{"npops", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "=", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{"dataconfig", "/.", "fitresult"}], ")"}], "[", 
             RowBox[{"[", 
              RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", 
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"peakfunc", "[", 
                    RowBox[{"##", ",", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"dataconfig", "/.", "fitresult"}], ")"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "1"}], "]"}], "]"}]}], "]"}], "&"}], "@@@",
                   "dataconfig"}], "/.", "fitresult"}], ")"}], "[", 
               RowBox[{"[", "i", "]"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", 
                RowBox[{"Length", "[", "dataconfig", "]"}]}], "}"}]}], 
             "]"}]}], "}"}], "\[Transpose]"}]}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"fitplots", "[", 
          RowBox[{"[", 
           RowBox[{"npops", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "=", 
         RowBox[{
          RowBox[{
           RowBox[{"labelR", "[", 
            RowBox[{
             RowBox[{"distrPlot", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"r", ",", "newdistribution"}], "}"}], 
                  "\[Transpose]"}], ",", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"r", ",", "gaussiandistrib"}], "}"}], 
                  "\[Transpose]"}]}], "}"}], ",", 
               RowBox[{"PlotStyle", "\[Rule]", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"color", "[", "1", "]"}], ",", "Dashed", ",", 
                    "Thick"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"Black", ",", "Thick"}], "}"}]}], "}"}]}], ",", 
               RowBox[{"Epilog", "\[Rule]", 
                RowBox[{"{", 
                 RowBox[{"Locator", "[", 
                  RowBox[{
                   RowBox[{"Scaled", "[", 
                    RowBox[{"{", 
                    RowBox[{".75", ",", ".8"}], "}"}], "]"}], ",", 
                   "resultstable"}], "]"}], "}"}]}], ",", "##"}], "]"}], ",", 
             "##"}], "]"}], "&"}], "@@", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"ImageSize", "\[Rule]", "750"}], ",", 
            RowBox[{"LabelStyle", "\[Rule]", 
             RowBox[{"helv", "[", "42", "]"}]}]}], "}"}]}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"gaussianfit", "=", 
         RowBox[{"Total", "@", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"peakfunc", "[", 
               RowBox[{"##", ",", "r"}], "]"}], "&"}], "@@@", "dataconfig"}], 
            "/.", "fitresult"}], ")"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"gaussianplots", "[", 
          RowBox[{"[", 
           RowBox[{"npops", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "=", 
         RowBox[{
          RowBox[{
           RowBox[{"labelT", "[", 
            RowBox[{
             RowBox[{"Show", "[", 
              RowBox[{
               RowBox[{"specPlot", "[", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"{", 
                    RowBox[{"t", ",", "newwaveform"}], "}"}], 
                    "\[Transpose]"}], ",", 
                   RowBox[{
                    RowBox[{"{", 
                    RowBox[{"t", ",", 
                    RowBox[{
                    RowBox[{"kernel", ".", "gaussianfit"}], "/", 
                    RowBox[{"Max", "[", 
                    RowBox[{"kernel", ".", "gaussianfit"}], "]"}]}]}], "}"}], 
                    "\[Transpose]"}], ",", 
                   RowBox[{
                    RowBox[{"{", 
                    RowBox[{"t", ",", 
                    RowBox[{
                    RowBox[{"kernel", ".", "newdistribution"}], "/", 
                    RowBox[{"Max", "[", 
                    RowBox[{"kernel", ".", "newdistribution"}], "]"}]}]}], 
                    "}"}], "\[Transpose]"}]}], "}"}], ",", 
                 RowBox[{"PlotStyle", "\[Rule]", 
                  RowBox[{"{", 
                   RowBox[{"Gray", ",", "Black", ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"color", "[", "1", "]"}], ",", "Dashed"}], 
                    "}"}]}], "}"}]}], ",", "##"}], "]"}], ",", 
               RowBox[{"ListPlot", "[", 
                RowBox[{
                 RowBox[{"{", "}"}], ",", 
                 RowBox[{"Joined", "\[Rule]", "True"}], ",", 
                 RowBox[{"PlotLegends", "->", 
                  RowBox[{"Placed", "[", 
                   RowBox[{
                    RowBox[{"LineLegend", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Directive", "[", 
                    RowBox[{
                    RowBox[{"color", "[", "1", "]"}], ",", "Dashed"}], "]"}], 
                    ",", "Black"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Style", "[", 
                    RowBox[{"\"\<Tikhonov\>\"", ",", 
                    RowBox[{"helv", "[", "20", "]"}]}], "]"}], ",", 
                    RowBox[{"Style", "[", 
                    RowBox[{"\"\<Gaussian Model\>\"", ",", 
                    RowBox[{"helv", "[", "20", "]"}]}], "]"}]}], "}"}]}], 
                    "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{".8", ",", ".9"}], "}"}]}], "]"}]}]}], "]"}]}], 
              "]"}], ",", "##"}], "]"}], "&"}], "@@", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"ImageSize", "\[Rule]", "750"}], ",", 
            RowBox[{"LabelStyle", "\[Rule]", 
             RowBox[{"helv", "[", "42", "]"}]}]}], "}"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"gaussianresiduals", "[", 
          RowBox[{"[", 
           RowBox[{"npops", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "=", 
         RowBox[{
          RowBox[{
           RowBox[{"labelT", "[", 
            RowBox[{
             RowBox[{"specPlot", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"t", ",", 
                    RowBox[{"newwaveform", "-", 
                    RowBox[{
                    RowBox[{"kernel", ".", "gaussianfit"}], "/", 
                    RowBox[{"Max", "[", 
                    RowBox[{"kernel", ".", "gaussianfit"}], "]"}]}]}]}], 
                   "}"}], "\[Transpose]"}], ",", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"t", ",", 
                    RowBox[{"newwaveform", "-", 
                    RowBox[{
                    RowBox[{"kernel", ".", "newdistribution"}], "/", 
                    RowBox[{"Max", "[", 
                    RowBox[{"kernel", ".", "newdistribution"}], "]"}]}]}]}], 
                   "}"}], "\[Transpose]"}]}], "}"}], ",", 
               RowBox[{"PlotStyle", "\[Rule]", 
                RowBox[{"{", 
                 RowBox[{"Black", ",", 
                  RowBox[{"color", "[", "1", "]"}]}], "}"}]}], ",", 
               RowBox[{"AxesOrigin", "\[Rule]", 
                RowBox[{"{", 
                 RowBox[{"0", ",", "0"}], "}"}]}], ",", "##"}], "]"}], ",", 
             "##"}], "]"}], "&"}], "@@", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"ImageSize", "\[Rule]", "750"}], ",", 
            RowBox[{"LabelStyle", "\[Rule]", 
             RowBox[{"helv", "[", "42", "]"}]}]}], "}"}]}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"gaussianfits", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"gaussianresult", "[", 
            RowBox[{
             RowBox[{"populationValues", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", "r"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", 
             RowBox[{
              RowBox[{"bitsToIndices", "[", "populationMatrix", "]"}], "//", 
              "Last"}]}], "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"gaussianwaveforms", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"kernel", ".", 
             RowBox[{"gaussianfits", "[", 
              RowBox[{"[", "i", "]"}], "]"}]}], "/", 
            RowBox[{"Max", "[", 
             RowBox[{"kernel", ".", 
              RowBox[{"gaussianfits", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", 
             RowBox[{"Length", "[", "gaussianfits", "]"}]}], "}"}]}], "]"}]}],
         ";", "\[IndentingNewLine]", 
        RowBox[{"gaussianRMSDs", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"RootMeanSquare", "[", 
            RowBox[{"newwaveform", "-", 
             RowBox[{"gaussianwaveforms", "[", 
              RowBox[{"[", "i", "]"}], "]"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", 
             RowBox[{"Length", "[", "gaussianfits", "]"}]}], "}"}]}], "]"}]}],
         ";", "\[IndentingNewLine]", 
        RowBox[{"gaussianBICs", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"bic", "[", 
            RowBox[{"newwaveform", ",", 
             RowBox[{"gaussianwaveforms", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", 
             RowBox[{"i", "*", "3"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", 
             RowBox[{"Length", "[", "gaussianfits", "]"}]}], "}"}]}], "]"}]}],
         ";", "\[IndentingNewLine]", 
        RowBox[{"tempbestpopulation", "=", 
         RowBox[{
          RowBox[{"MinimalBy", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"Range", "[", 
                RowBox[{"Length", "[", "gaussianBICs", "]"}], "]"}], ",", 
               "gaussianBICs"}], "}"}], "\[Transpose]"}], ",", "Last"}], 
           "]"}], "[", 
          RowBox[{"[", 
           RowBox[{"1", ",", "1"}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"indexoffirst", "=", "1"}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"myepilog", "=", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"Dashed", ",", "Thick", ",", 
             RowBox[{"Line", "[", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"0", ",", "rmsdTik"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"6.2", ",", "rmsdTik"}], "}"}]}], "}"}], "]"}]}], 
            "}"}], ",", 
           RowBox[{"Text", "[", 
            RowBox[{
             RowBox[{"Style", "[", 
              RowBox[{"\"\<Tikhonov\>\"", ",", 
               RowBox[{"helv", "[", "24", "]"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"5.6", ",", 
               RowBox[{"rmsdTik", "-", ".13"}]}], "}"}]}], "]"}], ",", 
           RowBox[{"Arrow", "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"tempbestpopulation", ",", 
                RowBox[{
                 RowBox[{
                  RowBox[{"10", "^", "2"}], "*", 
                  RowBox[{"gaussianRMSDs", "[", 
                   RowBox[{"[", "tempbestpopulation", "]"}], "]"}]}], "-", 
                 ".45"}]}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"tempbestpopulation", ",", 
                RowBox[{
                 RowBox[{
                  RowBox[{"10", "^", "2"}], "*", 
                  RowBox[{"gaussianRMSDs", "[", 
                   RowBox[{"[", "tempbestpopulation", "]"}], "]"}]}], "-", 
                 ".05"}]}], "}"}]}], "}"}], "]"}], ",", 
           RowBox[{"Text", "[", 
            RowBox[{
             RowBox[{"Style", "[", 
              RowBox[{"\"\<BIC Min\>\"", ",", 
               RowBox[{"helv", "[", "24", "]"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"tempbestpopulation", ",", 
               RowBox[{
                RowBox[{
                 RowBox[{"10", "^", "2"}], "*", 
                 RowBox[{"gaussianRMSDs", "[", 
                  RowBox[{"[", "tempbestpopulation", "]"}], "]"}]}], "-", 
                ".55"}]}], "}"}]}], "]"}]}], "}"}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"gaussianRMSDperdistrib", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"Labeled", "[", 
            RowBox[{
             RowBox[{"Show", "[", 
              RowBox[{
               RowBox[{"distrPlot", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"Range", "[", 
                    RowBox[{"Length", "[", "gaussianRMSDs", "]"}], "]"}], ",", 
                    RowBox[{"gaussianRMSDs", "*", 
                    RowBox[{"10", "^", "2"}]}]}], "}"}], "\[Transpose]"}], 
                 ",", 
                 RowBox[{"PlotStyle", "\[Rule]", 
                  RowBox[{"{", 
                   RowBox[{"Black", ",", "Thick"}], "}"}]}], ",", 
                 RowBox[{"Joined", "\[Rule]", "True"}], ",", 
                 RowBox[{"PlotRange", "\[Rule]", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"{", 
                    RowBox[{"0", ",", "6.2"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"0", ",", 
                    RowBox[{
                    RowBox[{"Ceiling", "[", 
                    RowBox[{
                    RowBox[{"Max", "[", "gaussianRMSDs", "]"}], "*", 
                    RowBox[{"10", "^", "2"}]}], "]"}], "+", ".1"}]}], "}"}]}],
                    "}"}]}], ",", "##"}], "]"}], ",", 
               RowBox[{"distrPlot", "[", 
                RowBox[{
                 RowBox[{"Table", "[", 
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Range", "[", 
                    RowBox[{"Length", "[", "gaussianRMSDs", "]"}], "]"}], "[", 
                    RowBox[{"[", "i", "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{"gaussianRMSDs", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "*", 
                    RowBox[{"10", "^", "2"}]}]}], "}"}], "}"}], ",", 
                   RowBox[{"{", 
                    RowBox[{"i", ",", 
                    RowBox[{"Length", "[", "gaussianRMSDs", "]"}]}], "}"}]}], 
                  "]"}], ",", 
                 RowBox[{"PlotStyle", "\[Rule]", 
                  RowBox[{"{", 
                   RowBox[{"PointSize", "[", "0.02", "]"}], "}"}]}], ",", 
                 RowBox[{"Joined", "\[Rule]", "False"}], ",", 
                 RowBox[{"PlotRange", "\[Rule]", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"{", 
                    RowBox[{"0", ",", "6.2"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"0", ",", 
                    RowBox[{"Ceiling", "[", 
                    RowBox[{
                    RowBox[{"gaussianRMSDs", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "*", 
                    RowBox[{"10", "^", "2"}]}], "]"}]}], "}"}]}], "}"}]}], 
                 ",", "##"}], "]"}], ",", 
               RowBox[{"Epilog", "\[Rule]", "myepilog"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{
              "\"\<RMSD \[Times] \!\(\*SuperscriptBox[\(10\), \(2\)]\)\>\"", 
               ",", "\"\<Number of Gaussians\>\""}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"Left", ",", "Bottom"}], "}"}], ",", 
             RowBox[{"RotateLabel", "\[Rule]", "True"}], ",", "##", ",", 
             RowBox[{"Spacings", "\[Rule]", "0"}]}], "]"}], "&"}], "@@", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"LabelStyle", "\[Rule]", 
             RowBox[{"helv", "[", "42", "]"}]}], ",", 
            RowBox[{"ImageSize", "\[Rule]", "750"}]}], "}"}]}]}], ";"}]}], 
      "\[IndentingNewLine]", "\[IndentingNewLine]", "]"}], ",", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"Button", "[", 
      RowBox[{"\"\<Optimize\>\"", ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"alreadyoptimized", "=", "1"}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "Gradient", " ", "decent", " ", "search", " ", "for", " ", "optimal",
           " ", "number", " ", "of", " ", "gaussians"}], "*)"}], 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"rmsdParams", "=", 
         RowBox[{"ParallelTable", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"bestfit", "=", 
             RowBox[{"populationValues", "[", 
              RowBox[{"[", "i", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"bestdataconfig", "=", 
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"\[Mu]", "[", "#", "]"}], ",", 
                 RowBox[{"A", "[", "#", "]"}], ",", 
                 RowBox[{"\[Sigma]", "[", "#", "]"}]}], "}"}], "&"}], "/@", 
              RowBox[{"Range", "[", "i", "]"}]}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"bestgaussianfit", "=", 
             RowBox[{"Total", "@", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"peakfunc", "[", 
                   RowBox[{"##", ",", "r"}], "]"}], "&"}], "@@@", 
                 "bestdataconfig"}], "/.", "bestfit"}], ")"}]}]}], ";", 
            "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"minimizedgauss", "=", 
             RowBox[{"gradientD", "[", 
              RowBox[{"newwaveform", ",", 
               RowBox[{"bestdataconfig", "/.", "bestfit"}], ",", "kernel", 
               ",", "r"}], "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"{", 
             RowBox[{"AppendTo", "[", 
              RowBox[{"minimizedgauss", ",", 
               RowBox[{
                RowBox[{"Norm", "[", 
                 RowBox[{"newwaveform", "-", 
                  RowBox[{"gausswave", "@@", 
                   RowBox[{"{", 
                    RowBox[{"minimizedgauss", ",", "kernel", ",", "r"}], 
                    "}"}]}]}], "]"}], "^", "2"}]}], "]"}], "}"}]}], 
           "\[IndentingNewLine]", ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{
              RowBox[{"bitsToIndices", "[", "populationMatrix", "]"}], "//", 
              "Last"}]}], "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "RMSD", " ", "plot", " ", "for", " ", "the", " ", "number", " ", 
          "of", " ", "gaussians"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"gaussianfits", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"Total", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"peakfunc", "[", 
               RowBox[{"##", ",", "r"}], "]"}], "&"}], "@@@", 
             RowBox[{"Most", "[", 
              RowBox[{"rmsdParams", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", "1"}], "]"}], "]"}], "]"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", 
             RowBox[{
              RowBox[{"bitsToIndices", "[", "populationMatrix", "]"}], "//", 
              "Last"}]}], "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"gaussianwaveforms", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"kernel", ".", 
             RowBox[{"gaussianfits", "[", 
              RowBox[{"[", "i", "]"}], "]"}]}], "/", 
            RowBox[{"Max", "[", 
             RowBox[{"kernel", ".", 
              RowBox[{"gaussianfits", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", 
             RowBox[{"Length", "[", "gaussianfits", "]"}]}], "}"}]}], "]"}]}],
         ";", "\[IndentingNewLine]", 
        RowBox[{"gaussianRMSDs", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"RootMeanSquare", "[", 
            RowBox[{"newwaveform", "-", 
             RowBox[{"gaussianwaveforms", "[", 
              RowBox[{"[", "i", "]"}], "]"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", 
             RowBox[{"Length", "[", "gaussianfits", "]"}]}], "}"}]}], "]"}]}],
         ";", "\[IndentingNewLine]", 
        RowBox[{"gaussianBICs", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"bic", "[", 
            RowBox[{"newwaveform", ",", 
             RowBox[{"gaussianwaveforms", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", 
             RowBox[{"i", "*", "3"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", 
             RowBox[{"Length", "[", "gaussianfits", "]"}]}], "}"}]}], "]"}]}],
         ";", "\[IndentingNewLine]", 
        RowBox[{"tempbestpopulation", "=", 
         RowBox[{
          RowBox[{"MinimalBy", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"Range", "[", 
                RowBox[{"Length", "[", "gaussianBICs", "]"}], "]"}], ",", 
               "gaussianBICs"}], "}"}], "\[Transpose]"}], ",", "Last"}], 
           "]"}], "[", 
          RowBox[{"[", 
           RowBox[{"1", ",", "1"}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"indexoffirst", "=", "1"}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"fitplots", "[", 
            RowBox[{"[", "i", "]"}], "]"}], "=", 
           RowBox[{
            RowBox[{
             RowBox[{"labelR", "[", 
              RowBox[{
               RowBox[{"distrPlot", "[", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"{", 
                    RowBox[{"r", ",", "newdistribution"}], "}"}], 
                    "\[Transpose]"}], ",", 
                   RowBox[{
                    RowBox[{"{", 
                    RowBox[{"r", ",", 
                    RowBox[{"gaussianfits", "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}], "}"}], 
                    "\[Transpose]"}]}], "}"}], ",", 
                 RowBox[{"PlotStyle", "\[Rule]", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"color", "[", "1", "]"}], ",", "Dashed", ",", 
                    "Thick"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"Black", ",", "Thick"}], "}"}]}], "}"}]}], ",", 
                 RowBox[{"Epilog", "\[Rule]", 
                  RowBox[{"{", 
                   RowBox[{"Locator", "[", 
                    RowBox[{
                    RowBox[{"Scaled", "[", 
                    RowBox[{"{", 
                    RowBox[{".75", ",", ".8"}], "}"}], "]"}], ",", 
                    RowBox[{"tabletext2", "[", 
                    RowBox[{
                    RowBox[{"Most", "@", 
                    RowBox[{"rmsdParams", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "1"}], "]"}], "]"}]}], ",", "Black"}], 
                    "]"}]}], "]"}], "}"}]}], ",", "##"}], "]"}], ",", "##"}], 
              "]"}], "&"}], "@@", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"ImageSize", "\[Rule]", "750"}], ",", 
              RowBox[{"LabelStyle", "\[Rule]", 
               RowBox[{"helv", "[", "42", "]"}]}]}], "}"}]}]}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", 
            RowBox[{
             RowBox[{"bitsToIndices", "[", "populationMatrix", "]"}], "//", 
             "Last"}]}], "}"}]}], "]"}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"gaussianplots", "[", 
            RowBox[{"[", "i", "]"}], "]"}], "=", 
           RowBox[{
            RowBox[{
             RowBox[{"labelT", "[", 
              RowBox[{
               RowBox[{"Show", "[", 
                RowBox[{
                 RowBox[{"specPlot", "[", 
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"t", ",", "newwaveform"}], "}"}], 
                    "\[Transpose]"}], ",", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"t", ",", 
                    RowBox[{
                    RowBox[{"kernel", ".", 
                    RowBox[{"gaussianfits", "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}], "/", 
                    RowBox[{"Max", "[", 
                    RowBox[{"kernel", ".", 
                    RowBox[{"gaussianfits", "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}]}], "}"}], 
                    "\[Transpose]"}], ",", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"t", ",", 
                    RowBox[{
                    RowBox[{"kernel", ".", "newdistribution"}], "/", 
                    RowBox[{"Max", "[", 
                    RowBox[{"kernel", ".", "newdistribution"}], "]"}]}]}], 
                    "}"}], "\[Transpose]"}]}], "}"}], ",", 
                   RowBox[{"PlotStyle", "\[Rule]", 
                    RowBox[{"{", 
                    RowBox[{"Gray", ",", "Black", ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"color", "[", "1", "]"}], ",", "Dashed"}], 
                    "}"}]}], "}"}]}], ",", "##"}], "]"}], ",", 
                 RowBox[{"ListPlot", "[", 
                  RowBox[{
                   RowBox[{"{", "}"}], ",", 
                   RowBox[{"Joined", "\[Rule]", "True"}], ",", 
                   RowBox[{"PlotLegends", "->", 
                    RowBox[{"Placed", "[", 
                    RowBox[{
                    RowBox[{"LineLegend", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Directive", "[", 
                    RowBox[{
                    RowBox[{"color", "[", "1", "]"}], ",", "Dashed"}], "]"}], 
                    ",", "Black"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Style", "[", 
                    RowBox[{"\"\<Tikhonov\>\"", ",", 
                    RowBox[{"helv", "[", "20", "]"}]}], "]"}], ",", 
                    RowBox[{"Style", "[", 
                    RowBox[{"\"\<Gaussian Model\>\"", ",", 
                    RowBox[{"helv", "[", "20", "]"}]}], "]"}]}], "}"}]}], 
                    "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{".8", ",", ".9"}], "}"}]}], "]"}]}]}], "]"}]}], 
                "]"}], ",", "##"}], "]"}], "&"}], "@@", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"ImageSize", "\[Rule]", "750"}], ",", 
              RowBox[{"LabelStyle", "\[Rule]", 
               RowBox[{"helv", "[", "42", "]"}]}]}], "}"}]}]}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", 
            RowBox[{
             RowBox[{"bitsToIndices", "[", "populationMatrix", "]"}], "//", 
             "Last"}]}], "}"}]}], "]"}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"gaussianresiduals", "[", 
            RowBox[{"[", "i", "]"}], "]"}], "=", 
           RowBox[{
            RowBox[{
             RowBox[{"labelT", "[", 
              RowBox[{
               RowBox[{"specPlot", "[", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"{", 
                    RowBox[{"t", ",", 
                    RowBox[{"newwaveform", "-", 
                    RowBox[{
                    RowBox[{"kernel", ".", 
                    RowBox[{"gaussianfits", "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}], "/", 
                    RowBox[{"Max", "[", 
                    RowBox[{"kernel", ".", 
                    RowBox[{"gaussianfits", "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}]}]}], "}"}], 
                    "\[Transpose]"}], ",", 
                   RowBox[{
                    RowBox[{"{", 
                    RowBox[{"t", ",", 
                    RowBox[{"newwaveform", "-", 
                    RowBox[{
                    RowBox[{"kernel", ".", "newdistribution"}], "/", 
                    RowBox[{"Max", "[", 
                    RowBox[{"kernel", ".", "newdistribution"}], "]"}]}]}]}], 
                    "}"}], "\[Transpose]"}]}], "}"}], ",", 
                 RowBox[{"PlotStyle", "\[Rule]", 
                  RowBox[{"{", 
                   RowBox[{"Black", ",", 
                    RowBox[{"color", "[", "1", "]"}]}], "}"}]}], ",", 
                 RowBox[{"AxesOrigin", "\[Rule]", 
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0"}], "}"}]}], ",", "##"}], "]"}], ",", 
               "##"}], "]"}], "&"}], "@@", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"ImageSize", "\[Rule]", "750"}], ",", 
              RowBox[{"LabelStyle", "\[Rule]", 
               RowBox[{"helv", "[", "42", "]"}]}]}], "}"}]}]}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", 
            RowBox[{
             RowBox[{"bitsToIndices", "[", "populationMatrix", "]"}], "//", 
             "Last"}]}], "}"}]}], "]"}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"myepilog", "=", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"Dashed", ",", "Thick", ",", 
             RowBox[{"Line", "[", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"0", ",", "rmsdTik"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"6.2", ",", "rmsdTik"}], "}"}]}], "}"}], "]"}]}], 
            "}"}], ",", 
           RowBox[{"Text", "[", 
            RowBox[{
             RowBox[{"Style", "[", 
              RowBox[{"\"\<Tikhonov\>\"", ",", 
               RowBox[{"helv", "[", "24", "]"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"5.6", ",", 
               RowBox[{"rmsdTik", "-", ".13"}]}], "}"}]}], "]"}], ",", 
           RowBox[{"Arrow", "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"tempbestpopulation", ",", 
                RowBox[{
                 RowBox[{
                  RowBox[{"10", "^", "2"}], "*", 
                  RowBox[{"gaussianRMSDs", "[", 
                   RowBox[{"[", "tempbestpopulation", "]"}], "]"}]}], "-", 
                 ".45"}]}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"tempbestpopulation", ",", 
                RowBox[{
                 RowBox[{
                  RowBox[{"10", "^", "2"}], "*", 
                  RowBox[{"gaussianRMSDs", "[", 
                   RowBox[{"[", "tempbestpopulation", "]"}], "]"}]}], "-", 
                 ".05"}]}], "}"}]}], "}"}], "]"}], ",", 
           RowBox[{"Text", "[", 
            RowBox[{
             RowBox[{"Style", "[", 
              RowBox[{"\"\<BIC Min\>\"", ",", 
               RowBox[{"helv", "[", "24", "]"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"tempbestpopulation", ",", 
               RowBox[{
                RowBox[{
                 RowBox[{"10", "^", "2"}], "*", 
                 RowBox[{"gaussianRMSDs", "[", 
                  RowBox[{"[", "tempbestpopulation", "]"}], "]"}]}], "-", 
                ".55"}]}], "}"}]}], "]"}]}], "}"}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"gaussianRMSDperdistrib", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"Labeled", "[", 
            RowBox[{
             RowBox[{"Show", "[", 
              RowBox[{
               RowBox[{"distrPlot", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"Range", "[", 
                    RowBox[{"Length", "[", "gaussianRMSDs", "]"}], "]"}], ",", 
                    RowBox[{"gaussianRMSDs", "*", 
                    RowBox[{"10", "^", "2"}]}]}], "}"}], "\[Transpose]"}], 
                 ",", 
                 RowBox[{"PlotStyle", "\[Rule]", 
                  RowBox[{"{", 
                   RowBox[{"Black", ",", "Thick"}], "}"}]}], ",", 
                 RowBox[{"Joined", "\[Rule]", "True"}], ",", 
                 RowBox[{"PlotRange", "\[Rule]", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"{", 
                    RowBox[{"0", ",", "6.2"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"0", ",", 
                    RowBox[{
                    RowBox[{"Ceiling", "[", 
                    RowBox[{
                    RowBox[{"Max", "[", "gaussianRMSDs", "]"}], "*", 
                    RowBox[{"10", "^", "2"}]}], "]"}], "+", ".1"}]}], "}"}]}],
                    "}"}]}], ",", "##"}], "]"}], ",", 
               RowBox[{"distrPlot", "[", 
                RowBox[{
                 RowBox[{"Table", "[", 
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Range", "[", 
                    RowBox[{"Length", "[", "gaussianRMSDs", "]"}], "]"}], "[", 
                    RowBox[{"[", "i", "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{"gaussianRMSDs", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "*", 
                    RowBox[{"10", "^", "2"}]}]}], "}"}], "}"}], ",", 
                   RowBox[{"{", 
                    RowBox[{"i", ",", 
                    RowBox[{"Length", "[", "gaussianRMSDs", "]"}]}], "}"}]}], 
                  "]"}], ",", 
                 RowBox[{"PlotStyle", "\[Rule]", 
                  RowBox[{"{", 
                   RowBox[{"PointSize", "[", "0.02", "]"}], "}"}]}], ",", 
                 RowBox[{"Joined", "\[Rule]", "False"}], ",", 
                 RowBox[{"PlotRange", "\[Rule]", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"{", 
                    RowBox[{"0", ",", "6.2"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"0", ",", 
                    RowBox[{"Ceiling", "[", 
                    RowBox[{
                    RowBox[{"gaussianRMSDs", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "*", 
                    RowBox[{"10", "^", "2"}]}], "]"}]}], "}"}]}], "}"}]}], 
                 ",", "##"}], "]"}], ",", 
               RowBox[{"Epilog", "\[Rule]", "myepilog"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{
              "\"\<RMSD \[Times] \!\(\*SuperscriptBox[\(10\), \(2\)]\)\>\"", 
               ",", "\"\<Number of Gaussians\>\""}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"Left", ",", "Bottom"}], "}"}], ",", 
             RowBox[{"RotateLabel", "\[Rule]", "True"}], ",", "##", ",", 
             RowBox[{"Spacings", "\[Rule]", "0"}]}], "]"}], "&"}], "@@", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"LabelStyle", "\[Rule]", 
             RowBox[{"helv", "[", "42", "]"}]}], ",", 
            RowBox[{"ImageSize", "\[Rule]", "750"}]}], "}"}]}]}], ";"}], 
       "\[IndentingNewLine]", "\[IndentingNewLine]", ",", 
       RowBox[{"Method", "->", "\"\<Queued\>\""}]}], "]"}]}], "}"}], "}"}], "//",
   "TableForm"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"fitplots", "=", 
   RowBox[{"Table", "[", 
    RowBox[{"noiserrorplot", ",", 
     RowBox[{"{", "6", "}"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"gaussianplots", "=", 
   RowBox[{"Table", "[", 
    RowBox[{"\"\<\>\"", ",", 
     RowBox[{"{", "6", "}"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"gaussianresiduals", "=", 
   RowBox[{"Table", "[", 
    RowBox[{"\"\<\>\"", ",", 
     RowBox[{"{", "6", "}"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"gaussianRMSDperdistrib", "=", "\"\<Select peaks and fit\>\""}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"gaussianplot", "=", "\"\<\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"gaussianresidual", "=", "\"\<\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"{", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"LocatorPane", "[", 
       RowBox[{
        RowBox[{"Dynamic", "@", 
         RowBox[{"populations", "[", 
          RowBox[{"[", 
           RowBox[{"npops", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}]}], ",", 
        RowBox[{"Dynamic", "[", 
         RowBox[{"fitplots", "[", 
          RowBox[{"[", 
           RowBox[{"npops", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "]"}]}], "]"}], ",", 
      RowBox[{"Dynamic", "[", "gaussianRMSDperdistrib", "]"}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"Dynamic", "[", 
       RowBox[{"gaussianplots", "[", 
        RowBox[{"[", 
         RowBox[{"npops", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "]"}], ",", 
      RowBox[{"Dynamic", "[", 
       RowBox[{"gaussianresiduals", "[", 
        RowBox[{"[", 
         RowBox[{"npops", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "]"}]}], "}"}]}], 
   "}"}], "//", "TableForm"}]}], "Input",
 Editable->False,
 CellChangeTimes->{{3.6846890863153152`*^9, 3.6846891986498117`*^9}, {
   3.684754778662901*^9, 3.68475479255087*^9}, {3.6847548545521708`*^9, 
   3.684754873263669*^9}, {3.684754939611137*^9, 3.68475505659522*^9}, {
   3.6847551685474567`*^9, 3.684755175634388*^9}, {3.6847552778742228`*^9, 
   3.684755373014495*^9}, {3.684762831001287*^9, 3.684762837790823*^9}, {
   3.684762875334766*^9, 3.684762989164474*^9}, {3.684763094037064*^9, 
   3.684763098991427*^9}, {3.684763170611586*^9, 3.684763296361206*^9}, {
   3.6847633801498632`*^9, 3.68476349048005*^9}, {3.684763567700014*^9, 
   3.684763572157659*^9}, {3.684763642944079*^9, 3.684763646344708*^9}, {
   3.6847638792622337`*^9, 3.684763879600959*^9}, {3.684764076828903*^9, 
   3.684764077380581*^9}, {3.684764363663855*^9, 3.68476436409921*^9}, {
   3.684768807947527*^9, 3.684768819153317*^9}, {3.6848468296096582`*^9, 
   3.684846829923396*^9}, {3.6848478245155563`*^9, 3.684847824907895*^9}, {
   3.68598280014373*^9, 3.6859828017239523`*^9}, {3.6863076085441303`*^9, 
   3.686307638576427*^9}, {3.686935873411545*^9, 3.6869358770406437`*^9}, {
   3.687181530459893*^9, 3.687181548267576*^9}, {3.687181690835479*^9, 
   3.687181696390499*^9}, 3.6871817716700172`*^9, {3.687189446217374*^9, 
   3.687189504253209*^9}, {3.6871895625174627`*^9, 3.6871895751967497`*^9}, {
   3.68753739704946*^9, 3.687537404612975*^9}, {3.6875417749379473`*^9, 
   3.687541780728889*^9}, {3.6875419881191874`*^9, 3.687541993249563*^9}, {
   3.687621533257471*^9, 3.687621611105257*^9}, {3.687621677867847*^9, 
   3.6876216791174593`*^9}, {3.68762260661906*^9, 3.68762262382271*^9}, {
   3.687623179118991*^9, 3.687623179673602*^9}, {3.689705246083248*^9, 
   3.68970525580723*^9}, {3.689705580442759*^9, 3.689705586491713*^9}, {
   3.689706070508071*^9, 3.689706087538719*^9}, {3.6898684308886003`*^9, 
   3.689868453960353*^9}, 3.68986848824347*^9, {3.689868525992395*^9, 
   3.689868545153067*^9}, {3.689870075615199*^9, 3.689870118918201*^9}, {
   3.68987127149876*^9, 3.689871273535366*^9}, {3.691260705934792*^9, 
   3.691260713573285*^9}, {3.691260774726308*^9, 3.691260785553626*^9}, {
   3.691336162715398*^9, 3.6913362311749067`*^9}, {3.691336275805812*^9, 
   3.691336287108667*^9}, {3.691337491479198*^9, 3.691337518236999*^9}, {
   3.691340102326412*^9, 3.691340137468598*^9}, {3.6913419217185917`*^9, 
   3.6913419226526203`*^9}, {3.691342121023991*^9, 3.691342189706715*^9}, {
   3.691342284098505*^9, 3.6913423822444553`*^9}, {3.6913424757266827`*^9, 
   3.69134250548488*^9}, {3.691342555868*^9, 3.691342671815139*^9}, {
   3.691342718874372*^9, 3.691342746073489*^9}, 3.691347110382216*^9, {
   3.693151962512684*^9, 3.69315202394164*^9}, {3.693246135637274*^9, 
   3.693246135709774*^9}, {3.693247872212496*^9, 3.693247873765422*^9}, 
   3.693843182167555*^9, 3.693843231031108*^9, {3.697284327811648*^9, 
   3.697284357418816*^9}, {3.698168591940098*^9, 3.698168593436055*^9}, {
   3.698168685829692*^9, 3.698168717791349*^9}, {3.698168812317216*^9, 
   3.698168841802516*^9}, {3.698173868133359*^9, 3.698173868514695*^9}, {
   3.699894633735702*^9, 3.699894657606133*^9}, {3.700500616534025*^9, 
   3.700500626670905*^9}, 3.700582832747225*^9, {3.700583507155016*^9, 
   3.700583519920669*^9}, {3.700583627101697*^9, 3.700583650395669*^9}, {
   3.700583690546863*^9, 3.700583694223536*^9}, {3.700583817631609*^9, 
   3.700583818188211*^9}, {3.7005843482609673`*^9, 3.7005843708239193`*^9}, 
   3.700584986660944*^9, 3.701702591932481*^9, {3.701703688143774*^9, 
   3.7017037577997026`*^9}, {3.701703817558749*^9, 3.701703857944207*^9}, {
   3.7017042898631144`*^9, 3.7017043382449017`*^9}, {3.705842688743938*^9, 
   3.705842690498658*^9}, {3.7058427327205343`*^9, 3.705842758781419*^9}, {
   3.70584290081229*^9, 3.705842922928076*^9}, {3.706287193923558*^9, 
   3.7062872246753597`*^9}, {3.7062872926276073`*^9, 3.706287324642684*^9}, {
   3.728834853270577*^9, 3.7288348581173077`*^9}, 3.728834905923077*^9, 
   3.728837473539207*^9, {3.728837843051344*^9, 3.728837861606174*^9}, {
   3.7288379545357656`*^9, 3.728837997107617*^9}, 3.728838047316893*^9, {
   3.728838181409729*^9, 3.7288381822834463`*^9}, {3.7288382227030497`*^9, 
   3.728838284044956*^9}, 3.728838323483926*^9, {3.728838353653225*^9, 
   3.728838383184876*^9}, {3.728915985155897*^9, 3.728915991293663*^9}, {
   3.728921310319429*^9, 3.728921313400509*^9}, {3.728921451061473*^9, 
   3.728921453044732*^9}, {3.728921562688971*^9, 3.728921568323031*^9}, {
   3.729341716351725*^9, 3.7293419927645197`*^9}, {3.729342036482123*^9, 
   3.729342047688408*^9}, {3.729426483159113*^9, 3.729426501586467*^9}, {
   3.729426537675153*^9, 3.7294265418841476`*^9}, {3.729426770250108*^9, 
   3.729426771805174*^9}, {3.7294356679221582`*^9, 3.729435669093184*^9}, {
   3.729435707822674*^9, 3.729435718508497*^9}, 3.7294360163865423`*^9, 
   3.729437698803153*^9, {3.729437889144848*^9, 3.729437889572597*^9}, 
   3.729438067259038*^9, {3.729441427787868*^9, 3.729441473525882*^9}, {
   3.7294415289389067`*^9, 3.7294415996689043`*^9}, 3.7294416489962254`*^9, {
   3.729441789657535*^9, 3.729441794150475*^9}, 3.729442113539503*^9, {
   3.729442152343339*^9, 3.7294421546177263`*^9}, {3.729442200123005*^9, 
   3.729442227377894*^9}, {3.7294428987130737`*^9, 3.7294429155400677`*^9}, 
   3.7294429717931767`*^9, 3.729443204563731*^9, {3.729443402317951*^9, 
   3.7294434119955683`*^9}, 3.7298604455804377`*^9, {3.729869923558887*^9, 
   3.7298699411728888`*^9}, {3.729871821659575*^9, 3.7298718286288347`*^9}, 
   3.729875067633225*^9, {3.729875107047879*^9, 3.7298751156143713`*^9}, {
   3.729875171361068*^9, 3.729875228356167*^9}, {3.729875272646737*^9, 
   3.729875285324449*^9}, {3.72987532489723*^9, 3.7298753252588987`*^9}, {
   3.729875786457292*^9, 3.729875844528452*^9}, {3.729875915851348*^9, 
   3.7298760231202717`*^9}, {3.72987607089287*^9, 3.7298760716603317`*^9}, {
   3.729876371058496*^9, 3.7298763731603928`*^9}, {3.729876495706793*^9, 
   3.7298766254961233`*^9}, {3.729876683599905*^9, 3.729876699920148*^9}, {
   3.729876731668466*^9, 3.729876741834888*^9}, {3.729876794106489*^9, 
   3.7298768018642807`*^9}, {3.729876845459631*^9, 3.7298768934750566`*^9}, {
   3.7298769479968243`*^9, 3.7298769529930162`*^9}, {3.729877042333617*^9, 
   3.72987705016951*^9}, {3.729877116634094*^9, 3.729877125622036*^9}, {
   3.7298771827861767`*^9, 3.729877227646936*^9}, {3.7298811756061907`*^9, 
   3.729881184965721*^9}, {3.729881217772524*^9, 3.7298812621321497`*^9}, {
   3.729881362090719*^9, 3.729881401166143*^9}, {3.729881441757029*^9, 
   3.729881449687562*^9}, 3.7298815049332647`*^9, {3.7298816297958803`*^9, 
   3.7298816413543158`*^9}, {3.729881728921589*^9, 3.729881735939495*^9}, {
   3.7298817957544727`*^9, 3.729881861237973*^9}, {3.729944684071334*^9, 
   3.729944752128677*^9}, {3.7299449387923203`*^9, 3.729944939573784*^9}, {
   3.729946003950349*^9, 3.729946011474028*^9}, {3.729950127627973*^9, 
   3.729950163353722*^9}, {3.731259340570281*^9, 3.731259361280262*^9}, {
   3.731259496907946*^9, 3.7312594991444597`*^9}, {3.731259568036351*^9, 
   3.731259610787065*^9}, 3.731334447363545*^9, {3.7316890641121063`*^9, 
   3.7316890671781807`*^9}},ExpressionUUID->"27715129-4609-41e5-aa18-\
ec616c40bea2"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "Gradient", " ", "descent", " ", "search", " ", "for", " ", "optimal", " ",
     "number", " ", "of", " ", "gaussians"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"alreadyoptimized", "!=", "1"}], ",", "\[IndentingNewLine]", 
     RowBox[{"AbsoluteTiming", "[", 
      RowBox[{
       RowBox[{"rmsdParams", "=", 
        RowBox[{"ParallelTable", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"bestfit", "=", 
            RowBox[{"populationValues", "[", 
             RowBox[{"[", "i", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"bestdataconfig", "=", 
            RowBox[{
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"\[Mu]", "[", "#", "]"}], ",", 
                RowBox[{"A", "[", "#", "]"}], ",", 
                RowBox[{"\[Sigma]", "[", "#", "]"}]}], "}"}], "&"}], "/@", 
             RowBox[{"Range", "[", "i", "]"}]}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"bestgaussianfit", "=", 
            RowBox[{"Total", "@", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"peakfunc", "[", 
                  RowBox[{"##", ",", "r"}], "]"}], "&"}], "@@@", 
                "bestdataconfig"}], "/.", "bestfit"}], ")"}]}]}], ";", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"minimizedgauss", "=", 
            RowBox[{"gradientD", "[", 
             RowBox[{"newwaveform", ",", 
              RowBox[{"bestdataconfig", "/.", "bestfit"}], ",", "kernel", ",",
               "r"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{"AppendTo", "[", 
             RowBox[{"minimizedgauss", ",", 
              RowBox[{
               RowBox[{"Norm", "[", 
                RowBox[{"newwaveform", "-", 
                 RowBox[{"gausswave", "@@", 
                  RowBox[{"{", 
                   RowBox[{"minimizedgauss", ",", "kernel", ",", "r"}], 
                   "}"}]}]}], "]"}], "^", "2"}]}], "]"}], "}"}]}], 
          "\[IndentingNewLine]", ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", 
            RowBox[{
             RowBox[{"bitsToIndices", "[", "populationMatrix", "]"}], "//", 
             "Last"}]}], "}"}]}], "]"}]}], ";"}], "]"}]}], "]"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "RMSD", " ", "plot", " ", "for", " ", "the", " ", "number", " ", "of", 
     " ", "gaussians"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"gaussianfits", "=", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"Total", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"peakfunc", "[", 
           RowBox[{"##", ",", "r"}], "]"}], "&"}], "@@@", 
         RowBox[{"Most", "[", 
          RowBox[{"rmsdParams", "[", 
           RowBox[{"[", 
            RowBox[{"i", ",", "1"}], "]"}], "]"}], "]"}]}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", 
         RowBox[{
          RowBox[{"bitsToIndices", "[", "populationMatrix", "]"}], "//", 
          "Last"}]}], "}"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"gaussianwaveforms", "=", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"kernel", ".", 
         RowBox[{"gaussianfits", "[", 
          RowBox[{"[", "i", "]"}], "]"}]}], "/", 
        RowBox[{"Max", "[", 
         RowBox[{"kernel", ".", 
          RowBox[{"gaussianfits", "[", 
           RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", 
         RowBox[{"Length", "[", "gaussianfits", "]"}]}], "}"}]}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"gaussianRMSDs", "=", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"RootMeanSquare", "[", 
        RowBox[{"newwaveform", "-", 
         RowBox[{"gaussianwaveforms", "[", 
          RowBox[{"[", "i", "]"}], "]"}]}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", 
         RowBox[{"Length", "[", "gaussianfits", "]"}]}], "}"}]}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"gaussianBICs", "=", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"bic", "[", 
        RowBox[{"newwaveform", ",", 
         RowBox[{"gaussianwaveforms", "[", 
          RowBox[{"[", "i", "]"}], "]"}], ",", 
         RowBox[{"i", "*", "3"}]}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", 
         RowBox[{"Length", "[", "gaussianfits", "]"}]}], "}"}]}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"tempbestpopulation", "=", 
     RowBox[{
      RowBox[{"MinimalBy", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Range", "[", 
            RowBox[{"Length", "[", "gaussianBICs", "]"}], "]"}], ",", 
           "gaussianBICs"}], "}"}], "\[Transpose]"}], ",", "Last"}], "]"}], 
      "[", 
      RowBox[{"[", 
       RowBox[{"1", ",", "1"}], "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   
   RowBox[{
    RowBox[{"indexoffirst", "=", "1"}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"myepilog", "=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"Dashed", ",", "Thick", ",", 
         RowBox[{"Line", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"0", ",", "rmsdTik"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"6.2", ",", "rmsdTik"}], "}"}]}], "}"}], "]"}]}], "}"}], 
       ",", 
       RowBox[{"Text", "[", 
        RowBox[{
         RowBox[{"Style", "[", 
          RowBox[{"\"\<Tikhonov\>\"", ",", 
           RowBox[{"helv", "[", "18", "]"}]}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"5.6", ",", 
           RowBox[{"rmsdTik", "-", ".13"}]}], "}"}]}], "]"}], ",", 
       RowBox[{"Arrow", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"tempbestpopulation", ",", 
            RowBox[{
             RowBox[{
              RowBox[{"10", "^", "2"}], "*", 
              RowBox[{"gaussianRMSDs", "[", 
               RowBox[{"[", "tempbestpopulation", "]"}], "]"}]}], "-", 
             ".45"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"tempbestpopulation", ",", 
            RowBox[{
             RowBox[{
              RowBox[{"10", "^", "2"}], "*", 
              RowBox[{"gaussianRMSDs", "[", 
               RowBox[{"[", "tempbestpopulation", "]"}], "]"}]}], "-", 
             ".05"}]}], "}"}]}], "}"}], "]"}], ",", 
       RowBox[{"Text", "[", 
        RowBox[{
         RowBox[{"Style", "[", 
          RowBox[{"\"\<BIC Min\>\"", ",", 
           RowBox[{"helv", "[", "18", "]"}]}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"tempbestpopulation", ",", 
           RowBox[{
            RowBox[{
             RowBox[{"10", "^", "2"}], "*", 
             RowBox[{"gaussianRMSDs", "[", 
              RowBox[{"[", "tempbestpopulation", "]"}], "]"}]}], "-", 
            ".55"}]}], "}"}]}], "]"}]}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"gaussianRMSDperdistribOpt", "=", 
     RowBox[{
      RowBox[{
       RowBox[{"Labeled", "[", 
        RowBox[{
         RowBox[{"Show", "[", 
          RowBox[{
           RowBox[{"distrPlot", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"Range", "[", 
                 RowBox[{"Length", "[", "gaussianRMSDs", "]"}], "]"}], ",", 
                RowBox[{"gaussianRMSDs", "*", 
                 RowBox[{"10", "^", "2"}]}]}], "}"}], "\[Transpose]"}], ",", 
             RowBox[{"PlotStyle", "\[Rule]", 
              RowBox[{"{", 
               RowBox[{"Black", ",", "Thick"}], "}"}]}], ",", 
             RowBox[{"Joined", "\[Rule]", "True"}], ",", 
             RowBox[{"PlotRange", "\[Rule]", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"0", ",", "6.2"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"0", ",", 
                  RowBox[{
                   RowBox[{"Ceiling", "[", 
                    RowBox[{
                    RowBox[{"Max", "[", "gaussianRMSDs", "]"}], "*", 
                    RowBox[{"10", "^", "2"}]}], "]"}], "+", ".1"}]}], "}"}]}],
                "}"}]}], ",", "##"}], "]"}], ",", 
           RowBox[{"distrPlot", "[", 
            RowBox[{
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Range", "[", 
                    RowBox[{"Length", "[", "gaussianRMSDs", "]"}], "]"}], "[", 
                   RowBox[{"[", "i", "]"}], "]"}], ",", 
                  RowBox[{
                   RowBox[{"gaussianRMSDs", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "*", 
                   RowBox[{"10", "^", "2"}]}]}], "}"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", 
                 RowBox[{"Length", "[", "gaussianRMSDs", "]"}]}], "}"}]}], 
              "]"}], ",", 
             RowBox[{"PlotStyle", "\[Rule]", 
              RowBox[{"{", 
               RowBox[{"PointSize", "[", "0.02", "]"}], "}"}]}], ",", 
             RowBox[{"Joined", "\[Rule]", "False"}], ",", 
             RowBox[{"PlotRange", "\[Rule]", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"0", ",", "6.2"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"0", ",", 
                  RowBox[{"Ceiling", "[", 
                   RowBox[{
                    RowBox[{"gaussianRMSDs", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "*", 
                    RowBox[{"10", "^", "2"}]}], "]"}]}], "}"}]}], "}"}]}], 
             ",", "##"}], "]"}], ",", 
           RowBox[{"Epilog", "\[Rule]", "myepilog"}]}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{
          "\"\<RMSD \[Times] \!\(\*SuperscriptBox[\(10\), \(2\)]\)\>\"", ",", 
           "\"\<Number of Gaussians\>\""}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"Left", ",", "Bottom"}], "}"}], ",", 
         RowBox[{"RotateLabel", "\[Rule]", "True"}], ",", "##", ",", 
         RowBox[{"Spacings", "\[Rule]", "0"}]}], "]"}], "&"}], "@@", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"LabelStyle", "\[Rule]", 
         RowBox[{"helv", "[", "24", "]"}]}], ",", 
        RowBox[{"ImageSize", "\[Rule]", "500"}]}], "}"}]}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"gaussianDistribspread", "=", 
     RowBox[{"labelR", "@", 
      RowBox[{"distrPlot", "[", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{"r", ",", 
            RowBox[{
             RowBox[{
              RowBox[{"Total", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"peakfunc", "[", 
                  RowBox[{"##", ",", "r"}], "]"}], "&"}], "@@@", 
                RowBox[{"Most", "[", 
                 RowBox[{"rmsdParams", "[", 
                  RowBox[{"[", 
                   RowBox[{"i", ",", "1"}], "]"}], "]"}], "]"}]}], "]"}], "/", 
              RowBox[{"NIntegrate", "[", 
               RowBox[{
                RowBox[{"Total", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"peakfunc", "[", 
                    RowBox[{"##", ",", "x"}], "]"}], "&"}], "@@@", 
                  RowBox[{"Most", "[", 
                   RowBox[{"rmsdParams", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "1"}], "]"}], "]"}], "]"}]}], "]"}], 
                ",", 
                RowBox[{"Prepend", "[", 
                 RowBox[{
                  RowBox[{"MinMax", "[", "r", "]"}], ",", "x"}], "]"}]}], 
               "]"}]}], "+", 
             RowBox[{".1", "i"}]}]}], "}"}], "\[Transpose]"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", 
           RowBox[{"Length", "[", "gaussianfits", "]"}]}], "}"}]}], "]"}], 
       "]"}]}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"gaussianRMSDplot", "=", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{"gaussianRMSDperdistribOpt", ",", "gaussianDistribspread"}], 
       "}"}], "}"}], "//", "TableForm"}]}]}]}]], "Input",
 Editable->False,
 CellChangeTimes->{{3.691338524146282*^9, 3.691338536648589*^9}, {
   3.691340656932229*^9, 3.691340679896812*^9}, 3.6913449222412243`*^9, {
   3.6913453644504232`*^9, 3.6913453829169693`*^9}, {3.691345438165722*^9, 
   3.6913454826389647`*^9}, {3.691427499364489*^9, 3.691427503753181*^9}, {
   3.691427562527217*^9, 3.6914275739927893`*^9}, {3.692551921256937*^9, 
   3.692551952037554*^9}, {3.69255199922857*^9, 3.692552026441484*^9}, {
   3.692552094170636*^9, 3.692552161772501*^9}, {3.6925555575557756`*^9, 
   3.692555620264407*^9}, {3.693246045031464*^9, 3.6932460514114323`*^9}, {
   3.693246094346595*^9, 3.693246103002536*^9}, {3.697284377780303*^9, 
   3.697284403807041*^9}, {3.698168994919044*^9, 3.698168998032021*^9}, {
   3.6981690538472357`*^9, 3.698169056788156*^9}, {3.699712176877206*^9, 
   3.699712203758101*^9}, {3.699712273041172*^9, 3.6997124847855463`*^9}, {
   3.6997127887222967`*^9, 3.69971280255899*^9}, {3.699713120001075*^9, 
   3.69971313674767*^9}, {3.699714441967836*^9, 3.699714458246915*^9}, {
   3.699714660548057*^9, 3.699714666193267*^9}, {3.699895259718573*^9, 
   3.6998952641941767`*^9}, {3.70170394424933*^9, 3.701704047577755*^9}, {
   3.701704419222528*^9, 3.701704453209496*^9}, 3.706287026828355*^9, {
   3.706287068980978*^9, 3.706287086900367*^9}, {3.706287129178753*^9, 
   3.706287135262024*^9}, {3.7287572630286303`*^9, 3.72875732297366*^9}, {
   3.728757429541383*^9, 3.728757492925786*^9}, 3.7287575240015707`*^9, {
   3.728834128378772*^9, 3.728834224739203*^9}, 3.7288343525717373`*^9, {
   3.728834768835781*^9, 3.7288347733322163`*^9}, {3.7288368523280983`*^9, 
   3.728836889938051*^9}, {3.7288386466798573`*^9, 3.728838661792004*^9}, {
   3.7289154467003527`*^9, 3.728915448663422*^9}, {3.728921526181843*^9, 
   3.728921549585227*^9}, {3.728931091388446*^9, 3.7289310925028467`*^9}, {
   3.729342244872316*^9, 3.729342355910645*^9}, {3.7294416845526114`*^9, 
   3.729441716551552*^9}, 3.729442104351334*^9, 3.729442269641139*^9, {
   3.7294437861789513`*^9, 3.7294438236808453`*^9}, 3.729443934637759*^9, 
   3.72986050730569*^9, {3.729861080557219*^9, 3.729861090626189*^9}, {
   3.72994649684483*^9, 3.7299465236747303`*^9}, {3.729946621292094*^9, 
   3.729946621828808*^9}},ExpressionUUID->"6f22cdc2-9310-4d88-9e76-\
71fee5f065c7"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"Which", " ", "population", " ", "is", " ", "best", " ", 
    RowBox[{"fit", "?"}]}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"DialogInput", "[", 
     RowBox[{
      RowBox[{"Grid", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"\"\<Confirm Ideal Number of Gaussians:\>\"", ",", 
            RowBox[{"InputField", "[", 
             RowBox[{
              RowBox[{"Dynamic", "[", "tempbestpopulation", "]"}], ",", 
              "Number"}], "]"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"DefaultButton", "[", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"tempbestpopulation", "\[LessEqual]", 
               RowBox[{"(", 
                RowBox[{"Length", "[", "gaussianRMSDs", "]"}], ")"}]}], ",", 
              RowBox[{"DialogReturn", "[", 
               RowBox[{"bestfitpopulation", "=", "tempbestpopulation"}], 
               "]"}]}], "]"}], "]"}], "}"}]}], "}"}], ",", 
        RowBox[{"Spacings", "\[Rule]", 
         RowBox[{"{", 
          RowBox[{"1", ",", "Automatic"}], "}"}]}], ",", 
        RowBox[{"Alignment", "\[Rule]", "Left"}]}], "]"}], ",", 
      RowBox[{"Modal", "\[Rule]", "True"}]}], "]"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"bestfit", "=", 
      RowBox[{"populationValues", "[", 
       RowBox[{"[", "bestfitpopulation", "]"}], "]"}]}], ";"}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"temp1", "=", 
     RowBox[{
      RowBox[{"rmsdParams", "[", 
       RowBox[{"[", 
        RowBox[{"bestfitpopulation", ",", "1", ",", 
         RowBox[{"1", ";;", "bestfitpopulation"}]}], "]"}], "]"}], "//", 
      "Flatten"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"temp2", "=", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"\[Mu]", "[", "#", "]"}], ",", 
          RowBox[{"A", "[", "#", "]"}], ",", 
          RowBox[{"\[Sigma]", "[", "#", "]"}]}], "}"}], "&"}], "/@", 
       RowBox[{"Range", "[", "bestfitpopulation", "]"}]}], "//", 
      "Flatten"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"bestfit", "=", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"temp2", "[", 
         RowBox[{"[", "i", "]"}], "]"}], "\[Rule]", 
        RowBox[{"temp1", "[", 
         RowBox[{"[", "i", "]"}], "]"}]}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", 
         RowBox[{"Length", "[", "temp1", "]"}]}], "}"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"bestdataconfig", "=", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"\[Mu]", "[", "#", "]"}], ",", 
         RowBox[{"A", "[", "#", "]"}], ",", 
         RowBox[{"\[Sigma]", "[", "#", "]"}]}], "}"}], "&"}], "/@", 
      RowBox[{"Range", "[", "bestfitpopulation", "]"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"bestgaussianfit", "=", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{"Total", "@", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"peakfunc", "[", 
             RowBox[{"##", ",", "r"}], "]"}], "&"}], "@@@", 
           "bestdataconfig"}], "/.", "bestfit"}], ")"}]}], ")"}], "/", 
      RowBox[{"NIntegrate", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Interpolation", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"r", ",", 
             RowBox[{"(", 
              RowBox[{"Total", "@", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"peakfunc", "[", 
                    RowBox[{"##", ",", "r"}], "]"}], "&"}], "@@@", 
                  "bestdataconfig"}], "/.", "bestfit"}], ")"}]}], ")"}]}], 
            "}"}], "\[Transpose]"}], "]"}], "[", "x", "]"}], ",", 
        RowBox[{"Prepend", "[", 
         RowBox[{
          RowBox[{"MinMax", "[", "r", "]"}], ",", "x"}], "]"}]}], "]"}]}]}], 
    ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"optimizedplot", "=", 
     RowBox[{
      RowBox[{
       RowBox[{"labelT", "[", 
        RowBox[{
         RowBox[{"Show", "[", 
          RowBox[{
           RowBox[{"specPlot", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"t", ",", "newwaveform"}], "}"}], "\[Transpose]"}], 
               ",", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"t", ",", 
                  RowBox[{
                   RowBox[{"kernel", ".", "bestgaussianfit"}], "/", 
                   RowBox[{"Max", "[", 
                    RowBox[{"kernel", ".", "bestgaussianfit"}], "]"}]}]}], 
                 "}"}], "\[Transpose]"}], ",", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"t", ",", 
                  RowBox[{
                   RowBox[{"kernel", ".", "newdistribution"}], "/", 
                   RowBox[{"Max", "[", 
                    RowBox[{"kernel", ".", "newdistribution"}], "]"}]}]}], 
                 "}"}], "\[Transpose]"}]}], "}"}], ",", 
             RowBox[{"PlotStyle", "\[Rule]", 
              RowBox[{"{", 
               RowBox[{"Gray", ",", "Black", ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"color", "[", "1", "]"}], ",", "Dashed"}], "}"}]}], 
               "}"}]}], ",", "##"}], "]"}], ",", 
           RowBox[{"ListPlot", "[", 
            RowBox[{
             RowBox[{"{", "}"}], ",", 
             RowBox[{"Joined", "\[Rule]", "True"}], ",", 
             RowBox[{"PlotLegends", "->", 
              RowBox[{"Placed", "[", 
               RowBox[{
                RowBox[{"LineLegend", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"Directive", "[", 
                    RowBox[{
                    RowBox[{"color", "[", "1", "]"}], ",", "Dashed"}], "]"}], 
                    ",", "Black"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"Style", "[", 
                    RowBox[{"\"\<Tikhonov\>\"", ",", 
                    RowBox[{"helv", "[", "20", "]"}]}], "]"}], ",", 
                    RowBox[{"Style", "[", 
                    RowBox[{"\"\<Gaussian Model\>\"", ",", 
                    RowBox[{"helv", "[", "20", "]"}]}], "]"}]}], "}"}]}], 
                 "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{".8", ",", ".9"}], "}"}]}], "]"}]}]}], "]"}]}], 
          "]"}], ",", "##"}], "]"}], "&"}], "@@", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"ImageSize", "\[Rule]", "750"}], ",", 
        RowBox[{"LabelStyle", "\[Rule]", 
         RowBox[{"helv", "[", "42", "]"}]}]}], "}"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"optimizedresidual", "=", 
     RowBox[{
      RowBox[{
       RowBox[{"labelT", "[", 
        RowBox[{
         RowBox[{"specPlot", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{"{", 
               RowBox[{"t", ",", 
                RowBox[{"newwaveform", "-", 
                 RowBox[{
                  RowBox[{"kernel", ".", "bestgaussianfit"}], "/", 
                  RowBox[{"Max", "[", 
                   RowBox[{"kernel", ".", "bestgaussianfit"}], "]"}]}]}]}], 
               "}"}], "\[Transpose]"}], ",", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"t", ",", 
                RowBox[{"newwaveform", "-", 
                 RowBox[{
                  RowBox[{"kernel", ".", "newdistribution"}], "/", 
                  RowBox[{"Max", "[", 
                   RowBox[{"kernel", ".", "newdistribution"}], "]"}]}]}]}], 
               "}"}], "\[Transpose]"}]}], "}"}], ",", 
           RowBox[{"PlotStyle", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{"Black", ",", 
              RowBox[{"color", "[", "1", "]"}]}], "}"}]}], ",", 
           RowBox[{"AxesOrigin", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{"0", ",", "0"}], "}"}]}], ",", "##"}], "]"}], ",", 
         "##"}], "]"}], "&"}], "@@", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"LabelStyle", "\[Rule]", 
         RowBox[{"helv", "[", "42", "]"}]}], ",", 
        RowBox[{"ImageSize", "\[Rule]", "750"}]}], "}"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"bestgaussianspec", "=", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{"optimizedplot", ",", "optimizedresidual"}], "}"}], "}"}], "//",
      "TableForm"}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"bestgaussiandistrib", "=", 
    RowBox[{
     RowBox[{
      RowBox[{"labelR", "[", 
       RowBox[{
        RowBox[{"distrPlot", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"{", 
              RowBox[{"r", ",", "newdistribution"}], "}"}], "\[Transpose]"}], 
            ",", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"r", ",", "bestgaussianfit"}], "}"}], 
             "\[Transpose]"}]}], "}"}], ",", 
          RowBox[{"PlotStyle", "\[Rule]", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"color", "[", "1", "]"}], ",", "Dashed", ",", 
               "Thick"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"Black", ",", "Thick"}], "}"}]}], "}"}]}], ",", 
          RowBox[{"Epilog", "\[Rule]", 
           RowBox[{"{", 
            RowBox[{"Locator", "[", 
             RowBox[{
              RowBox[{"Scaled", "[", 
               RowBox[{"{", 
                RowBox[{".75", ",", ".8"}], "}"}], "]"}], ",", 
              RowBox[{"tabletext", "[", 
               RowBox[{"bestfit", ",", "Black"}], "]"}]}], "]"}], "}"}]}], 
          ",", "##"}], "]"}], ",", "##"}], "]"}], "&"}], "@@", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"ImageSize", "\[Rule]", "750"}], ",", 
       RowBox[{"LabelStyle", "\[Rule]", 
        RowBox[{"helv", "[", "42", "]"}]}]}], "}"}]}]}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"mult", "=", 
      RowBox[{"ConstantArray", "[", 
       RowBox[{"1", ",", "bestfitpopulation"}], "]"}]}], ";"}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"mult", "=", 
     RowBox[{"Round", "[", 
      RowBox[{
       RowBox[{"Max", "[", 
        RowBox[{
         RowBox[{"tablelesstext", "[", "bestfit", "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", "3"}], "]"}], "]"}], "]"}], "/", 
       RowBox[{
        RowBox[{"tablelesstext", "[", "bestfit", "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", "3"}], "]"}], "]"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"mult", "=", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"mult", "[", 
           RowBox[{"[", "i", "]"}], "]"}], ">", "10"}], ",", "10", ",", 
         RowBox[{"mult", "[", 
          RowBox[{"[", "i", "]"}], "]"}]}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", 
         RowBox[{"Length", "@", "mult"}]}], "}"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"poptext", "=", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"\"\<Population \>\"", "<>", 
        RowBox[{"ToString", "@", "i"}]}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "bestfitpopulation"}], "}"}]}], "]"}]}], 
    ";"}]}]}]], "Input",
 Editable->False,
 CellChangeTimes->{{3.691346210838521*^9, 3.6913462720760612`*^9}, {
   3.691346340732011*^9, 3.691346341361014*^9}, {3.691346452048705*^9, 
   3.691346463356347*^9}, {3.691347463750161*^9, 3.6913474903663263`*^9}, {
   3.691410192373012*^9, 3.691410217336594*^9}, {3.691427831379414*^9, 
   3.6914278408232822`*^9}, {3.692547381792942*^9, 3.692547382021927*^9}, {
   3.692552220269459*^9, 3.692552254868985*^9}, {3.6925524642949743`*^9, 
   3.692552494458869*^9}, {3.692555079207724*^9, 3.692555079379402*^9}, {
   3.69315144345298*^9, 3.693151444119907*^9}, {3.6932461357307377`*^9, 
   3.693246135750929*^9}, {3.6932487678107758`*^9, 3.693248768023345*^9}, {
   3.6933354762618504`*^9, 3.693335476507327*^9}, {3.693840372635062*^9, 
   3.6938403750806723`*^9}, {3.693840939476828*^9, 3.693840940226687*^9}, {
   3.693840975075099*^9, 3.693840975386252*^9}, {3.69384328065611*^9, 
   3.693843280893561*^9}, {3.6938438247760363`*^9, 3.6938438264702044`*^9}, {
   3.693851465363426*^9, 3.693851465629612*^9}, {3.693930169944169*^9, 
   3.693930170205822*^9}, {3.694276735690813*^9, 3.694276736040967*^9}, {
   3.6944567813213167`*^9, 3.694456781807558*^9}, {3.694967751436006*^9, 
   3.694967752523798*^9}, {3.696179531590343*^9, 3.6961795336075697`*^9}, {
   3.6961842827568274`*^9, 3.6961842832188177`*^9}, {3.696860655474362*^9, 
   3.696860655678646*^9}, {3.697284415206429*^9, 3.697284440332741*^9}, 
   3.697383326476294*^9, {3.69782001734676*^9, 3.697820042434019*^9}, {
   3.6978201199441566`*^9, 3.69782012764356*^9}, {3.697820163813047*^9, 
   3.697820230701353*^9}, {3.697820287471262*^9, 3.697820309598868*^9}, {
   3.697820366901413*^9, 3.697820422741871*^9}, {3.6978204643600893`*^9, 
   3.697820479274477*^9}, {3.6978205172128*^9, 3.697820543364779*^9}, {
   3.697820632267702*^9, 3.6978206795272083`*^9}, {3.697820737980302*^9, 
   3.697820789384839*^9}, {3.697820824864355*^9, 3.697820878533189*^9}, {
   3.697820950110566*^9, 3.697820950627325*^9}, {3.697821023965001*^9, 
   3.697821138953895*^9}, {3.697821237703519*^9, 3.6978212596137743`*^9}, {
   3.697821292871532*^9, 3.697821325112753*^9}, {3.698169102578362*^9, 
   3.6981691144013968`*^9}, {3.698174097589019*^9, 3.698174103366323*^9}, {
   3.6997131248097563`*^9, 3.6997131547641706`*^9}, {3.700584432969767*^9, 
   3.700584441299192*^9}, {3.700584488337377*^9, 3.700584488970828*^9}, {
   3.700585010127681*^9, 3.700585010829955*^9}, {3.701097790434402*^9, 
   3.701097807628577*^9}, {3.701704484549981*^9, 3.701704558850662*^9}, {
   3.7062887268479023`*^9, 3.706288753867134*^9}, {3.706288838220109*^9, 
   3.706288859161532*^9}, {3.728931373274126*^9, 3.72893138580258*^9}, {
   3.729342410393772*^9, 3.7293424546987333`*^9}, 3.729444117119842*^9, 
   3.729444239071225*^9, {3.729610771929696*^9, 3.729610798170246*^9}, {
   3.7296108499127293`*^9, 3.7296108508693457`*^9}, {3.7312593628124247`*^9, 
   3.7312593668273907`*^9}, {3.73168205700141*^9, 3.731682123102274*^9}, {
   3.7316890029512444`*^9, 3.731689004088007*^9}, {3.7316909621527967`*^9, 
   3.7316909760183496`*^9}, {3.731691741949024*^9, 
   3.731691750634184*^9}},ExpressionUUID->"fddf8e7b-2a8d-4b7e-934a-\
7f81e2140835"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "Random", " ", "Walk", " ", "to", " ", "find", " ", "error", " ", 
    "Surface", " ", "Boundaries"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"SeedRandom", "[", 
    RowBox[{"Method", "->", 
     RowBox[{"{", 
      RowBox[{"\"\<MKL\>\"", ",", " ", 
       RowBox[{"Method", "->", 
        RowBox[{"{", 
         RowBox[{"\"\<Sobol\>\"", ",", " ", 
          RowBox[{"\"\<Dimension\>\"", "\[Rule]", "20"}]}], "}"}]}]}], 
      "}"}]}], "]"}], "\n", 
   RowBox[{
    RowBox[{"deltar", "=", 
     RowBox[{
      RowBox[{"r", "[", 
       RowBox[{"[", "2", "]"}], "]"}], "-", 
      RowBox[{"r", "[", 
       RowBox[{"[", "1", "]"}], "]"}]}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
   "AbsoluteTiming", "[", "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"bestie", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"\[Mu]", "[", 
            RowBox[{"indexoffirst", "+", "i"}], "]"}], "/.", "bestfit"}], ",", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"(", 
             RowBox[{"A", "[", 
              RowBox[{"indexoffirst", "+", "i"}], "]"}], ")"}], ")"}], "/.", 
           "bestfit"}], ",", 
          RowBox[{
           RowBox[{"\[Sigma]", "[", 
            RowBox[{"indexoffirst", "+", "i"}], "]"}], "/.", "bestfit"}]}], 
         "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "0", ",", 
          RowBox[{
           RowBox[{
            RowBox[{"Length", "[", "bestfit", "]"}], "/", "3"}], "-", "1"}]}],
          "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"position", "=", "bestie"}], ";", "\[IndentingNewLine]", 
     RowBox[{"bestRSS", "=", 
      RowBox[{
       RowBox[{"Norm", "[", 
        RowBox[{"newwaveform", "-", 
         RowBox[{
          RowBox[{"kernel", ".", "bestgaussianfit"}], "/", 
          RowBox[{"Max", "[", 
           RowBox[{"kernel", ".", "bestgaussianfit"}], "]"}]}]}], "]"}], "^", 
       "2"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"mydf", "=", 
      RowBox[{
       RowBox[{"Length", "[", "newwaveform", "]"}], "-", 
       RowBox[{"Length", "[", "bestfit", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"mydf", "=", 
        RowBox[{
         RowBox[{"Length", "[", "newwaveform", "]"}], "-", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Length", "[", "bestfit", "]"}], "-", "1"}], ")"}]}]}], 
       ";"}], "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"walkies", "=", 
      RowBox[{
      "ParallelTable", "[", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"randomparams", "=", 
          RowBox[{"Sort", "[", 
           RowBox[{"position", ",", 
            RowBox[{
             RowBox[{
              RowBox[{"#1", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "<", 
              RowBox[{"#2", "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], "&"}]}], "]"}]}], ";"}], 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"randomparams", "=", "position"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"randomdistribution", "=", 
          RowBox[{"Total", "@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{"peakfunc", "[", 
               RowBox[{"##", ",", "r"}], "]"}], "&"}], "@@@", 
             "randomparams"}], ")"}]}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"temp", "=", 
          RowBox[{"kernel", ".", "randomdistribution"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"temp", "=", 
          RowBox[{"temp", "/", 
           RowBox[{"temp", "[", 
            RowBox[{"[", "1", "]"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"currentRSS", "=", 
          RowBox[{
           RowBox[{"Norm", "[", 
            RowBox[{"newwaveform", "-", "temp"}], "]"}], "^", "2"}]}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"CDF", "[", 
             RowBox[{
              RowBox[{"FRatioDistribution", "[", 
               RowBox[{"mydf", ",", "mydf"}], "]"}], ",", 
              RowBox[{"currentRSS", "/", "bestRSS"}]}], "]"}], ">", ".95"}], 
           ",", "\[IndentingNewLine]", 
           RowBox[{"position", "=", 
            RowBox[{"Abs", "[", 
             RowBox[{"bestie", "+", 
              RowBox[{"Table", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"RandomReal", "[", 
                   RowBox[{
                    RowBox[{"mult", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", "+", "1"}], "]"}], "]"}], "*", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"-", "deltar"}], ",", "deltar"}], "}"}]}], "]"}], 
                  ",", 
                  RowBox[{"RandomReal", "[", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"-", ".01"}], ",", ".01"}], "}"}], "]"}], ",", 
                  RowBox[{
                   RowBox[{"mult", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", "+", "1"}], "]"}], "]"}], "*", 
                   RowBox[{"RandomReal", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"-", "deltar"}], ",", "deltar"}], "}"}], 
                    "]"}]}]}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"i", ",", "0", ",", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"Length", "[", "bestfit", "]"}], "/", "3"}], "-", 
                   "1"}]}], "}"}]}], "]"}]}], "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"position", "=", 
            RowBox[{"Abs", "[", 
             RowBox[{"position", "+", 
              RowBox[{"Table", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"RandomReal", "[", 
                   RowBox[{
                    RowBox[{"mult", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", "+", "1"}], "]"}], "]"}], "*", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"-", "deltar"}], ",", "deltar"}], "}"}]}], "]"}], 
                  ",", 
                  RowBox[{"RandomReal", "[", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"-", ".01"}], ",", ".01"}], "}"}], "]"}], ",", 
                  RowBox[{
                   RowBox[{"mult", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", "+", "1"}], "]"}], "]"}], "*", 
                   RowBox[{"RandomReal", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"-", "deltar"}], ",", "deltar"}], "}"}], 
                    "]"}]}]}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"i", ",", "0", ",", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"Length", "[", "bestfit", "]"}], "/", "3"}], "-", 
                   "1"}]}], "}"}]}], "]"}]}], "]"}]}]}], 
          "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"Append", "[", 
          RowBox[{"randomparams", ",", "currentRSS"}], "]"}]}], 
        "\[IndentingNewLine]", ",", 
        RowBox[{"{", "40000", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"walkies", "=", 
      RowBox[{"DeleteDuplicates", "[", "walkies", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"walkies", "[", 
       RowBox[{"[", 
        RowBox[{"All", ",", 
         RowBox[{"-", "1"}]}], "]"}], "]"}], "=", 
      RowBox[{
       RowBox[{"walkies", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", 
          RowBox[{"-", "1"}]}], "]"}], "]"}], "/", 
       RowBox[{
        RowBox[{"MinimalBy", "[", 
         RowBox[{"walkies", ",", "Last"}], "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"1", ",", 
          RowBox[{"-", "1"}]}], "]"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"walkies", "[", 
       RowBox[{"[", 
        RowBox[{"All", ",", 
         RowBox[{"-", "1"}]}], "]"}], "]"}], "=", 
      RowBox[{"CDF", "[", 
       RowBox[{
        RowBox[{"FRatioDistribution", "[", 
         RowBox[{"mydf", ",", "mydf"}], "]"}], ",", 
        RowBox[{"walkies", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", 
           RowBox[{"-", "1"}]}], "]"}], "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"confidencedata", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Select", "[", 
           RowBox[{
            RowBox[{"Select", "[", 
             RowBox[{"walkies", ",", 
              RowBox[{
               RowBox[{
                RowBox[{"#", "[", 
                 RowBox[{"[", 
                  RowBox[{"-", "1"}], "]"}], "]"}], "\[LessEqual]", "i"}], 
               "&"}]}], "]"}], ",", 
            RowBox[{
             RowBox[{"AllTrue", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"Most", "[", "#", "]"}], "[", 
                RowBox[{"[", 
                 RowBox[{"All", ",", "3"}], "]"}], "]"}], ",", 
               RowBox[{
                RowBox[{"#", "\[GreaterEqual]", ".19"}], "&"}]}], "]"}], 
             "&"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", 
            RowBox[{"{", 
             RowBox[{".95", ",", ".75", ",", ".6"}], "}"}]}], "}"}]}], 
         "]"}]}], ";"}], "*)"}], 
     RowBox[{"(*", 
      RowBox[{"thresholded", " ", "width"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"confidencedata", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"Select", "[", 
         RowBox[{"walkies", ",", 
          RowBox[{
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", 
              RowBox[{"-", "1"}], "]"}], "]"}], "\[LessEqual]", "i"}], 
           "&"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"{", 
           RowBox[{".95", ",", ".75", ",", ".6"}], "}"}]}], "}"}]}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"confidencedata", "[", 
       RowBox[{"[", "1", "]"}], "]"}], "=", 
      RowBox[{"Complement", "[", 
       RowBox[{
        RowBox[{"confidencedata", "[", 
         RowBox[{"[", "1", "]"}], "]"}], ",", 
        RowBox[{"confidencedata", "[", 
         RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"confidencedata", "[", 
       RowBox[{"[", "2", "]"}], "]"}], "=", 
      RowBox[{"Complement", "[", 
       RowBox[{
        RowBox[{"confidencedata", "[", 
         RowBox[{"[", "2", "]"}], "]"}], ",", 
        RowBox[{"confidencedata", "[", 
         RowBox[{"[", "3", "]"}], "]"}]}], "]"}]}], ";"}], 
    "\[IndentingNewLine]", "]"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"mcBestdigits", "=", 
     RowBox[{
      RowBox[{
       RowBox[{"MinimalBy", "[", 
        RowBox[{"walkies", ",", "Last"}], "]"}], "[", 
       RowBox[{"[", "1", "]"}], "]"}], "//", "Most"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"mcBest", "=", 
     RowBox[{
      RowBox[{"Total", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"peakfunc", "[", 
          RowBox[{"##", ",", "r"}], "]"}], "&"}], "@@@", "mcBestdigits"}], 
       "]"}], "/", 
      RowBox[{"NIntegrate", "[", 
       RowBox[{
        RowBox[{"Total", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"peakfunc", "[", 
            RowBox[{"##", ",", "x"}], "]"}], "&"}], "@@@", "mcBestdigits"}], 
         "]"}], ",", 
        RowBox[{"Prepend", "[", 
         RowBox[{
          RowBox[{"MinMax", "[", "r", "]"}], ",", "x"}], "]"}]}], "]"}]}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"mcBestresultstable", "=", 
     RowBox[{"tabletext", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"\[Mu]", "[", "i", "]"}], "->", 
             RowBox[{"mcBestdigits", "[", 
              RowBox[{"[", 
               RowBox[{"i", ",", "1"}], "]"}], "]"}]}], ",", 
            RowBox[{
             RowBox[{"A", "[", "i", "]"}], "->", 
             RowBox[{"mcBestdigits", "[", 
              RowBox[{"[", 
               RowBox[{"i", ",", "2"}], "]"}], "]"}]}], ",", 
            RowBox[{
             RowBox[{"\[Sigma]", "[", "i", "]"}], "->", 
             RowBox[{"mcBestdigits", "[", 
              RowBox[{"[", 
               RowBox[{"i", ",", "3"}], "]"}], "]"}]}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", 
            RowBox[{"Length", "[", "mcBestdigits", "]"}]}], "}"}]}], "]"}], "//",
         "Flatten"}], ",", "Black"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"WHY", " ", "IS", " ", "THIS", " ", "HERE"}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"confidenceRange", "=", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"Select", "[", 
        RowBox[{"walkies", ",", 
         RowBox[{
          RowBox[{
           RowBox[{"#", "[", 
            RowBox[{"[", 
             RowBox[{"-", "1"}], "]"}], "]"}], "\[LessEqual]", "i"}], "&"}]}],
         "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", 
         RowBox[{"{", ".95", "}"}]}], "}"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"mcCenters", "=", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"Mean", "[", 
        RowBox[{"confidenceRange", "[", 
         RowBox[{"[", 
          RowBox[{"1", ",", "All", ",", "j", ",", "1"}], "]"}], "]"}], "]"}], 
       ",", 
       RowBox[{"{", 
        RowBox[{"j", ",", 
         RowBox[{
          RowBox[{"Length", "[", "bestfit", "]"}], "/", "3"}]}], "}"}]}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"mcCentersSD", "=", 
     RowBox[{
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Differences", "[", 
          RowBox[{"MinMax", "[", 
           RowBox[{"confidenceRange", "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "All", ",", "j", ",", "1"}], "]"}], "]"}], 
           "]"}], "]"}], "/", "2"}], ",", 
        RowBox[{"{", 
         RowBox[{"j", ",", 
          RowBox[{
           RowBox[{"Length", "[", "bestfit", "]"}], "/", "3"}]}], "}"}]}], 
       "]"}], "//", "Flatten"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"mcWidths", "=", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"Mean", "[", 
        RowBox[{"confidenceRange", "[", 
         RowBox[{"[", 
          RowBox[{"1", ",", "All", ",", "j", ",", "3"}], "]"}], "]"}], "]"}], 
       ",", 
       RowBox[{"{", 
        RowBox[{"j", ",", 
         RowBox[{
          RowBox[{"Length", "[", "bestfit", "]"}], "/", "3"}]}], "}"}]}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"mcWidthsSD", "=", 
     RowBox[{
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Differences", "[", 
          RowBox[{"MinMax", "[", 
           RowBox[{"confidenceRange", "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "All", ",", "j", ",", "3"}], "]"}], "]"}], 
           "]"}], "]"}], "/", "2"}], ",", 
        RowBox[{"{", 
         RowBox[{"j", ",", 
          RowBox[{
           RowBox[{"Length", "[", "bestfit", "]"}], "/", "3"}]}], "}"}]}], 
       "]"}], "//", "Flatten"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"mcvalues", "=", 
     RowBox[{"tablelesstext", "[", 
      RowBox[{
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"\[Mu]", "[", "i", "]"}], "->", 
            RowBox[{"mcBestdigits", "[", 
             RowBox[{"[", 
              RowBox[{"i", ",", "1"}], "]"}], "]"}]}], ",", 
           RowBox[{
            RowBox[{"A", "[", "i", "]"}], "->", 
            RowBox[{"mcBestdigits", "[", 
             RowBox[{"[", 
              RowBox[{"i", ",", "2"}], "]"}], "]"}]}], ",", 
           RowBox[{
            RowBox[{"\[Sigma]", "[", "i", "]"}], "->", 
            RowBox[{"mcBestdigits", "[", 
             RowBox[{"[", 
              RowBox[{"i", ",", "3"}], "]"}], "]"}]}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", 
           RowBox[{"Length", "[", "mcBestdigits", "]"}]}], "}"}]}], "]"}], "//",
        "Flatten"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"mcAmps", "=", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"Mean", "[", 
        RowBox[{
         RowBox[{"confidenceRange", "[", 
          RowBox[{"[", 
           RowBox[{"1", ",", "All", ",", "j", ",", "2"}], "]"}], "]"}], "*", 
         RowBox[{
          RowBox[{"Sqrt", "[", 
           RowBox[{"2", " ", "\[Pi]", " ", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"confidenceRange", "[", 
               RowBox[{"[", 
                RowBox[{"1", ",", "All", ",", "j", ",", "3"}], "]"}], "]"}], 
              ")"}], "^", "2"}]}], "]"}], "/", 
          RowBox[{"Total", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"confidenceRange", "[", 
              RowBox[{"[", 
               RowBox[{"1", ",", "All", ",", 
                RowBox[{"1", ";;", 
                 RowBox[{
                  RowBox[{"Length", "[", "bestfit", "]"}], "/", "3"}]}], ",", 
                "2"}], "]"}], "]"}], "*", 
             RowBox[{"Sqrt", "[", 
              RowBox[{"2", " ", "\[Pi]", " ", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"confidenceRange", "[", 
                  RowBox[{"[", 
                   RowBox[{"1", ",", "All", ",", 
                    RowBox[{"1", ";;", 
                    RowBox[{
                    RowBox[{"Length", "[", "bestfit", "]"}], "/", "3"}]}], 
                    ",", "3"}], "]"}], "]"}], ")"}], "^", "2"}]}], "]"}]}], 
            ",", 
            RowBox[{"{", "2", "}"}]}], "]"}]}]}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"j", ",", 
         RowBox[{
          RowBox[{"Length", "[", "bestfit", "]"}], "/", "3"}]}], "}"}]}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"mcAmpsSD", "=", 
     RowBox[{
      RowBox[{"Table", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"Differences", "[", 
          RowBox[{"MinMax", "[", 
           RowBox[{
            RowBox[{"confidenceRange", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "All", ",", "j", ",", "2"}], "]"}], "]"}], 
            "*", 
            RowBox[{
             RowBox[{"Sqrt", "[", 
              RowBox[{"2", " ", "\[Pi]", " ", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"confidenceRange", "[", 
                  RowBox[{"[", 
                   RowBox[{"1", ",", "All", ",", "j", ",", "3"}], "]"}], 
                  "]"}], ")"}], "^", "2"}]}], "]"}], "/", 
             RowBox[{"Total", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"confidenceRange", "[", 
                 RowBox[{"[", 
                  RowBox[{"1", ",", "All", ",", 
                   RowBox[{"1", ";;", 
                    RowBox[{
                    RowBox[{"Length", "[", "bestfit", "]"}], "/", "3"}]}], 
                   ",", "2"}], "]"}], "]"}], "*", 
                RowBox[{"Sqrt", "[", 
                 RowBox[{"2", " ", "\[Pi]", " ", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{"confidenceRange", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "All", ",", 
                    RowBox[{"1", ";;", 
                    RowBox[{
                    RowBox[{"Length", "[", "bestfit", "]"}], "/", "3"}]}], 
                    ",", "3"}], "]"}], "]"}], ")"}], "^", "2"}]}], "]"}]}], 
               ",", 
               RowBox[{"{", "2", "}"}]}], "]"}]}]}], "]"}], "]"}], "/", "2"}],
         ",", 
        RowBox[{"{", 
         RowBox[{"j", ",", 
          RowBox[{
           RowBox[{"Length", "[", "bestfit", "]"}], "/", "3"}]}], "}"}]}], 
       "]"}], "//", "Flatten"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"mycolors", "=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"RGBColor", "[", 
        RowBox[{
         RowBox[{"204", "/", "255"}], ",", 
         RowBox[{"102", "/", "255"}], ",", 
         RowBox[{"119", "/", "255"}]}], "]"}], ",", 
       RowBox[{"RGBColor", "[", 
        RowBox[{
         RowBox[{"221", "/", "255"}], ",", 
         RowBox[{"204", "/", "255"}], ",", 
         RowBox[{"119", "/", "255"}]}], "]"}], ",", 
       RowBox[{"RGBColor", "[", 
        RowBox[{
         RowBox[{"68", "/", "255"}], ",", 
         RowBox[{"119", "/", "255"}], ",", 
         RowBox[{"170", "/", "255"}]}], "]"}]}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"MinMaxRound", "[", "list_", "]"}], ":=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{"Min", "[", "list", "]"}], "//", "Floor"}], ",", 
       RowBox[{
        RowBox[{"Max", "[", "list", "]"}], "//", "Ceiling"}]}], "}"}]}], 
    ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"mcPlots", "=", 
     RowBox[{"Grid", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"storage", "=", 
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"confidencedata", "[", 
                  RowBox[{"[", 
                   RowBox[{"i", ",", "All", ",", "j", ",", "1"}], "]"}], 
                  "]"}], ",", 
                 RowBox[{"confidencedata", "[", 
                  RowBox[{"[", 
                   RowBox[{"i", ",", "All", ",", "j", ",", 
                    RowBox[{"-", "1"}]}], "]"}], "]"}]}], "}"}], 
               "\[Transpose]"}], ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", "1", ",", "3"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"j", ",", 
                RowBox[{
                 RowBox[{"Length", "[", "bestfit", "]"}], "/", "3"}]}], 
               "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"one", "=", 
            RowBox[{"Developer`ToPackedArray", "[", 
             RowBox[{"Flatten", "[", 
              RowBox[{
               RowBox[{"storage", "[", 
                RowBox[{"[", "1", "]"}], "]"}], ",", "1"}], "]"}], "]"}]}], 
           ";", "\[IndentingNewLine]", 
           RowBox[{"two", "=", 
            RowBox[{"Developer`ToPackedArray", "[", 
             RowBox[{"Flatten", "[", 
              RowBox[{
               RowBox[{"storage", "[", 
                RowBox[{"[", "2", "]"}], "]"}], ",", "1"}], "]"}], "]"}]}], 
           ";", "\[IndentingNewLine]", 
           RowBox[{"three", "=", 
            RowBox[{"Developer`ToPackedArray", "[", 
             RowBox[{"Flatten", "[", 
              RowBox[{
               RowBox[{"storage", "[", 
                RowBox[{"[", "3", "]"}], "]"}], ",", "1"}], "]"}], "]"}]}], 
           ";", "\[IndentingNewLine]", 
           RowBox[{"Labeled", "[", 
            RowBox[{
             RowBox[{"Graphics", "[", 
              RowBox[{
               RowBox[{"Riffle", "[", 
                RowBox[{"mycolors", ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"Point", "@", "one"}], ",", 
                   RowBox[{"Point", "@", "two"}], ",", 
                   RowBox[{"Point", "@", "three"}]}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"2", ",", 
                   RowBox[{"-", "1"}], ",", "2"}], "}"}]}], "]"}], ",", 
               RowBox[{"Axes", "\[Rule]", "True"}], ",", 
               RowBox[{"LabelStyle", "\[Rule]", 
                RowBox[{"helv", "[", "24", "]"}]}], ",", 
               RowBox[{"ImageSize", "\[Rule]", "525"}], ",", 
               RowBox[{"PlotRange", "\[Rule]", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"MinMaxRound", "[", 
                   RowBox[{"one", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "1"}], "]"}], "]"}], "]"}], ",", 
                  RowBox[{"MinMax", "[", 
                   RowBox[{"one", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "2"}], "]"}], "]"}], "]"}]}], "}"}]}],
                ",", 
               RowBox[{"AxesOrigin", "\[Rule]", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"MinMaxRound", "[", 
                    RowBox[{"one", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "1"}], "]"}], "]"}], "]"}], "[", 
                   RowBox[{"[", "1", "]"}], "]"}], ",", 
                  RowBox[{"Min", "[", 
                   RowBox[{"one", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "2"}], "]"}], "]"}], "]"}]}], "}"}]}],
                ",", 
               RowBox[{"AspectRatio", "\[Rule]", "1"}], ",", 
               RowBox[{"Epilog", "\[Rule]", 
                RowBox[{"Join", "[", 
                 RowBox[{
                  RowBox[{"If", "[", "\[IndentingNewLine]", 
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", "bestfit", "]"}], "/", "3"}], 
                    "\[GreaterEqual]", "2"}], ",", 
                    RowBox[{"Table", "[", 
                    RowBox[{
                    RowBox[{"Text", "[", 
                    RowBox[{
                    RowBox[{"Style", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"ToString", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"mcvalues", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "3"}], "]"}], "]"}], "*", "100"}], "//",
                     "Round"}], "]"}], "<>", "\"\<%\>\""}], ",", 
                    RowBox[{"helv", "[", "18", "]"}]}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"mcvalues", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "1"}], "]"}], "]"}], "+", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"confidencedata", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "All", ",", "i", ",", "1"}], "]"}], 
                    "]"}], "//", "StandardDeviation"}], ")"}], "*", "3"}]}], 
                    ",", 
                    RowBox[{"mcvalues", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "2"}], "]"}], "]"}]}], "}"}], ",", 
                    "Left"}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"i", ",", 
                    RowBox[{"Length", "[", "mcvalues", "]"}]}], "}"}]}], 
                    "]"}], ",", 
                    RowBox[{"{", "}"}]}], "]"}], ",", 
                  RowBox[{"Table", "[", 
                   RowBox[{
                    RowBox[{"Text", "[", 
                    RowBox[{
                    RowBox[{"Style", "[", 
                    RowBox[{"\"\<+\>\"", ",", 
                    RowBox[{"helv", "[", "24", "]"}], ",", "White", ",", 
                    "Bold"}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"mcvalues", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "1"}], "]"}], "]"}], ",", 
                    RowBox[{"mcvalues", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "2"}], "]"}], "]"}]}], "}"}]}], "]"}], 
                    ",", 
                    RowBox[{"{", 
                    RowBox[{"i", ",", 
                    RowBox[{"Length", "[", "mcvalues", "]"}]}], "}"}]}], 
                   "]"}]}], "]"}]}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{
              "\"\<Gaussian Width (nm)\>\"", ",", 
               "\"\<Gaussian Center (nm)\>\""}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"Left", ",", "Bottom"}], "}"}], ",", 
             RowBox[{"RotateLabel", "\[Rule]", "True"}], ",", 
             RowBox[{"LabelStyle", "\[Rule]", 
              RowBox[{"helv", "[", "24", "]"}]}], ",", 
             RowBox[{"ImageSize", "\[Rule]", "525"}], ",", 
             RowBox[{"Spacings", "\[Rule]", "0"}]}], "]"}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"Grid", "[", 
           RowBox[{
            RowBox[{"Table", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{
                 RowBox[{"storage", "=", 
                  RowBox[{"Table", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"confidencedata", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "All", ",", "j", ",", "1"}], "]"}], 
                    "]"}], ",", 
                    RowBox[{"confidencedata", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "All", ",", 
                    RowBox[{"-", "1"}]}], "]"}], "]"}]}], "}"}], 
                    "\[Transpose]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"i", ",", "1", ",", "3"}], "}"}]}], "]"}]}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"one", "=", 
                  RowBox[{"Developer`ToPackedArray", "[", 
                   RowBox[{"storage", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"two", "=", 
                  RowBox[{"Developer`ToPackedArray", "[", 
                   RowBox[{"storage", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "]"}]}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"three", "=", 
                  RowBox[{"Developer`ToPackedArray", "[", 
                   RowBox[{"storage", "[", 
                    RowBox[{"[", "3", "]"}], "]"}], "]"}]}], ";", 
                 "\[IndentingNewLine]", "\[IndentingNewLine]", 
                 RowBox[{"Labeled", "[", 
                  RowBox[{
                   RowBox[{"Graphics", "[", 
                    RowBox[{
                    RowBox[{"Riffle", "[", 
                    RowBox[{"mycolors", ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Point", "@", "one"}], ",", 
                    RowBox[{"Point", "@", "two"}], ",", 
                    RowBox[{"Point", "@", "three"}]}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"2", ",", 
                    RowBox[{"-", "1"}], ",", "2"}], "}"}]}], "]"}], ",", 
                    RowBox[{"PlotRange", "\[Rule]", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"MinMaxRound", "[", 
                    RowBox[{"one", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "1"}], "]"}], "]"}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"0", ",", "1"}], "}"}]}], "}"}]}], ",", 
                    RowBox[{"AxesOrigin", "\[Rule]", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"MinMaxRound", "[", 
                    RowBox[{"one", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "1"}], "]"}], "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", "0"}], "}"}]}], ",", 
                    
                    RowBox[{"Axes", "\[Rule]", "True"}], ",", 
                    RowBox[{"LabelStyle", "\[Rule]", 
                    RowBox[{"helv", "[", "12", "]"}]}], ",", 
                    RowBox[{"ImageSize", "\[Rule]", "250"}], ",", 
                    RowBox[{"AspectRatio", "\[Rule]", 
                    RowBox[{"1", "/", "GoldenRatio"}]}]}], "]"}], ",", 
                   RowBox[{"{", 
                    RowBox[{"\"\<Cumulative Freq\>\"", ",", 
                    RowBox[{"\"\<Gaussian Center \>\"", "<>", 
                    RowBox[{"ToString", "[", "j", "]"}], "<>", 
                    "\"\< (nm)\>\""}]}], "}"}], ",", 
                   RowBox[{"{", 
                    RowBox[{"Left", ",", "Bottom"}], "}"}], ",", 
                   RowBox[{"RotateLabel", "\[Rule]", "True"}], ",", 
                   RowBox[{"LabelStyle", "\[Rule]", 
                    RowBox[{"helv", "[", "12", "]"}]}], ",", 
                   RowBox[{"ImageSize", "\[Rule]", "250"}], ",", 
                   RowBox[{"Spacings", "\[Rule]", "0"}]}], "]"}]}], ",", 
                "\[IndentingNewLine]", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"storage", "=", 
                  RowBox[{"Table", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"confidencedata", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "All", ",", "j", ",", 
                    RowBox[{"-", "1"}]}], "]"}], "]"}], ",", 
                    RowBox[{"confidencedata", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "All", ",", 
                    RowBox[{"-", "1"}]}], "]"}], "]"}]}], "}"}], 
                    "\[Transpose]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"i", ",", "1", ",", "3"}], "}"}]}], "]"}]}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"one", "=", 
                  RowBox[{"Developer`ToPackedArray", "[", 
                   RowBox[{"storage", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"two", "=", 
                  RowBox[{"Developer`ToPackedArray", "[", 
                   RowBox[{"storage", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "]"}]}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"three", "=", 
                  RowBox[{"Developer`ToPackedArray", "[", 
                   RowBox[{"storage", "[", 
                    RowBox[{"[", "3", "]"}], "]"}], "]"}]}], ";", 
                 "\[IndentingNewLine]", "\[IndentingNewLine]", 
                 RowBox[{"Labeled", "[", 
                  RowBox[{
                   RowBox[{"Graphics", "[", 
                    RowBox[{
                    RowBox[{"Riffle", "[", 
                    RowBox[{"mycolors", ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Point", "@", "one"}], ",", 
                    RowBox[{"Point", "@", "two"}], ",", 
                    RowBox[{"Point", "@", "three"}]}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"2", ",", 
                    RowBox[{"-", "1"}], ",", "2"}], "}"}]}], "]"}], ",", 
                    RowBox[{"PlotRange", "\[Rule]", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"MinMaxRound", "[", 
                    RowBox[{"one", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "1"}], "]"}], "]"}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"0", ",", "1"}], "}"}]}], "}"}]}], ",", 
                    RowBox[{"Axes", "\[Rule]", "True"}], ",", 
                    RowBox[{"LabelStyle", "\[Rule]", 
                    RowBox[{"helv", "[", "12", "]"}]}], ",", 
                    RowBox[{"ImageSize", "\[Rule]", "250"}], ",", 
                    RowBox[{"AspectRatio", "\[Rule]", 
                    RowBox[{"1", "/", "GoldenRatio"}]}]}], "]"}], ",", 
                   RowBox[{"{", 
                    RowBox[{"\"\<Cumulative Freq\>\"", ",", 
                    RowBox[{"\"\<Gaussian Width \>\"", "<>", 
                    RowBox[{"ToString", "[", "j", "]"}], "<>", 
                    "\"\< (nm)\>\""}]}], "}"}], ",", 
                   RowBox[{"{", 
                    RowBox[{"Left", ",", "Bottom"}], "}"}], ",", 
                   RowBox[{"RotateLabel", "\[Rule]", "True"}], ",", 
                   RowBox[{"LabelStyle", "\[Rule]", 
                    RowBox[{"helv", "[", "12", "]"}]}], ",", 
                   RowBox[{"ImageSize", "\[Rule]", "250"}], ",", 
                   RowBox[{"Spacings", "\[Rule]", "0"}]}], "]"}]}], ",", 
                "\[IndentingNewLine]", "\[IndentingNewLine]", 
                RowBox[{"If", "[", "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{"Length", "[", "bestfit", "]"}], "/", "3"}], 
                   "\[GreaterEqual]", "2"}], ",", "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"storage", "=", 
                    RowBox[{"Table", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"confidencedata", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "All", ",", "j", ",", "2"}], "]"}], 
                    "]"}], "*", 
                    RowBox[{
                    RowBox[{"Sqrt", "[", 
                    RowBox[{"2", " ", "\[Pi]", " ", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"confidencedata", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "All", ",", "j", ",", 
                    RowBox[{"-", "1"}]}], "]"}], "]"}], ")"}], "^", "2"}]}], 
                    "]"}], "/", 
                    RowBox[{"(", 
                    RowBox[{"Total", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"confidencedata", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "All", ",", 
                    RowBox[{"1", ";;", 
                    RowBox[{
                    RowBox[{"Length", "[", "bestfit", "]"}], "/", "3"}]}], 
                    ",", "2"}], "]"}], "]"}], "*", 
                    RowBox[{"Sqrt", "[", 
                    RowBox[{"2", " ", "\[Pi]", " ", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"confidencedata", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "All", ",", 
                    RowBox[{"1", ";;", 
                    RowBox[{
                    RowBox[{"Length", "[", "bestfit", "]"}], "/", "3"}]}], 
                    ",", 
                    RowBox[{"-", "1"}]}], "]"}], "]"}], ")"}], "^", "2"}]}], 
                    "]"}]}], ",", 
                    RowBox[{"{", "2", "}"}]}], "]"}], ")"}]}]}], ",", 
                    RowBox[{"confidencedata", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "All", ",", 
                    RowBox[{"-", "1"}]}], "]"}], "]"}]}], "}"}], 
                    "\[Transpose]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"i", ",", "1", ",", "3"}], "}"}]}], "]"}]}], ";", 
                   "\[IndentingNewLine]", 
                   RowBox[{"one", "=", 
                    RowBox[{"Developer`ToPackedArray", "[", 
                    RowBox[{"storage", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ";", 
                   "\[IndentingNewLine]", 
                   RowBox[{"two", "=", 
                    RowBox[{"Developer`ToPackedArray", "[", 
                    RowBox[{"storage", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "]"}]}], ";", 
                   "\[IndentingNewLine]", 
                   RowBox[{"three", "=", 
                    RowBox[{"Developer`ToPackedArray", "[", 
                    RowBox[{"storage", "[", 
                    RowBox[{"[", "3", "]"}], "]"}], "]"}]}], ";", 
                   "\[IndentingNewLine]", "\[IndentingNewLine]", 
                   RowBox[{"Labeled", "[", 
                    RowBox[{
                    RowBox[{"Graphics", "[", 
                    RowBox[{
                    RowBox[{"Riffle", "[", 
                    RowBox[{"mycolors", ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Point", "@", "one"}], ",", 
                    RowBox[{"Point", "@", "two"}], ",", 
                    RowBox[{"Point", "@", "three"}]}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"2", ",", 
                    RowBox[{"-", "1"}], ",", "2"}], "}"}]}], "]"}], ",", 
                    RowBox[{"PlotRange", "\[Rule]", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"0", ",", "1"}], "}"}], ",", "All"}], "}"}]}], 
                    ",", 
                    RowBox[{"Axes", "\[Rule]", "True"}], ",", 
                    RowBox[{"AxesOrigin", "\[Rule]", 
                    RowBox[{"{", 
                    RowBox[{"0", ",", "0"}], "}"}]}], ",", 
                    RowBox[{"LabelStyle", "\[Rule]", 
                    RowBox[{"helv", "[", "12", "]"}]}], ",", 
                    RowBox[{"ImageSize", "\[Rule]", "250"}], ",", 
                    RowBox[{"AspectRatio", "\[Rule]", 
                    RowBox[{"1", "/", "GoldenRatio"}]}]}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"\"\<Cumulative Freq\>\"", ",", 
                    RowBox[{"\"\<Mole Fraction \>\"", "<>", 
                    RowBox[{"ToString", "[", "j", "]"}], "<>", 
                    "\"\< (nm)\>\""}]}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"Left", ",", "Bottom"}], "}"}], ",", 
                    RowBox[{"RotateLabel", "\[Rule]", "True"}], ",", 
                    RowBox[{"LabelStyle", "\[Rule]", 
                    RowBox[{"helv", "[", "12", "]"}]}], ",", 
                    RowBox[{"ImageSize", "\[Rule]", "250"}], ",", 
                    RowBox[{"Spacings", "\[Rule]", "0"}]}], "]"}]}], ",", 
                  "\"\< \>\""}], "]"}]}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"j", ",", 
                RowBox[{
                 RowBox[{"Length", "[", "bestfit", "]"}], "/", "3"}]}], 
               "}"}]}], "]"}], "\[Transpose]"}], "]"}]}], "}"}], "}"}], ",", 
       RowBox[{"Alignment", "\[Rule]", "Top"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"\"\<Adjust Search Weights:\>\"", ",", 
      RowBox[{"TableForm", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Riffle", "[", 
          RowBox[{"poptext", ",", 
           RowBox[{"Array", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"InputField", "[", 
               RowBox[{
                RowBox[{"Dynamic", "[", 
                 RowBox[{"mult", "[", 
                  RowBox[{"[", "##", "]"}], "]"}], "]"}], ",", 
                RowBox[{"FieldSize", "\[Rule]", "3"}]}], "]"}], "&"}], ",", 
             "bestfitpopulation"}], "]"}]}], "]"}], "}"}], ",", 
        RowBox[{"TableSpacing", "\[Rule]", 
         RowBox[{"{", 
          RowBox[{"1", ",", "2"}], "}"}]}]}], "]"}], ",", "mcPlots"}], "}"}], 
    "//", "TableForm"}]}]}]], "Input",
 Editable->False,
 CellChangeTimes->{{3.699291842456263*^9, 3.6992919698516397`*^9}, {
   3.6992920388258038`*^9, 3.6992920391145144`*^9}, {3.699292077601633*^9, 
   3.699292102159025*^9}, {3.699292136046671*^9, 3.699292138980925*^9}, {
   3.69929218696243*^9, 3.699292190474846*^9}, 3.69929226185315*^9, {
   3.699292363883812*^9, 3.6992925088443623`*^9}, {3.699292679923627*^9, 
   3.69929268224998*^9}, {3.699292774441201*^9, 3.699292782244774*^9}, {
   3.699292962769764*^9, 3.699292964916642*^9}, {3.699370124664112*^9, 
   3.699370128951397*^9}, 3.699716056174776*^9, {3.699716184254599*^9, 
   3.699716186432366*^9}, {3.699716219616005*^9, 3.6997162216524973`*^9}, {
   3.699716364512693*^9, 3.699716366687784*^9}, {3.699716551261582*^9, 
   3.699716604059132*^9}, 3.699716675335322*^9, {3.699717158495286*^9, 
   3.6997171806001387`*^9}, 3.699717215585052*^9, {3.699717267829536*^9, 
   3.699717304864448*^9}, 3.699717495506342*^9, {3.699717529897338*^9, 
   3.699717552130413*^9}, 3.699717679100568*^9, {3.699717816373101*^9, 
   3.699717899745101*^9}, {3.6997179364858313`*^9, 3.699717938502132*^9}, {
   3.699720561705179*^9, 3.6997205634954367`*^9}, {3.699720629740717*^9, 
   3.699720636140418*^9}, {3.6997207575290947`*^9, 3.69972075967524*^9}, 
   3.699720808748488*^9, {3.699720881278818*^9, 3.699720883234703*^9}, 
   3.6997210290069637`*^9, {3.699721061288642*^9, 3.699721068803115*^9}, {
   3.699721099105206*^9, 3.699721106441461*^9}, {3.699799874395019*^9, 
   3.6997998875667973`*^9}, {3.699801307923049*^9, 3.699801309774938*^9}, {
   3.699801357746072*^9, 3.6998013592515574`*^9}, {3.699801537739162*^9, 
   3.6998015468741713`*^9}, {3.699801665651919*^9, 3.6998016701631947`*^9}, {
   3.6998020170857477`*^9, 3.699802021266851*^9}, {3.699802244050496*^9, 
   3.699802293324197*^9}, {3.6998035238359423`*^9, 3.699803631475525*^9}, {
   3.6998036964317303`*^9, 3.699803710480335*^9}, {3.699893927094026*^9, 
   3.699893933337658*^9}, {3.699894713867443*^9, 3.699894714929755*^9}, 
   3.700500077608416*^9, {3.701013537883482*^9, 3.701013541103476*^9}, {
   3.7010137395802517`*^9, 3.701013741724553*^9}, {3.701013776821376*^9, 
   3.701013804803206*^9}, {3.7010138393344297`*^9, 3.701013851830557*^9}, {
   3.701013898615882*^9, 3.701013900126625*^9}, {3.7010139778054943`*^9, 
   3.7010139814733963`*^9}, {3.70101429425907*^9, 3.701014363025756*^9}, {
   3.7010146564305553`*^9, 3.701014672162024*^9}, {3.701014876488542*^9, 
   3.701014892907937*^9}, {3.701015003299551*^9, 3.7010150306575603`*^9}, {
   3.701448957717826*^9, 3.701448959817691*^9}, {3.7014489946092377`*^9, 
   3.70144902872889*^9}, {3.701704619205546*^9, 3.701704709043927*^9}, 
   3.717954884995728*^9, 3.718028226068391*^9, {3.726503698212838*^9, 
   3.7265037216989*^9}, {3.7293425056390944`*^9, 3.7293426138371277`*^9}, {
   3.729533361471528*^9, 3.72953336245643*^9}, {3.729533535177066*^9, 
   3.7295335955301723`*^9}, {3.729535928117877*^9, 3.729535936845595*^9}, 
   3.729559579842169*^9, {3.729559610335557*^9, 3.729559638129615*^9}, {
   3.7295597332688837`*^9, 3.729559791043642*^9}, {3.729560438653467*^9, 
   3.729560447207534*^9}, {3.7295604953461447`*^9, 3.72956050161092*^9}, 
   3.729560549697891*^9, {3.7295606628903646`*^9, 3.7295606648055983`*^9}, {
   3.729560701631926*^9, 3.72956070466999*^9}, {3.729608008512046*^9, 
   3.729608012263296*^9}, {3.7296080621967077`*^9, 3.729608062995894*^9}, {
   3.729608108206285*^9, 3.729608111262025*^9}, {3.7296081446047993`*^9, 
   3.729608145377473*^9}, 3.7296082554897203`*^9, {3.729610788446188*^9, 
   3.729610791511731*^9}, {3.729610897606748*^9, 3.729610959042005*^9}, {
   3.729611005222821*^9, 3.729611011165125*^9}, {3.729611147126677*^9, 
   3.729611157821591*^9}, {3.729611392521513*^9, 3.7296113938891973`*^9}, {
   3.72961142898153*^9, 3.729611443493787*^9}, {3.729611529838531*^9, 
   3.729611529954443*^9}, 3.729611609070475*^9, {3.729611651965847*^9, 
   3.7296117124680653`*^9}, {3.7296120036475773`*^9, 3.729612007135026*^9}, {
   3.729612208806756*^9, 3.7296122971412992`*^9}, {3.729612337655126*^9, 
   3.7296123384936237`*^9}, {3.729615131608968*^9, 3.729615177429389*^9}, {
   3.7296152142816133`*^9, 3.7296152154335938`*^9}, {3.7296153517095747`*^9, 
   3.7296153559483232`*^9}, {3.729615515151374*^9, 3.729615516567286*^9}, 
   3.729615651533366*^9, {3.729615846208756*^9, 3.7296158896039953`*^9}, {
   3.729615929142869*^9, 3.72961593239995*^9}, 3.729615995193619*^9, {
   3.72961609389636*^9, 3.729616096189744*^9}, {3.7296161420454903`*^9, 
   3.729616148245751*^9}, 3.729616428349909*^9, {3.729616465512965*^9, 
   3.729616515335567*^9}, {3.729616590065186*^9, 3.729616604266045*^9}, {
   3.729616658139636*^9, 3.72961667552971*^9}, {3.729617154059903*^9, 
   3.7296171544558077`*^9}, {3.729617204200026*^9, 3.729617204400017*^9}, {
   3.729617283092802*^9, 3.729617315321226*^9}, {3.729617377974435*^9, 
   3.7296174183022003`*^9}, {3.729617468044999*^9, 3.72961750299076*^9}, 
   3.729617548836857*^9, {3.729617803344097*^9, 3.729617805049271*^9}, {
   3.729617847854993*^9, 3.729617848317466*^9}, 3.7296179059942923`*^9, 
   3.729617999344678*^9, {3.729618130238934*^9, 3.729618138751403*^9}, {
   3.729618212250993*^9, 3.7296182129957733`*^9}, {3.729856062879806*^9, 
   3.729856073575083*^9}, {3.729856159793521*^9, 3.729856163878622*^9}, {
   3.7298562764186497`*^9, 3.729856277558867*^9}, {3.729856589892439*^9, 
   3.729856591134507*^9}, {3.729856677699045*^9, 3.729856690924666*^9}, {
   3.729856770418296*^9, 3.729856774267234*^9}, {3.7298569428758097`*^9, 
   3.7298569592036047`*^9}, 3.729857205894788*^9, 3.729857315584469*^9, 
   3.72986116648564*^9, {3.729863314347381*^9, 3.729863329033209*^9}, {
   3.729952328689473*^9, 3.729952473341236*^9}, {3.729952517171782*^9, 
   3.7299525192908087`*^9}, {3.729952631311514*^9, 3.729952747696906*^9}, {
   3.729952840601903*^9, 3.729952841850769*^9}, {3.729955010151984*^9, 
   3.729955065827517*^9}, {3.729955160692504*^9, 3.729955172018016*^9}, {
   3.7299553256015253`*^9, 3.729955345004731*^9}, {3.731260783979788*^9, 
   3.731260805072386*^9}, {3.73141457458858*^9, 3.731414597926291*^9}, {
   3.73142930087873*^9, 3.7314293064570227`*^9}, {3.7314293506806097`*^9, 
   3.731429351894256*^9}, {3.731429457999467*^9, 3.731429478090313*^9}, {
   3.731440840953353*^9, 3.7314408468134813`*^9}, {3.731689813168165*^9, 
   3.73168984168825*^9}, {3.731689901174374*^9, 3.731689910320614*^9}, {
   3.7316901437495623`*^9, 3.7316901701697073`*^9}, {3.731690220494135*^9, 
   3.73169022406539*^9}, {3.731690373656128*^9, 3.7316904462026587`*^9}, {
   3.731691391208572*^9, 
   3.731691396797492*^9}},ExpressionUUID->"5a643434-8fc6-4445-8dda-\
474cb5e324de"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"confidencepeaksNI", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"Total", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"peakfunc", "[", 
         RowBox[{"##", ",", "r"}], "]"}], "&"}], "@@@", 
       RowBox[{"Most", "[", 
        RowBox[{"confidencedata", "[", 
         RowBox[{"[", 
          RowBox[{"3", ",", "i"}], "]"}], "]"}], "]"}]}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", 
           RowBox[{"confidencedata", "[", 
            RowBox[{"[", "3", "]"}], "]"}], "]"}], ">", "200"}], ",", "200", 
         ",", 
         RowBox[{"Length", "[", 
          RowBox[{"confidencedata", "[", 
           RowBox[{"[", "3", "]"}], "]"}], "]"}]}], "]"}]}], "}"}]}], "]"}]}],
   ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"confidencepeaks", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"Total", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"peakfunc", "[", 
          RowBox[{"##", ",", "r"}], "]"}], "&"}], "@@@", 
        RowBox[{"Most", "[", 
         RowBox[{"confidencedata", "[", 
          RowBox[{"[", 
           RowBox[{"3", ",", "i"}], "]"}], "]"}], "]"}]}], "]"}], "/", 
      RowBox[{"NIntegrate", "[", 
       RowBox[{
        RowBox[{"Total", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"peakfunc", "[", 
            RowBox[{"##", ",", "x"}], "]"}], "&"}], "@@@", 
          RowBox[{"Most", "[", 
           RowBox[{"confidencedata", "[", 
            RowBox[{"[", 
             RowBox[{"3", ",", "i"}], "]"}], "]"}], "]"}]}], "]"}], ",", 
        RowBox[{"Prepend", "[", 
         RowBox[{
          RowBox[{"MinMax", "[", "r", "]"}], ",", "x"}], "]"}]}], "]"}]}], 
     ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", 
           RowBox[{"confidencedata", "[", 
            RowBox[{"[", "3", "]"}], "]"}], "]"}], ">", "200"}], ",", "200", 
         ",", 
         RowBox[{"Length", "[", 
          RowBox[{"confidencedata", "[", 
           RowBox[{"[", "3", "]"}], "]"}], "]"}]}], "]"}]}], "}"}]}], "]"}]}],
   ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"mcDistros", "=", 
    RowBox[{
     RowBox[{
      RowBox[{"labelR", "[", 
       RowBox[{
        RowBox[{"distrPlot", "[", 
         RowBox[{
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"{", 
              RowBox[{"r", ",", 
               RowBox[{"confidencepeaks", "[", 
                RowBox[{"[", "i", "]"}], "]"}]}], "}"}], "\[Transpose]"}], 
            ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", "1", ",", 
              RowBox[{"Length", "[", "confidencepeaks", "]"}]}], "}"}]}], 
           "]"}], ",", "##"}], "]"}], ",", "##"}], "]"}], "&"}], "@@", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"LabelStyle", "\[Rule]", 
        RowBox[{"helv", "[", "42", "]"}]}], ",", 
       RowBox[{"ImageSize", "\[Rule]", "750"}]}], "}"}]}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"mcSpectra", "=", 
   RowBox[{
    RowBox[{
     RowBox[{"labelT", "[", 
      RowBox[{
       RowBox[{"Show", "[", 
        RowBox[{
         RowBox[{"specPlot", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"{", 
             RowBox[{"t", ",", "newwaveform"}], "}"}], "\[Transpose]"}], ",", 
           
           RowBox[{"PlotStyle", "\[Rule]", "Gray"}]}], "]"}], ",", 
         RowBox[{"specPlot", "[", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"{", 
              RowBox[{"t", ",", 
               RowBox[{
                RowBox[{"kernel", ".", 
                 RowBox[{"(", 
                  RowBox[{"confidencepeaksNI", "[", 
                   RowBox[{"[", "i", "]"}], "]"}], ")"}]}], "/", 
                RowBox[{"Max", "[", 
                 RowBox[{"kernel", ".", 
                  RowBox[{"(", 
                   RowBox[{"confidencepeaksNI", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], ")"}]}], "]"}]}]}], "}"}],
              "\[Transpose]"}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", "1", ",", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"Length", "[", 
                  RowBox[{"confidencedata", "[", 
                   RowBox[{"[", "3", "]"}], "]"}], "]"}], ">", "200"}], ",", 
                "200", ",", 
                RowBox[{"Length", "[", 
                 RowBox[{"confidencedata", "[", 
                  RowBox[{"[", "3", "]"}], "]"}], "]"}]}], "]"}]}], "}"}]}], 
           "]"}], "]"}], ",", "##"}], "]"}], ",", "##"}], "]"}], "&"}], "@@", 
    
    RowBox[{"{", 
     RowBox[{
      RowBox[{"LabelStyle", "\[Rule]", 
       RowBox[{"helv", "[", "42", "]"}]}], ",", 
      RowBox[{"ImageSize", "\[Rule]", "750"}]}], "}"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"{", 
   RowBox[{"{", 
    RowBox[{"mcSpectra", ",", "mcDistros"}], "}"}], "}"}], "//", 
  "TableForm"}], "\[IndentingNewLine]"}], "Input",
 Editable->False,
 CellChangeTimes->{
  3.7298596852506113`*^9, {3.7298597848169117`*^9, 3.729859785307496*^9}, 
   3.7298598187824183`*^9, 3.729861248076688*^9, {3.7313619896117983`*^9, 
   3.731362028186927*^9}, {3.731362082019392*^9, 3.731362121416851*^9}, {
   3.7314142481057158`*^9, 
   3.731414256076578*^9}},ExpressionUUID->"1aec91be-aa7d-4556-a45f-\
351c9284df5d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"mcQuant", "[", "monte_", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "peaks", ",", "lower", ",", "upper", ",", "normalized", ",", "storage"}],
      "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"storage", "=", "monte"}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"storage", "[", 
       RowBox[{"[", 
        RowBox[{"All", ",", "All", ",", "2"}], "]"}], "]"}], "=", 
      RowBox[{
       RowBox[{"monte", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", "All", ",", "2"}], "]"}], "]"}], "/", 
       RowBox[{"Total", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"monte", "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", "All", ",", "2"}], "]"}], "]"}], "*", 
          RowBox[{"Sqrt", "[", 
           RowBox[{"2", " ", "\[Pi]", " ", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"monte", "[", 
               RowBox[{"[", 
                RowBox[{"All", ",", "All", ",", 
                 RowBox[{"-", "1"}]}], "]"}], "]"}], ")"}], "^", "2"}]}], 
           "]"}]}], ",", 
         RowBox[{"{", "2", "}"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"peaks", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"Total", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"peakfunc", "[", 
            RowBox[{"##", ",", "r"}], "]"}], "&"}], "@@@", 
          RowBox[{"storage", "[", 
           RowBox[{"[", "i", "]"}], "]"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "@", "storage"}]}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"lower", "=", 
      RowBox[{"Quantile", "@@", 
       RowBox[{"{", 
        RowBox[{"peaks", ",", "0."}], "}"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"upper", "=", 
      RowBox[{"Quantile", "@@", 
       RowBox[{"{", 
        RowBox[{"peaks", ",", "1."}], "}"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{"lower", ",", "upper"}], "}"}]}]}], "\[IndentingNewLine]", 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"AbsoluteTiming", "[", 
  RowBox[{
   RowBox[{"myquantiles95", "=", 
    RowBox[{"mcQuant", "[", 
     RowBox[{"Take", "[", 
      RowBox[{
       RowBox[{"Select", "[", 
        RowBox[{"walkies", ",", 
         RowBox[{
          RowBox[{
           RowBox[{"#", "[", 
            RowBox[{"[", 
             RowBox[{"-", "1"}], "]"}], "]"}], "\[LessEqual]", ".95"}], 
          "&"}]}], "]"}], ",", "All", ",", "bestfitpopulation"}], "]"}], 
     "]"}]}], ";"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"myquantiles60", "=", 
    RowBox[{"mcQuant", "[", 
     RowBox[{"Take", "[", 
      RowBox[{
       RowBox[{"Select", "[", 
        RowBox[{"walkies", ",", 
         RowBox[{
          RowBox[{
           RowBox[{"#", "[", 
            RowBox[{"[", 
             RowBox[{"-", "1"}], "]"}], "]"}], "\[LessEqual]", ".6"}], 
          "&"}]}], "]"}], ",", "All", ",", "bestfitpopulation"}], "]"}], 
     "]"}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"mcBeststatistics", "=", 
    RowBox[{"tabletextMC", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"\[Mu]", "[", "i", "]"}], "\[Rule]", 
            RowBox[{
             RowBox[{"mcCenters", "[", 
              RowBox[{"[", "i", "]"}], "]"}], "\[PlusMinus]", 
             RowBox[{"mcCentersSD", "[", 
              RowBox[{"[", "i", "]"}], "]"}]}]}], ",", 
           RowBox[{
            RowBox[{"A", "[", "i", "]"}], "->", 
            RowBox[{
             RowBox[{"mcAmps", "[", 
              RowBox[{"[", "i", "]"}], "]"}], "\[PlusMinus]", 
             RowBox[{"mcAmpsSD", "[", 
              RowBox[{"[", "i", "]"}], "]"}]}]}], ",", 
           RowBox[{
            RowBox[{"\[Sigma]", "[", "i", "]"}], "\[Rule]", 
            RowBox[{
             RowBox[{"mcWidths", "[", 
              RowBox[{"[", "i", "]"}], "]"}], "\[PlusMinus]", 
             RowBox[{"mcWidthsSD", "[", 
              RowBox[{"[", "i", "]"}], "]"}]}]}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", 
           RowBox[{"Length", "[", "mcBestdigits", "]"}]}], "}"}]}], "]"}], "//",
        "Flatten"}], ",", "Black"}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"mcDistrosStats", "=", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"labelR", "[", 
         RowBox[{
          RowBox[{"Show", "[", 
           RowBox[{
            RowBox[{"distrPlot", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"r", ",", 
                   RowBox[{"myquantiles95", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "}"}], "\[Transpose]"}],
                 ",", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"r", ",", 
                   RowBox[{"myquantiles95", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "}"}], 
                 "\[Transpose]"}]}], "}"}], ",", 
              RowBox[{"Filling", "\[Rule]", 
               RowBox[{"{", 
                RowBox[{"1", "\[Rule]", 
                 RowBox[{"{", "2", "}"}]}], "}"}]}], ",", 
              RowBox[{"PlotStyle", "->", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"mycolors", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", "Thin"}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"mycolors", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", "Thin"}], "}"}]}], 
                "}"}]}]}], "]"}], ",", "\[IndentingNewLine]", 
            RowBox[{"distrPlot", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"r", ",", 
                   RowBox[{"myquantiles60", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "}"}], "\[Transpose]"}],
                 ",", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"r", ",", 
                   RowBox[{"myquantiles60", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "}"}], 
                 "\[Transpose]"}]}], "}"}], ",", 
              RowBox[{"Filling", "\[Rule]", 
               RowBox[{"{", 
                RowBox[{"1", "\[Rule]", 
                 RowBox[{"{", "2", "}"}]}], "}"}]}], ",", 
              RowBox[{"PlotStyle", "->", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"mycolors", "[", 
                    RowBox[{"[", "3", "]"}], "]"}], ",", "Thin"}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"mycolors", "[", 
                    RowBox[{"[", "3", "]"}], "]"}], ",", "Thin"}], "}"}]}], 
                "}"}]}]}], "]"}], ",", 
            RowBox[{"distrPlot", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{"r", ",", "newdistribution"}], "}"}], 
               "\[Transpose]"}], ",", 
              RowBox[{"PlotStyle", "\[Rule]", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"color", "[", "1", "]"}], ",", "Dashed"}], "}"}]}]}],
              "]"}], ",", 
            RowBox[{"distrPlot", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{"r", ",", "mcBest"}], "}"}], "\[Transpose]"}], ",", 
              RowBox[{"PlotStyle", "\[Rule]", 
               RowBox[{"{", 
                RowBox[{"Black", ",", "Thick"}], "}"}]}]}], "]"}], ",", 
            RowBox[{"ListPlot", "[", 
             RowBox[{
              RowBox[{"{", "}"}], ",", 
              RowBox[{"Joined", "\[Rule]", "True"}], ",", 
              RowBox[{"PlotLegends", "->", 
               RowBox[{"Placed", "[", 
                RowBox[{
                 RowBox[{"LineLegend", "[", 
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Directive", "[", 
                    RowBox[{
                    RowBox[{"color", "[", "1", "]"}], ",", "Dashed"}], "]"}], 
                    ",", "Black", ",", 
                    RowBox[{"mycolors", "[", 
                    RowBox[{"[", "3", "]"}], "]"}], ",", 
                    RowBox[{"mycolors", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "}"}], ",", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Style", "[", 
                    RowBox[{"\"\<Tikhonov\>\"", ",", 
                    RowBox[{"helv", "[", "20", "]"}]}], "]"}], ",", 
                    RowBox[{"Style", "[", 
                    RowBox[{"\"\<Gaussian Model\>\"", ",", 
                    RowBox[{"helv", "[", "20", "]"}]}], "]"}], ",", 
                    RowBox[{"Style", "[", 
                    RowBox[{"\"\<60% CI\>\"", ",", 
                    RowBox[{"helv", "[", "20", "]"}]}], "]"}], ",", 
                    RowBox[{"Style", "[", 
                    RowBox[{"\"\<95% CI\>\"", ",", 
                    RowBox[{"helv", "[", "20", "]"}]}], "]"}]}], "}"}]}], 
                  "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{".8", ",", ".8"}], "}"}]}], "]"}]}]}], "]"}], ",", 
            "##"}], "]"}], ",", "##"}], "]"}], "&"}], "@@", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"LabelStyle", "\[Rule]", 
          RowBox[{"helv", "[", "42", "]"}]}], ",", 
         RowBox[{"ImageSize", "\[Rule]", "750"}]}], "}"}]}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"Style", "[", 
          RowBox[{"\"\<Best Model:\>\"", ",", 
           RowBox[{"helv", "[", "20", "]"}]}], "]"}], ",", "\"\< \>\"", ",", 
         "mcBestresultstable", ",", "\"\< \>\"", ",", 
         RowBox[{"Style", "[", 
          RowBox[{
          "\"\<F-test Cutoff Statistics (Mean\[PlusMinus]95% CI):\>\"", ",", 
           RowBox[{"helv", "[", "20", "]"}]}], "]"}], ",", "\"\< \>\"", ",", 
         "mcBeststatistics"}], "}"}], "//", "TableForm"}]}], "}"}], "}"}], "//",
    "TableForm"}]}], "\[IndentingNewLine]"}], "Input",
 Editable->False,
 CellChangeTimes->{{3.7179539535778933`*^9, 3.717953955205504*^9}, {
   3.729342785747579*^9, 3.72934279252328*^9}, 3.729445087772676*^9, {
   3.73125937007489*^9, 3.731259372622451*^9}, 3.731260296318228*^9, {
   3.731260937277834*^9, 3.731260940528739*^9}, {3.731261084720025*^9, 
   3.73126118378202*^9}, {3.731335506357668*^9, 3.731335522089982*^9}, {
   3.731335594846758*^9, 3.731335597421832*^9}, {3.731335655036302*^9, 
   3.731335661067705*^9}, 3.731335789889634*^9, {3.731335854689431*^9, 
   3.731335856350067*^9}, 3.731336045586961*^9, {3.731336095538741*^9, 
   3.7313360997326097`*^9}, {3.731336139563716*^9, 3.7313361434390783`*^9}, {
   3.731343851880803*^9, 3.731343855098518*^9}, {3.731414273018469*^9, 
   3.731414330320092*^9}, {3.731414370605049*^9, 3.731414393362363*^9}, {
   3.731414449315144*^9, 3.731414507059512*^9}, {3.7314146106263323`*^9, 
   3.731414616089231*^9}, {3.7314146714403257`*^9, 3.731414697148076*^9}, {
   3.731414757059506*^9, 3.731414767781932*^9}, {3.731682916659093*^9, 
   3.731682918528359*^9}, {3.731682960425253*^9, 3.7316829617351637`*^9}, 
   3.731683990600947*^9, 3.731684531564589*^9, {3.731684977644738*^9, 
   3.731684979020253*^9}, {3.73168866285984*^9, 3.731688678081506*^9}, {
   3.7316887123921432`*^9, 3.731688748817274*^9}, {3.731688778951997*^9, 
   3.731688791883811*^9}, {3.731688825399498*^9, 3.731688837673601*^9}, {
   3.7316889051878*^9, 3.7316889123658123`*^9}, {3.731688953949712*^9, 
   3.73168895542484*^9}, {3.7316925765133877`*^9, 3.731692628072562*^9}, {
   3.73169265995256*^9, 
   3.731692663308442*^9}},ExpressionUUID->"cd54ee19-52a9-46e2-b7d3-\
6978fa23c2f2"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"Export", " ", "Figures", " ", "and", " ", "Spreadsheets"}], ",", 
    " ", 
    RowBox[{"choose", " ", "a", " ", "sample", " ", "name"}]}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"tempsamplename", "=", 
     RowBox[{"FileBaseName", "[", 
      RowBox[{"filename", "[", 
       RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   
   RowBox[{
    RowBox[{"DialogInput", "[", 
     RowBox[{
      RowBox[{"Grid", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"\"\<Sample Name:\>\"", ",", 
            RowBox[{"InputField", "[", 
             RowBox[{
              RowBox[{"Dynamic", "[", "tempsamplename", "]"}], ",", 
              "String"}], "]"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"DefaultButton", "[", 
            RowBox[{"DialogReturn", "[", 
             RowBox[{"sample", "=", "tempsamplename"}], "]"}], "]"}], "}"}]}],
          "}"}], ",", 
        RowBox[{"Spacings", "\[Rule]", 
         RowBox[{"{", 
          RowBox[{"1", ",", "Automatic"}], "}"}]}], ",", 
        RowBox[{"Alignment", "\[Rule]", "Left"}]}], "]"}], ",", 
      RowBox[{"Modal", "\[Rule]", "True"}]}], "]"}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Export", "[", 
     RowBox[{
      RowBox[{
      "dir", "<>", "sample", "<>", "\"\<_gaussianoptimizedspec.png\>\""}], 
      ",", "bestgaussianspec", ",", 
      RowBox[{"ImageResolution", "\[Rule]", "400"}]}], "]"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Export", "[", 
     RowBox[{
      RowBox[{
      "dir", "<>", "sample", "<>", "\"\<_gaussianoptimizeddistrib.png\>\""}], 
      ",", "bestgaussiandistrib", ",", 
      RowBox[{"ImageResolution", "\[Rule]", "400"}]}], "]"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Export", "[", 
     RowBox[{
      RowBox[{"dir", "<>", "sample", "<>", "\"\<_rmsdAnalysis.png\>\""}], ",", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"{", 
         RowBox[{"gaussianRMSDperdistribOpt", ",", "gaussianDistribspread"}], 
         "}"}], "}"}], "//", "TableForm"}], ",", 
      RowBox[{"ImageResolution", "\[Rule]", "400"}]}], "]"}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Export", "[", 
     RowBox[{
      RowBox[{"dir", "<>", "sample", "<>", "\"\<_summary.xlsx\>\""}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"\"\<Spectra\>\"", "\[Rule]", 
         RowBox[{"Join", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"{", 
             RowBox[{
             "\"\<t (\[Mu]s)\>\"", ",", "\"\<Raw Data\>\"", ",", 
              "\"\<BG Fit\>\"", ",", "\"\<Original Waveform\>\"", ",", 
              "\"\<Original Tikhonov\>\"", ",", "\"\<New Waveform\>\"", ",", 
              "\"\<New Tikhonov Fit\>\"", ",", 
              "\"\<Gaussian Reconstrucion\>\"", ",", 
              "\"\<Monte Carlo Best\>\""}], "}"}], "}"}], ",", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"t", ",", 
              RowBox[{"bckg", "[", 
               RowBox[{"[", 
                RowBox[{"waveformrange", ",", "2"}], "]"}], "]"}], ",", 
              RowBox[{"bgbest", "[", 
               RowBox[{"[", 
                RowBox[{"waveformrange", ",", "2"}], "]"}], "]"}], ",", 
              "waveformbest", ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"kernel", ".", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"nnlsdistribs", "[", 
                   RowBox[{"[", "bgresidualminindex", "]"}], "]"}], "/", 
                  RowBox[{"NIntegrate", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"Interpolation", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"r", ",", 
                    RowBox[{
                    RowBox[{"nnlsdistribs", "[", 
                    RowBox[{"[", "bgresidualminindex", "]"}], "]"}], "-", 
                    "extrabackground"}]}], "}"}], "\[Transpose]"}], "]"}], 
                    "[", "x", "]"}], ",", 
                    RowBox[{"Prepend", "[", 
                    RowBox[{
                    RowBox[{"MinMax", "[", "r", "]"}], ",", "x"}], "]"}]}], 
                   "]"}]}], ")"}]}], "/", 
               RowBox[{"Max", "[", 
                RowBox[{
                 RowBox[{"kernel", ".", 
                  RowBox[{"nnlsdistribs", "[", 
                   RowBox[{"[", "bgresidualminindex", "]"}], "]"}]}], "/", 
                 RowBox[{"NIntegrate", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"Interpolation", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"r", ",", 
                    RowBox[{
                    RowBox[{"nnlsdistribs", "[", 
                    RowBox[{"[", "bgresidualminindex", "]"}], "]"}], "-", 
                    "extrabackground"}]}], "}"}], "\[Transpose]"}], "]"}], 
                    "[", "x", "]"}], ",", 
                   RowBox[{"Prepend", "[", 
                    RowBox[{
                    RowBox[{"MinMax", "[", "r", "]"}], ",", "x"}], "]"}]}], 
                  "]"}]}], "]"}]}], ",", "newwaveform", ",", 
              RowBox[{
               RowBox[{"kernel", ".", "newdistribution"}], "/", 
               RowBox[{"Max", "[", 
                RowBox[{"kernel", ".", "newdistribution"}], "]"}]}], ",", 
              RowBox[{
               RowBox[{"kernel", ".", "bestgaussianfit"}], "/", 
               RowBox[{"Max", "[", 
                RowBox[{"kernel", ".", "bestgaussianfit"}], "]"}]}], ",", 
              RowBox[{
               RowBox[{"kernel", ".", "mcBest"}], "/", 
               RowBox[{"Max", "[", 
                RowBox[{"kernel", ".", "mcBest"}], "]"}]}]}], "}"}], 
            "\[Transpose]"}]}], "]"}]}], ",", 
        RowBox[{"\"\<Distributions\>\"", "\[Rule]", 
         RowBox[{"Join", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"{", 
             RowBox[{
             "\"\<r (nm)\>\"", ",", "\"\<Original Tikhonov Distribution\>\"", 
              ",", "\"\<Lower BG Validation CI\>\"", ",", 
              "\"\<Upper Validation CI\>\"", ",", 
              "\"\<New Tikhonov Distribution\>\"", ",", 
              "\"\<Gaussian Reconstruction\>\"", ",", 
              "\"\<Monte Carlo Best\>\"", ",", "\"\<Lower 60CI\>\"", ",", 
              "\"\<Upper 60CI\>\"", ",", "\"\<Lower 95CI\>\"", ",", 
              "\"\<Upper 95CI\>\""}], "}"}], "}"}], ",", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"r", ",", 
              RowBox[{
               RowBox[{"nnlsdistribs", "[", 
                RowBox[{"[", "bgresidualminindex", "]"}], "]"}], "/", 
               RowBox[{"NIntegrate", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"Interpolation", "[", 
                   RowBox[{
                    RowBox[{"{", 
                    RowBox[{"r", ",", 
                    RowBox[{
                    RowBox[{"nnlsdistribs", "[", 
                    RowBox[{"[", "bgresidualminindex", "]"}], "]"}], "-", 
                    "extrabackground"}]}], "}"}], "\[Transpose]"}], "]"}], 
                  "[", "x", "]"}], ",", 
                 RowBox[{"Prepend", "[", 
                  RowBox[{
                   RowBox[{"MinMax", "[", "r", "]"}], ",", "x"}], "]"}]}], 
                "]"}]}], ",", 
              RowBox[{
               RowBox[{"Quantile", "@@", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"nnlsdistribs", "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"filter", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ";;", 
                    RowBox[{"filter", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}], ",", 
                  ".0"}], "}"}]}], "/", 
               RowBox[{"NIntegrate", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"Interpolation", "[", 
                   RowBox[{
                    RowBox[{"{", 
                    RowBox[{"r", ",", 
                    RowBox[{
                    RowBox[{"nnlsdistribs", "[", 
                    RowBox[{"[", "bgresidualminindex", "]"}], "]"}], "-", 
                    "extrabackground"}]}], "}"}], "\[Transpose]"}], "]"}], 
                  "[", "x", "]"}], ",", 
                 RowBox[{"Prepend", "[", 
                  RowBox[{
                   RowBox[{"MinMax", "[", "r", "]"}], ",", "x"}], "]"}]}], 
                "]"}]}], ",", 
              RowBox[{
               RowBox[{"Quantile", "@@", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"nnlsdistribs", "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"filter", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ";;", 
                    RowBox[{"filter", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}], ",", 
                  "1."}], "}"}]}], "/", 
               RowBox[{"NIntegrate", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"Interpolation", "[", 
                   RowBox[{
                    RowBox[{"{", 
                    RowBox[{"r", ",", 
                    RowBox[{
                    RowBox[{"nnlsdistribs", "[", 
                    RowBox[{"[", "bgresidualminindex", "]"}], "]"}], "-", 
                    "extrabackground"}]}], "}"}], "\[Transpose]"}], "]"}], 
                  "[", "x", "]"}], ",", 
                 RowBox[{"Prepend", "[", 
                  RowBox[{
                   RowBox[{"MinMax", "[", "r", "]"}], ",", "x"}], "]"}]}], 
                "]"}]}], ",", "newdistribution", ",", "bestgaussianfit", ",", 
              "mcBest", ",", 
              RowBox[{"myquantiles60", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", 
              RowBox[{"myquantiles60", "[", 
               RowBox[{"[", "2", "]"}], "]"}], ",", 
              RowBox[{"myquantiles95", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", 
              RowBox[{"myquantiles95", "[", 
               RowBox[{"[", "2", "]"}], "]"}]}], "}"}], "\[Transpose]"}]}], 
          "]"}]}], ",", 
        RowBox[{"\"\<Fit Results\>\"", "\[Rule]", 
         RowBox[{"Join", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", "\"\<From Tikhonov\>\"", "}"}], ",", 
             RowBox[{"{", 
              RowBox[{
              "\"\<r (nm)\>\"", ",", "\"\<\[Sigma] (nm)\>\"", ",", 
               "\"\<fraction\>\""}], "}"}]}], "}"}], ",", 
           RowBox[{"tablelesstext", "[", "bestfit", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", "\"\<From MC Best Fit\>\"", "}"}], ",", 
             RowBox[{"{", 
              RowBox[{
              "\"\<r (nm)\>\"", ",", "\"\<\[Sigma] (nm)\>\"", ",", 
               "\"\<fraction\>\""}], "}"}]}], "}"}], ",", 
           RowBox[{"tablelesstext", "[", 
            RowBox[{
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{
                  RowBox[{"\[Mu]", "[", "i", "]"}], "->", 
                  RowBox[{"mcBestdigits", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", ",", "1"}], "]"}], "]"}]}], ",", 
                 RowBox[{
                  RowBox[{"A", "[", "i", "]"}], "->", 
                  RowBox[{"mcBestdigits", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", ",", "2"}], "]"}], "]"}]}], ",", 
                 RowBox[{
                  RowBox[{"\[Sigma]", "[", "i", "]"}], "->", 
                  RowBox[{"mcBestdigits", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", ",", "3"}], "]"}], "]"}]}]}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", 
                 RowBox[{"Length", "[", "mcBestdigits", "]"}]}], "}"}]}], 
              "]"}], "//", "Flatten"}], "]"}]}], "]"}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"\"\<L-Curve\>\"", "\[Rule]", 
         RowBox[{"Join", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"{", 
             RowBox[{
             "\"\<Residual Norm\>\"", ",", "\"\<Solution Norm\>\"", ",", 
              RowBox[{"\"\<Chosen Alpha Cell == \>\"", "<>", 
               RowBox[{"ToString", "[", "alphavalue", "]"}]}]}], "}"}], "}"}],
            ",", 
           RowBox[{"Join", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"residualnorm", ",", "solutionnorm"}], "}"}], 
             "\[Transpose]"}], "]"}]}], "]"}]}], ",", "\[IndentingNewLine]", 
        RowBox[{"\"\<Gaussian RMSD\>\"", "\[Rule]", 
         RowBox[{"Join", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"Join", "[", 
             RowBox[{
              RowBox[{"{", "\"\<r {nm}\>\"", "}"}], ",", 
              RowBox[{"Table", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"ToString", "[", "i", "]"}], "<>", 
                 "\"\< Gaussian(s)\>\""}], ",", 
                RowBox[{"{", 
                 RowBox[{"i", ",", 
                  RowBox[{"Length", "[", "gaussianfits", "]"}]}], "}"}]}], 
               "]"}]}], "]"}], "}"}], ",", 
           RowBox[{
            RowBox[{"Join", "[", 
             RowBox[{
              RowBox[{"{", "r", "}"}], ",", "gaussianfits"}], "]"}], 
            "\[Transpose]"}]}], "]"}]}], ",", "\[IndentingNewLine]", 
        RowBox[{"\"\<Gaussian RMSD Plot\>\"", "\[Rule]", 
         RowBox[{"Join", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"{", 
             RowBox[{"\"\<Gaussian(s)\>\"", ",", "\"\<RMSD\>\"", ",", 
              RowBox[{"\"\<Tikhonov RMSD == \>\"", "<>", 
               RowBox[{"ToString", "[", 
                RowBox[{"RootMeanSquare", "[", 
                 RowBox[{"newwaveform", "-", 
                  RowBox[{
                   RowBox[{"kernel", ".", "newdistribution"}], "/", 
                   RowBox[{"Max", "[", 
                    RowBox[{"kernel", ".", "newdistribution"}], "]"}]}]}], 
                 "]"}], "]"}]}]}], "}"}], "}"}], ",", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "gaussianRMSDs", "]"}], "]"}], ",", 
              "gaussianRMSDs"}], "}"}], "\[Transpose]"}]}], "]"}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"\"\<BG Validation\>\"", "\[Rule]", 
         RowBox[{"Join", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"Join", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
               "\"\<r (nm)\>\"", ",", "\"\<Lower Range\>\"", ",", " ", 
                "\"\<Upper Range\>\""}], "}"}], ",", 
              RowBox[{"Table", "[", 
               RowBox[{
                RowBox[{"ToString", "[", "i", "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{"i", ",", 
                  RowBox[{"Length", "[", 
                   RowBox[{"nnlsdistribs", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"filter", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ";;", 
                    RowBox[{"filter", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}], "]"}]}], 
                 "}"}]}], "]"}]}], "]"}], "}"}], ",", 
           RowBox[{
            RowBox[{"Join", "[", 
             RowBox[{
              RowBox[{"{", "r", "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"Quantile", "@@", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"nnlsdistribs", "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"filter", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ";;", 
                    RowBox[{"filter", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}], ",", 
                  ".0"}], "}"}]}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"Quantile", "@@", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"nnlsdistribs", "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"filter", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ";;", 
                    RowBox[{"filter", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}], ",", 
                  "1."}], "}"}]}], "}"}], ",", 
              RowBox[{"nnlsdistribs", "[", 
               RowBox[{"[", 
                RowBox[{
                 RowBox[{"filter", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], ";;", 
                 RowBox[{"filter", "[", 
                  RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}]}], "]"}], 
            "\[Transpose]"}]}], "]"}]}], ",", "\[IndentingNewLine]", 
        RowBox[{"\"\<BG Validation RMSDs\>\"", "\[Rule]", 
         RowBox[{"Join", "[", 
          RowBox[{
           RowBox[{"Join", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"{", 
               RowBox[{"\"\<Full\>\"", ",", "\"\<\>\""}], "}"}], "}"}], ",", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{
                 RowBox[{"residualchunks", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "[", 
                 RowBox[{"[", 
                  RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", 
                RowBox[{
                 RowBox[{"residualchunks", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "[", 
                 RowBox[{"[", 
                  RowBox[{"All", ",", "2"}], "]"}], "]"}]}], "}"}], 
              "\[Transpose]"}]}], "]"}], ",", 
           RowBox[{"Join", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"{", 
               RowBox[{"\"\<Chopped\>\"", ",", "\"\<\>\""}], "}"}], "}"}], 
             ",", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{
                 RowBox[{"residualchunks", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "[", 
                 RowBox[{"[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"filter", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ";;", 
                    RowBox[{"filter", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], ",", "1"}], "]"}], 
                 "]"}], ",", 
                RowBox[{
                 RowBox[{"residualchunks", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "[", 
                 RowBox[{"[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"filter", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ";;", 
                    RowBox[{"filter", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], ",", "2"}], "]"}], 
                 "]"}]}], "}"}], "\[Transpose]"}]}], "]"}]}], "]"}]}]}], 
       "\[IndentingNewLine]", "}"}]}], "]"}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"Export", "[", 
    RowBox[{
     RowBox[{"dir", "<>", "sample", "<>", "\"\<_AnalysisOverview.pdf\>\""}], 
     ",", "\[IndentingNewLine]", 
     RowBox[{"TableForm", "[", 
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{"{", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"Text", "[", 
             RowBox[{"Style", "[", 
              RowBox[{
               RowBox[{"\"\<Sample: \>\"", "<>", "sample"}], ",", 
               RowBox[{"helv", "[", "24", "]"}]}], "]"}], "]"}], "}"}], ",", 
           RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{"Text", "[", 
             RowBox[{"Style", "[", 
              RowBox[{
              "\"\<Zero Point, Cuttoff and Initial Background \
Subtraction\>\"", ",", 
               RowBox[{"helv", "[", "24", "]"}]}], "]"}], "]"}], "}"}], ",", 
           RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{
            "zeropeakplot", ",", "bgsubtractplot", ",", 
             "intialwaveformplot"}], "}"}], ",", 
           RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{"Text", "[", 
             RowBox[{"Style", "[", 
              RowBox[{
              "\"\<L-Curve and Choice of Smoothing Parameter\>\"", ",", 
               RowBox[{"helv", "[", "24", "]"}]}], "]"}], "]"}], "}"}], ",", 
           RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"lcurveplot", "[", 
              RowBox[{"[", "1", "]"}], "]"}], ",", 
             RowBox[{"spectrumplot", "[", 
              RowBox[{"[", "1", "]"}], "]"}], ",", 
             RowBox[{"spectrumresidual", "[", 
              RowBox[{"[", "1", "]"}], "]"}]}], "}"}], ",", 
           RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{"Text", "[", 
             RowBox[{"Style", "[", 
              RowBox[{
              "\"\<Distance Distrubution at Chosen Smoothness\>\"", ",", 
               RowBox[{"helv", "[", "24", "]"}]}], "]"}], "]"}], "}"}], ",", 
           RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{"nnlsspecplot", ",", "nnlsdistribplot"}], "}"}], ",", 
           RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{"Text", "[", 
             RowBox[{"Style", "[", 
              RowBox[{
              "\"\<Background Validation Range and Resultant Spectra\>\"", 
               ",", 
               RowBox[{"helv", "[", "24", "]"}]}], "]"}], "]"}], "}"}], ",", 
           RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{"bgvalidationplot", ",", "bgvalidationspecplot"}], "}"}], 
           ",", 
           RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{"Text", "[", 
             RowBox[{"Style", "[", 
              RowBox[{
              "\"\<Background Validation RMSDs and Selected \
Distributions\>\"", ",", 
               RowBox[{"helv", "[", "24", "]"}]}], "]"}], "]"}], "}"}], ",", 
           RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"backgroundrmsd", "[", 
              RowBox[{"[", "1", "]"}], "]"}], ",", 
             RowBox[{"validationbackgrounds", "[", 
              RowBox[{"[", "1", "]"}], "]"}], ",", 
             RowBox[{"validationchoppedplot", "[", 
              RowBox[{"[", "1", "]"}], "]"}]}], "}"}], ",", 
           RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{"Text", "[", 
             RowBox[{"Style", "[", 
              RowBox[{
              "\"\<Optimized Background Choice/Defined BG Correction Region\>\
\"", ",", 
               RowBox[{"helv", "[", "24", "]"}]}], "]"}], "]"}], "}"}], ",", 
           RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{"optimizedbackground", ",", "noiserrorplotsmall", ",", 
             RowBox[{"bgcorrectionplot", "[", 
              RowBox[{"[", "1", "]"}], "]"}]}], "}"}], ",", 
           RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{"Text", "[", 
             RowBox[{"Style", "[", 
              RowBox[{
              "\"\<Gaussian Analysis of the Tikhonov Distribution\>\"", ",", 
               RowBox[{"helv", "[", "24", "]"}]}], "]"}], "]"}], "}"}], ",", 
           RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{
            "gaussianRMSDperdistribOpt", ",", "gaussianDistribspread"}], 
            "}"}], ",", 
           RowBox[{"{", "}"}]}], "\[IndentingNewLine]", "}"}], 
         "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{"{", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"Text", "[", 
             RowBox[{"Style", "[", 
              RowBox[{"\"\<Optimum Gaussian Reconstruction Spectrum\>\"", ",", 
               RowBox[{"helv", "[", "24", "]"}]}], "]"}], "]"}], "}"}], ",", 
           RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{"optimizedplot", ",", "optimizedresidual"}], "}"}], ",", 
           RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{"Text", "[", 
             RowBox[{"Style", "[", 
              RowBox[{
              "\"\<Optimum Gaussian Reconstruction Distribution\>\"", ",", 
               RowBox[{"helv", "[", "24", "]"}]}], "]"}], "]"}], 
            RowBox[{"(*", 
             RowBox[{",", 
              RowBox[{"Text", "[", 
               RowBox[{"Style", "[", 
                RowBox[{
                "\"\<Uncertainty in Gaussians Based on Smoothing \
Parameter\>\"", ",", 
                 RowBox[{"helv", "[", "24", "]"}]}], "]"}], "]"}]}], "*)"}], 
            "}"}], ",", 
           RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
           RowBox[{"{", "bestgaussiandistrib", 
            RowBox[{"(*", 
             RowBox[{",", "gaussianUncertaintyPlot"}], "*)"}], "}"}], ",", 
           RowBox[{"{", "}"}]}], "\[IndentingNewLine]", "\[IndentingNewLine]",
           "}"}], "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{"{", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"Text", "[", 
             RowBox[{"Style", "[", 
              RowBox[{"\"\<Monte Carlo Modeling\>\"", ",", 
               RowBox[{"helv", "[", "24", "]"}]}], "]"}], "]"}], "}"}], ",", 
           RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
           RowBox[{"{", "mcPlots", "}"}], ",", 
           RowBox[{"{", "}"}]}], "\[IndentingNewLine]", "}"}], 
         "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{"{", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"Text", "[", 
             RowBox[{"Style", "[", 
              RowBox[{"\"\<Monte Carlo Results\>\"", ",", 
               RowBox[{"helv", "[", "24", "]"}]}], "]"}], "]"}], "}"}], ",", 
           RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{"mcSpectra", ",", "mcDistros"}], "}"}], ",", 
           RowBox[{"{", "}"}]}], "\[IndentingNewLine]", "}"}], 
         "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{"{", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"Text", "[", 
             RowBox[{"Style", "[", 
              RowBox[{"\"\<Monte Carlo Statistics\>\"", ",", 
               RowBox[{"helv", "[", "24", "]"}]}], "]"}], "]"}], "}"}], ",", 
           RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
           RowBox[{"{", "mcDistrosStats", "}"}], ",", 
           RowBox[{"{", "}"}]}], "\[IndentingNewLine]", "}"}], 
         "\[IndentingNewLine]", "}"}]}], "\[IndentingNewLine]", "}"}], 
      "]"}]}], "]"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"allgaussians", "=", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"rmsdParams", "[", 
         RowBox[{"[", 
          RowBox[{"i", ",", "1"}], "]"}], "]"}], "//", "Most"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", 
         RowBox[{"Length", "@", "rmsdParams"}]}], "}"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"Export", "[", 
    RowBox[{
     RowBox[{"dir", "<>", "sample", "<>", "\"\<_databackup.m\>\""}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{
      "sample", ",", "\[IndentingNewLine]", "t", ",", "\[IndentingNewLine]", 
       "waveformbest", ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"kernel", ".", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"nnlsdistribs", "[", 
            RowBox[{"[", "bgresidualminindex", "]"}], "]"}], "/", 
           RowBox[{"NIntegrate", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Interpolation", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"r", ",", 
                  RowBox[{
                   RowBox[{"nnlsdistribs", "[", 
                    RowBox[{"[", "bgresidualminindex", "]"}], "]"}], "-", 
                   "extrabackground"}]}], "}"}], "\[Transpose]"}], "]"}], "[",
               "x", "]"}], ",", 
             RowBox[{"Prepend", "[", 
              RowBox[{
               RowBox[{"MinMax", "[", "r", "]"}], ",", "x"}], "]"}]}], 
            "]"}]}], ")"}]}], "/", 
        RowBox[{"Max", "[", 
         RowBox[{
          RowBox[{"kernel", ".", 
           RowBox[{"nnlsdistribs", "[", 
            RowBox[{"[", "bgresidualminindex", "]"}], "]"}]}], "/", 
          RowBox[{"NIntegrate", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Interpolation", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"r", ",", 
                 RowBox[{
                  RowBox[{"nnlsdistribs", "[", 
                   RowBox[{"[", "bgresidualminindex", "]"}], "]"}], "-", 
                  "extrabackground"}]}], "}"}], "\[Transpose]"}], "]"}], "[", 
             "x", "]"}], ",", 
            RowBox[{"Prepend", "[", 
             RowBox[{
              RowBox[{"MinMax", "[", "r", "]"}], ",", "x"}], "]"}]}], "]"}]}],
          "]"}]}], ",", "\[IndentingNewLine]", "newwaveform", ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"kernel", ".", "mcBest"}], "/", 
        RowBox[{"Max", "[", 
         RowBox[{"kernel", ".", "mcBest"}], "]"}]}], ",", 
       "\[IndentingNewLine]", "r", ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"nnlsdistribs", "[", 
         RowBox[{"[", "bgresidualminindex", "]"}], "]"}], "/", 
        RowBox[{"NIntegrate", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Interpolation", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"r", ",", 
               RowBox[{
                RowBox[{"nnlsdistribs", "[", 
                 RowBox[{"[", "bgresidualminindex", "]"}], "]"}], "-", 
                "extrabackground"}]}], "}"}], "\[Transpose]"}], "]"}], "[", 
           "x", "]"}], ",", 
          RowBox[{"Prepend", "[", 
           RowBox[{
            RowBox[{"MinMax", "[", "r", "]"}], ",", "x"}], "]"}]}], "]"}]}], 
       ",", "\[IndentingNewLine]", 
       RowBox[{"Total", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"peakfunc", "[", 
           RowBox[{"##", ",", "r"}], "]"}], "&"}], "@@@", 
         RowBox[{"Most", "[", 
          RowBox[{
           RowBox[{"MinimalBy", "[", 
            RowBox[{"walkies", ",", "Last"}], "]"}], "[", 
           RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "]"}], ",", 
       "\[IndentingNewLine]", "mcBestdigits", ",", "\[IndentingNewLine]", 
       "allgaussians", ",", "\[IndentingNewLine]", 
       RowBox[{"bckg", "[", 
        RowBox[{"[", 
         RowBox[{"waveformrange", ",", "2"}], "]"}], "]"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"bgbest", "[", 
          RowBox[{"[", 
           RowBox[{"waveformrange", ",", "2"}], "]"}], "]"}], ",", 
         RowBox[{"kernel", ".", "extrabackground"}], ",", "zeroamp"}], 
        "}"}]}], "}"}]}], "]"}]}]}]], "Input",
 Editable->False,
 CellChangeTimes->{{3.692555899493252*^9, 3.6925559593145523`*^9}, 
   3.692556257431031*^9, {3.692556289114614*^9, 3.692556301167185*^9}, {
   3.692639459796229*^9, 3.6926395510280933`*^9}, 3.692639732280121*^9, {
   3.692639789642591*^9, 3.692639800762499*^9}, {3.692639900235362*^9, 
   3.692639947401641*^9}, {3.692640018243746*^9, 3.692640190922381*^9}, {
   3.692640322900181*^9, 3.692640358596733*^9}, 3.6926404068822412`*^9, {
   3.692640501783723*^9, 3.692640511367272*^9}, 3.692640541391026*^9, {
   3.6926406572846937`*^9, 3.692640660624775*^9}, {3.6926407290961847`*^9, 
   3.692640819434626*^9}, {3.692640850559067*^9, 3.69264085170545*^9}, {
   3.6926408935979357`*^9, 3.692640942301993*^9}, {3.692641026089199*^9, 
   3.692641051641959*^9}, {3.6926410855126143`*^9, 3.6926412094284077`*^9}, {
   3.692643107537815*^9, 3.692643111194683*^9}, {3.692643207024379*^9, 
   3.692643224312413*^9}, {3.692643283071268*^9, 3.692643327619935*^9}, {
   3.6926434336305304`*^9, 3.692643438323783*^9}, 3.692643492739202*^9, {
   3.693151545625422*^9, 3.693151570315514*^9}, {3.693151707098754*^9, 
   3.6931517082510033`*^9}, {3.6931521154330273`*^9, 3.6931521191237497`*^9}, 
   3.6931521779426737`*^9, {3.6932460514930277`*^9, 3.693246051627582*^9}, {
   3.693246103032434*^9, 3.69324610317584*^9}, {3.693929503019809*^9, 
   3.693929506090488*^9}, {3.694967863698379*^9, 3.694967864908019*^9}, {
   3.6972845310312443`*^9, 3.697284547983481*^9}, {3.697564286065653*^9, 
   3.697564321486018*^9}, {3.6975644051807528`*^9, 3.697564414313246*^9}, {
   3.6975644880107307`*^9, 3.6975646175141983`*^9}, {3.69756468750904*^9, 
   3.6975646902290077`*^9}, {3.69756474114636*^9, 3.6975647632556877`*^9}, {
   3.697564844220112*^9, 3.697564861729003*^9}, {3.697564947614194*^9, 
   3.697564992515622*^9}, {3.697565403826438*^9, 3.6975654043397093`*^9}, 
   3.697565494475978*^9, {3.69756571661731*^9, 3.697565729055724*^9}, 
   3.69756701818219*^9, {3.697567098136859*^9, 3.697567100772827*^9}, {
   3.697567487369667*^9, 3.697567514915818*^9}, {3.697816874749621*^9, 
   3.697816900603656*^9}, {3.6978190017458363`*^9, 3.69781900414678*^9}, 
   3.697819332274667*^9, 3.698169460027337*^9, {3.698169772825674*^9, 
   3.698169790227599*^9}, {3.6981698383883867`*^9, 3.6981698479270277`*^9}, {
   3.698170244538025*^9, 3.698170246772798*^9}, {3.7005256458667717`*^9, 
   3.7005256759323263`*^9}, {3.700576601571107*^9, 3.7005766326869698`*^9}, 
   3.700585115721074*^9, {3.70073591197854*^9, 3.700735940451133*^9}, {
   3.700736036122705*^9, 3.700736052889789*^9}, {3.700736588315659*^9, 
   3.700736667212513*^9}, {3.7007367322767982`*^9, 3.700736746932631*^9}, 
   3.700736798915371*^9, {3.700737022265723*^9, 3.700737023372882*^9}, {
   3.700744215542495*^9, 3.700744218731594*^9}, {3.7007448968085413`*^9, 
   3.700744903291856*^9}, {3.701186723105085*^9, 3.7011867551572533`*^9}, {
   3.701186819383586*^9, 3.701186835715825*^9}, {3.701186953725721*^9, 
   3.7011869593614197`*^9}, {3.701187057892345*^9, 3.701187084448365*^9}, {
   3.701187174489903*^9, 3.7011872103452806`*^9}, 3.701187388364002*^9, {
   3.7017050759798822`*^9, 3.7017051112521143`*^9}, {3.701705144666144*^9, 
   3.701705198711639*^9}, {3.701791515819323*^9, 3.701791535525693*^9}, {
   3.701791640644375*^9, 3.701791643008195*^9}, {3.702215787867526*^9, 
   3.702215805084424*^9}, 3.702216262238119*^9, {3.702216370896432*^9, 
   3.702216372366971*^9}, {3.702216448418871*^9, 3.7022164801775703`*^9}, 
   3.702216521871849*^9, 3.7022167738138*^9, {3.7022168045764713`*^9, 
   3.7022168220618143`*^9}, {3.703420276288486*^9, 3.70342035014058*^9}, {
   3.703420404483252*^9, 3.703420404970348*^9}, 3.703420661294895*^9, 
   3.70342103185046*^9, {3.703426976846789*^9, 3.7034270084701242`*^9}, 
   3.7034270803086*^9, {3.703427135073921*^9, 3.703427153732361*^9}, {
   3.703427309986491*^9, 3.7034273113890142`*^9}, {3.7062871541844893`*^9, 
   3.706287161368062*^9}, {3.7087000859955883`*^9, 3.708700111577392*^9}, {
   3.708700301386685*^9, 3.708700323510889*^9}, {3.708700423519129*^9, 
   3.708700426843266*^9}, {3.708701017877468*^9, 3.708701042330489*^9}, {
   3.7087011993496523`*^9, 3.708701261357345*^9}, 3.708701344207821*^9, 
   3.708701665340283*^9, {3.710692718754704*^9, 3.710692719264867*^9}, {
   3.7179557910423183`*^9, 3.717955794381714*^9}, {3.7179569929923573`*^9, 
   3.7179569951901827`*^9}, {3.724428474476801*^9, 3.72442848963472*^9}, {
   3.7259738304018087`*^9, 3.725973847585499*^9}, {3.725974547995986*^9, 
   3.725974570592395*^9}, 3.725990959599668*^9, 3.726416818840304*^9, {
   3.726504135747984*^9, 3.7265041497392797`*^9}, {3.728745300811379*^9, 
   3.728745304219166*^9}, {3.729342861098197*^9, 3.729342872030368*^9}, {
   3.729342908516501*^9, 3.729342913366214*^9}, {3.729342955110711*^9, 
   3.729343063633993*^9}, 3.729343214353857*^9, {3.729343269809441*^9, 
   3.729343319709502*^9}, 3.729343377052997*^9, 3.729445287046085*^9, 
   3.7294453679451103`*^9, {3.729445415859137*^9, 3.729445462003282*^9}, {
   3.7294455461053467`*^9, 3.729445577535714*^9}, {3.7294456841126003`*^9, 
   3.729445691690098*^9}, {3.729445767584532*^9, 3.729445819018982*^9}, {
   3.729446673196993*^9, 3.729446682788094*^9}, {3.7298562873689127`*^9, 
   3.729856323505949*^9}, 3.729859352599572*^9, 3.729859414843275*^9, 
   3.729861572070282*^9, {3.729947471000895*^9, 3.7299475212891617`*^9}, {
   3.731416169263085*^9, 3.731416172707178*^9}, 3.7316882272976837`*^9, {
   3.7316889733673143`*^9, 3.731688973642115*^9}, {3.731804247023658*^9, 
   3.731804314406362*^9}},ExpressionUUID->"4c323fcc-5978-44a4-8d78-\
54b0d41291d8"]
},
WindowSize->{1680, 1001},
WindowMargins->{{0, Automatic}, {0, Automatic}},
ShowSelection->True,
TaggingRules->{"Openers" -> {"NotesSection" -> Closed}},
FrontEndVersion->"11.1 for Mac OS X x86 (32-bit, 64-bit Kernel) (April 27, \
2017)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[579, 22, 1423, 32, 75, "Input", "ExpressionUUID" -> \
"c0aaf8f3-b9da-49c9-9ffd-715f2066d025",
 CellGroupingRules->{"GroupTogetherGrouping", 10000.}],
Cell[2005, 56, 3920, 70, 217, "Input", "ExpressionUUID" -> \
"20ce8dda-917c-453f-8fc9-d3b75378b069",
 CellGroupingRules->{"GroupTogetherGrouping", 10000.},
 InitializationCell->True]
}, Closed]],
Cell[5940, 129, 34289, 706, 2337, "Input", "ExpressionUUID" -> \
"fbc8310c-f693-408f-9990-5bb2907de379"],
Cell[40232, 837, 17774, 427, 852, "Input", "ExpressionUUID" -> \
"ec16acea-8cea-45ed-bd32-5dd90a7d3dad"],
Cell[58009, 1266, 30469, 692, 1671, "Input", "ExpressionUUID" -> \
"7f1409ba-bf14-4d03-a41f-0ccecee7eb8c"],
Cell[88481, 1960, 17395, 394, 1062, "Input", "ExpressionUUID" -> \
"8bdb45f1-78df-4ac8-9031-4ca9a86d214c"],
Cell[105879, 2356, 5871, 118, 306, "Input", "ExpressionUUID" -> \
"172c9616-18dc-48ce-b733-dc9403428525"],
Cell[111753, 2476, 389, 7, 32, "Input", "ExpressionUUID" -> \
"d9935af7-b2d4-4b6e-aace-fe3da63cebeb"],
Cell[112145, 2485, 20797, 457, 1230, "Input", "ExpressionUUID" -> \
"8f300e3e-04e5-4904-91ef-42e75d46c5bd"],
Cell[132945, 2944, 28068, 647, 978, "Input", "ExpressionUUID" -> \
"3021aece-0105-4d92-a605-8fc58b6009ed"],
Cell[161016, 3593, 4087, 90, 201, "Input", "ExpressionUUID" -> \
"354fa1ae-7123-4baa-9ff8-ac36e8d96b61"],
Cell[165106, 3685, 7158, 172, 306, "Input", "ExpressionUUID" -> \
"4c4e879d-4b73-4c90-ad36-1dc62baee1ae"],
Cell[172267, 3859, 6159, 155, 348, "Input", "ExpressionUUID" -> \
"696b043b-fab6-4b40-b602-48f9addbe05c"],
Cell[178429, 4016, 54551, 1252, 2571, "Input", "ExpressionUUID" -> \
"27715129-4609-41e5-aa18-ec616c40bea2"],
Cell[232983, 5270, 15021, 360, 751, "Input", "ExpressionUUID" -> \
"6f22cdc2-9310-4d88-9e76-71fee5f065c7"],
Cell[248007, 5632, 15103, 370, 663, "Input", "ExpressionUUID" -> \
"fddf8e7b-2a8d-4b7e-934a-7f81e2140835"],
Cell[263113, 6004, 51259, 1181, 2238, "Input", "ExpressionUUID" -> \
"5a643434-8fc6-4445-8dda-474cb5e324de"],
Cell[314375, 7187, 5648, 160, 243, "Input", "ExpressionUUID" -> \
"1aec91be-aa7d-4556-a45f-351c9284df5d"],
Cell[320026, 7349, 12352, 300, 453, "Input", "ExpressionUUID" -> \
"cd54ee19-52a9-46e2-b7d3-6978fa23c2f2"],
Cell[332381, 7651, 37913, 839, 2091, "Input", "ExpressionUUID" -> \
"4c323fcc-5978-44a4-8d78-54b0d41291d8"]
}
]
*)

